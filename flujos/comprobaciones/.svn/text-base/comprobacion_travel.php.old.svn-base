<?php

/**********************************************************
 *	         T&E Mï¿½dulo de Nueva Comprobaciï¿½n             *
 *	 Creado por:	  Jorge Usigli Huerta 11-Ene-2010	  *
 *	 Modificado por: Uziel Castillo OCT-2011		      *
 * 	 PHP, jQuery, JavaScript, CSS                         *
 **********************************************************/
print_r($_SESSION);
if (isset($_POST['guardarComp']) || isset($_POST['guardarPrev']) || isset($_POST['addGasolina'])) {
	//error_log("Entra aqui");
	require_once("../../lib/php/constantes.php");
    require_once("../../Connections/fwk_db.php");
    require_once("../../functions/Usuario.php");
    require_once("../../functions/Tramite.php");
	require_once("services/func_comprobacion.php");	
	require_once("$RUTA_A/functions/Delegados.php");
	require_once("$RUTA_A/flujos/solicitudes/services/C_SV.php");
	require_once("$RUTA_A/flujos/solicitudes/services/utils.php");
	require_once("$RUTA_A/functions/Delegados.php");
	
	
	//variables para identificar si sera edicion o una nueva comprobacion
	$actualizacion_comp = 0;
    $idTramite = 0;
    if(isset($_POST['id_tramite'])){
      	$actualizacion_comp = 1;
      	$idTramite = $_POST['id_tramite'];			
    }		
	
	function limpiaFormato($valor){
		$valor = preg_replace("/,/","",$valor);
		$valor = preg_replace("/$/","",$valor);
		return floatval($valor);
	}
	
	//limpia los detalles de comprobacion
	function limpiar_detalles($id_tramite){
    	$cnn = new conexion();
    	$query="DELETE detalle_comprobacion
				FROM detalle_comprobacion, comprobaciones, tramites
				WHERE t_id = co_mi_tramite 
				AND co_id = dc_comprobacion 
				AND t_id ='".$id_tramite."'";		
    	$cnn->ejecutar($query);		
    }
	
	//limpia excepciones
	function limpiar_excepciones($id_tramite){
    	$cnn = new conexion();
    	$sql = "DELETE excepciones
				FROM excepciones 
				JOIN comprobaciones ON co_id = ex_comprobacion
				WHERE co_mi_tramite =  '".$id_tramite."'";				
    	$cnn->ejecutar($sql);		
    }
		
	// Valida que haya partidas
    if (isset($_POST['rowCountCecos']) || $_POST['rowCountCecos'] > 0){
		
		$observ = $_POST['observ'];
		$anticipoCompAutBMW = limpiaFormato($_POST["anticipo_comprobado_autorizado_BMW2"]);
		$personalDescontar = limpiaFormato($_POST["personal_descontar2"]);
		$amexCompAutBMW = limpiaFormato($_POST["amex_comprobado_autorizado_BMW2"]);
		$efectivoCompAutBMW = limpiaFormato($_POST["efectivo_comprobado_autorizado_BMW2"]);
		$montoDescontar = limpiaFormato($_POST["monto_a_descontar2"]);
		$montoReembolsar = limpiaFormato($efectivoCompAutBMW);
		$centroCosto = $_POST["ccentro_costos"];
		$amexExterno = limpiaFormato($_POST["amex_externo2"]);
		$sesionDelegado = $_POST['delegado'];
		$etapaTramiteComprobacion = $_POST['etapaComprobacion'];
		
		$totalComprobaciones = 0;
		for ($i = 1; $i <= $_POST['rowCountCecos']; $i++) {
			$totalComprobaciones+=limpiaFormato($_POST["totalMxn". $i]);
		}
				
	    // Datos del empleado
		$iduser = 0;
		$delegado = 0;
        //$iduser = $_POST['iu'];       
        $idempresa = $_POST["empresa"];       
        $motivoComprobacion = $_POST["motive"];
        
    	if($sesionDelegado != 0){
			$iduser = $sesionDelegado;
			$delegado = $_POST['iu'];
    	}else{
			$iduser = $_POST['iu'];
		}
		
        // Datos de la Solicitud
        if ($_POST['Cecos_refacturado'] == 1) {
            $refacturar = "1";
        } else {
            $refacturar = "0";
        }

        $idSolicitud = $_POST["sol_select"];		
		$cnn = new conexion();
		$Vsql = "SELECT sv_tramite, sv_total_anticipo FROM solicitud_viaje WHERE sv_tramite = $idSolicitud";
		$Res_Vsql = $cnn->consultar($Vsql);
		$idTramite2 = mysql_result($Res_Vsql, 0, "sv_tramite");
		$total_anticipo = mysql_result($Res_Vsql, 0, "sv_total_anticipo");		
				
        // Registra nuevo tramite
        $tramite = new Tramite();
        $delegados = new Delegados();
        
        $tramite->insertar("BEGIN WORK");
		
		$co_gasolina = '0';
		$fecha_inicial = '00000000';
		$fecha_final ='00000000';
		$co_modelo_auto = '0';
		$co_tipo_auto = '0';
		$co_kilomettraje = '0';
		$co_monto_gasolina = '0';
		$motivo_gasolina = '';
		$co_ruta = '';	
		if(isset($_POST['addGasolina'])){			
			$co_modelo_auto = $_POST['select_modelo'];
			$co_kilomettraje = $_POST['kilometraje'];
			$co_monto_gasolina = limpiaFormato($_POST['monto_gasolina']);			
			$co_ruta = $_POST['ruta_detallada'];	
			switch($_POST['select_tipo_auto']){
				case 1 : $co_tipo_auto = "Pool/Rentado" ;	
					break;
				case 2 : $co_tipo_auto = "Particular" ;	
					break;
				case 3 : $co_tipo_auto = "Asignado" ;	
					break;					
			}			
		}
		
		//valores para una comprobacione de gasolina
		if(isset($_POST['comprobacionGasolina'])){
			if(($_POST['comprobacionGasolina'])==1){
				$co_gasolina = "1";
				$idTramite2 = "0";
				$total_anticipo = "0";							
				$fecha_inicial = $_POST['fecha_inicial'];
				$fecha_final = $_POST['fecha_final'];
				$motivo_gasolina = $_POST['motivo'];	
			}
		}	
		
		//actualiza o crea una nueva comprobacion
		$idComprobacion = '';
		
		
		if($actualizacion_comp==0){
			//crea el tramite
			$idTramite = $tramite->Crea_Tramite($iduser, $idempresa, COMPROBACION_ETAPA_SIN_ENVIAR, FLUJO_COMPROBACION, $motivoComprobacion, $delegado);
			//Genera la nueva etiqueta de las comprobaciones
			
			$cnn = new conexion();
			$query = "SELECT t_etiqueta FROM tramites WHERE t_id = ".$idTramite2;
			$res = mysql_query($query);
			$row = mysql_fetch_assoc($res);
			$motivoComprobacion = $idTramite2." - ".$row['t_etiqueta'];
			if(($_POST['comprobacionGasolina'])==1){
				$motivoComprobacion = $motivo_gasolina;
			}
			$query = "UPDATE tramites SET t_etiqueta = '".$motivoComprobacion."'  WHERE t_id = ".$idTramite;
			$res = mysql_query($query);
			//agrega la comprobacion
			$tramite=new Tramite();
			$tramite->Load_Tramite($idTramite);
			$duenoObser=new Usuario();
			$duenoObser->Load_Usuario_By_ID($tramite->Get_dato("t_iniciador"));
			
			$idComprobacion = Add_new_comprobacion($idTramite2, $idTramite,$centroCosto, "", $observ,$totalComprobaciones,$total_anticipo,$anticipoCompAutBMW,$personalDescontar,$amexCompAutBMW,$efectivoCompAutBMW,$montoDescontar,$montoReembolsar,$co_gasolina,$fecha_inicial,$fecha_final,$motivo_gasolina,$co_tipo_auto,$co_modelo_auto,$co_kilomettraje,$co_monto_gasolina,$co_ruta,$amexExterno);
		}elseif($actualizacion_comp==1){
			if(($_POST['comprobacionGasolina'])==1){
				$query = "UPDATE tramites SET t_etiqueta = '".$motivo_gasolina."'  WHERE t_id = ".$idTramite;
				$res = mysql_query($query);
			}
			$idComprobacion = updateComprobacion($idTramite,$centroCosto, "", $observ,$totalComprobaciones,$total_anticipo,$anticipoCompAutBMW,$personalDescontar,$amexCompAutBMW,$efectivoCompAutBMW,$montoDescontar,$montoReembolsar,$co_gasolina,$fecha_inicial,$fecha_final,$motivo_gasolina,$co_tipo_auto,$co_modelo_auto,$co_kilomettraje,$co_monto_gasolina,$co_ruta,$amexExterno);
		}
		
		// Si es un guardado previo y el usuario a modificado algï¿½n cargo AMEX, se reestablecen los cargos anteriores
		$query = "UPDATE amex a
		LEFT JOIN empleado e1 ON tarjeta = e1.notarjetacredito
		LEFT JOIN empleado e2 ON tarjeta = e2.notarjetacredito_gas
		LEFT JOIN usuario u1 ON u1.u_id = e1.idfwk_usuario
		LEFT JOIN usuario u2 ON u2.u_id = e2.idfwk_usuario
		SET comprobacion_id = '0' WHERE a.comprobacion_id = '".$idComprobacion."'";
		error_log($query);
		$cnn->ejecutar($query);
		
		//devuelve aquellas transacciones en estatus 3 a 1 cuando se han confirmado
		//$cnn = new conexion();
		$query_estatus_dev = "UPDATE amex a
			LEFT JOIN empleado e1 ON tarjeta = e1.notarjetacredito
			LEFT JOIN empleado e2 ON tarjeta = e2.notarjetacredito_gas
			LEFT JOIN usuario u1 ON u1.u_id = e1.idfwk_usuario
			LEFT JOIN usuario u2 ON u2.u_id = e2.idfwk_usuario
			SET a.estatus = 1 
			WHERE a.estatus = 3 AND u1.u_id = ".$iduser."
			OR a.estatus = 3 AND u2.u_id = ".$iduser;
		//error_log($query_estatus_dev);
		$cnn->ejecutar($query_estatus_dev);
		
        // Guarda los detalles de la comprobacion
        $totalComprobado = 0;
        $status_c = 1;
		//Agregar detalles de comprobacion
		limpiar_detalles($idTramite); 		
		limpiar_excepciones($idTramite);
		
		// Lamada al Historial de observaciones
		$tramite->Load_Tramite($idTramite);
		$t_historial_autorizaciones = $tramite->Get_dato("t_autorizaciones_historial");

		if($etapaTramiteComprobacion == COMPROBACION_ETAPA_RECHAZADA || $etapaTramiteComprobacion == COMPROBACION_ETAPA_RECHAZADA_POR_DIRECTOR || $t_historial_autorizaciones != "" || $etapaTramiteComprobacion == COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){
			$HObser = $_POST['campo_historial'];
		}else{
			$HObser = "";
		}
		
		//modificar partidas
		//error_log("cuantas partidas cargadas......".$_POST['rowCountCecos']);
		//Elimin
		$j=0;
		$k=0;
		$l=0;
		$montoTotalCargoAmex = 0;
		for ($i = 1; $i <= $_POST['rowCountCecos']; $i++){
			$cargo_asociado = $_POST["tipoComprobacion".$i];
			$idAmex = $_POST["idAmex".$i];
			$no_transaccion = $_POST["no_transaccion".$i];
			$conceptoBMW = $_POST["numConcepto".$i];
			$tipoComida = $_POST["tipo_comida".$i];
			$monto = limpiaFormato($_POST["mnt".$i]);
			$tipoDivisa = intval($_POST["tipoDivisa".$i]);
			$iva = limpiaFormato($_POST["pimpuesto".$i]);
			$total = limpiaFormato($_POST["tot".$i]);
			$totalDolares = limpiaFormato($_POST["totalDolares".$i]);
			$comentario = $_POST["comentario".$i];
			$no_asistentes = $_POST["no_asistentes".$i];
			$fecha = $_POST["fecha".$i];
			$flag_factura = $_POST["flag_factura".$i];
			$proveedor = $_POST["proveedor".$i];
			$excepcion = $_POST["exConcepto".$i];
			$diferencia = limpiaFormato($_POST["difConcepto".$i]);
			// ID proveedor
            $cnn = new conexion();
			$query = sprintf("SELECT pro_id FROM proveedores WHERE pro_rfc = '%s'", $_POST["rfc".$i]);
			//error_log($query);
            $rst = $cnn->consultar($query);
            $fila = mysql_fetch_assoc($rst);
            $idProv = $fila["pro_id"];
            
            if($idProv != ""){
                $idProv = $idProv;
            }else{
                $idProv = 0;
			}
			
			$rfc = $_POST["rfc".$i];
			if($rfc == "N/A"){
				$rfc="";
			}
			if($proveedor == "N/A"){
				$proveedor='0';
			}
			if($no_asistentes == "N/A"){
				$no_asistentes=0;
			}
			$propina = limpiaFormato($_POST["propina".$i]);
			if($propina == "N/A"){
				$propina=0;
			}
			if($flag_factura == "N/A"){
				$flag_factura="";
			}
			if($no_transaccion == "N/A"){
				$no_transaccion=0;
			}
			if($idAmex == "N/A"){
				$idAmex =0;
			}
			$impuesto_hospedaje = limpiaFormato($_POST["impuesto_hospedaje".$i]);
			if($impuesto_hospedaje == "N/A"){
				$impuesto_hospedaje=0;
			}
			$totalMxn = limpiaFormato($_POST["totalMxn".$i]);
			 // Detalle Comprobaciï¿½n 
			$idDetalleComp = Add_detalle($idComprobacion,$cargo_asociado,$idAmex,$no_transaccion,$conceptoBMW,$tipoComida,$monto,$tipoDivisa,$iva,$total,$totalDolares,$comentario,$no_asistentes,$fecha,$flag_factura,$proveedor,$idProv,$rfc,$propina,$impuesto_hospedaje,$totalMxn);		
			//Inserccion de excepciones de tipo alimento,hotel y lavanderia a nivel detalle de comprobacion.
			ingresarExcepcionDetalle($conceptoBMW,$excepcion,$diferencia,$idDetalleComp,$idComprobacion);
			// Asociamos el cargo AMEX a la Comprobaciï¿½n
			setComprobacionid($idAmex, $idComprobacion);
		}
				
 		//Inserccion de excepciones a nivel comprobacion
		//1.-Alimentos
		addExcepcionAlimento($_POST['mensaje_excepcion_ViajeA'], $_POST['dif_ViajeA'], $idComprobacion);
		//2.-Hospedaje
		addExcepcionHospedaje($_POST['mensaje_excepcion_ViajeH'], $_POST['dif_ViajeH'], $idComprobacion);
		//3.-Lavanderia	
		addExcepcionLavanderia($_POST['mensaje_excepcion_ViajeL'], $_POST['dif_ViajeL'], $idComprobacion);		
		//4.-Gasolina
		if($_POST['dif_gasolina']!="")
			Add_excepcion($_POST['mensaje_excepcion_gasolina'], limpiaFormato($_POST['dif_gasolina']),'0', $idComprobacion,'0');		
		
			if(!isset($_POST['guardarPrev'])){
				//error_log("aqui entra para generar ruta............<");				
				$delegados = new Delegados();
				$existeDelegado = $delegados->existenciaDelegado($iduser, $delegado);
				
				if($existeDelegado){
					//Se agrega la observacion tambiï¿½n a la tabla de observaciones
					$duenoActual = new Usuario();
					$duenoActual->Load_Usuario_By_ID($delegado);
					$nombreUsuario = $duenoActual->Get_dato('nombre');
					 
					$iniciador = $tramite->Get_dato("t_iniciador");
					
					if($observ != ""){
						$notificacion = new Notificacion();
						$observ = $notificacion->anotaObservacion($delegado, $HObser, $observ, FLUJO_COMPROBACION, COMPROBACION_ETAPA_EN_APROBACION_POR_DIRECTOR);
						$sql = sprintf("UPDATE comprobaciones SET co_observaciones = '%s', co_observaciones_edicion = '' WHERE co_mi_tramite = '%s'", $observ, $idTramite);
						$res = $cnn->ejecutar($sql);
					}else{
						$sql = sprintf("UPDATE comprobaciones SET co_observaciones = '%s', co_observaciones_edicion = '' WHERE co_mi_tramite = '%s'", $HObser, $idTramite);
						$res = $cnn->ejecutar($sql);
					}
					
					if( $tramite->Get_dato("t_etapa_actual") == COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){
						$duenoActual = new Usuario();
						$duenoActual->Load_Usuario_By_ID($iniciador);
						$nombreUsuario = $duenoActual->Get_dato('nombre');
						$remitente = $remitente;
						$destinatario = 2000;
						$mensaje = sprintf("La Comprobaci&oacute;n de Viaje <strong>%05s</strong> ha sido <strong>CREADA</strong> por: <strong>%s</strong> y requiere de su autorizaci&oacute;n.", $idTramite, $nombreUsuario);
						$tramite->Modifica_Etapa($idTramite, COMPROBACION_ETAPA_EN_APROBACION, FLUJO_COMPROBACION, 2000, "");
						$tramite->EnviaNotificacion($idTramite, $mensaje, $remitente, $destinatario, "0", ""); //"0" para no enviar email y "1" para enviarlo
					}else{
						$tramite->Modifica_Etapa($idTramite, COMPROBACION_ETAPA_EN_APROBACION_POR_DIRECTOR, FLUJO_COMPROBACION, $iduser,"");
						$mensaje = sprintf("La Comprobaci&oacute;n de Viaje <strong>%05s</strong> ha sido <strong>CREADA</strong> por: <strong>%s</strong> en su nombre y requiere de su autorizaci&oacute;n.", $idTramite, $nombreUsuario);
						 
						$remitente = $delegado;
						$destinatario = $iduser;
						$tramite->EnviaNotificacion($idTramite, $mensaje, $remitente, $destinatario, "1", ""); //"0" para no enviar email y "1" para enviarlo
					}
				}else{
					$rutaautorizacion=new RutaAutorizacion();
					$rutaautorizacion->generaRutaAutorizacionComprobacionViaje($idTramite, $iduser);
					$aprobador=$rutaautorizacion->getSiguienteAprobador($idTramite,$iduser);
					$duenoActual = new Usuario();
					$duenoActual->Load_Usuario_By_ID($iduser);
					$nombreUsuario = $duenoActual->Get_dato('nombre');
					
					if($sesionDelegado != 0){
						$duenoActual->Load_Usuario_By_ID($delegado);
						$nombreDelegado = $duenoActual->Get_dato('nombre');
						$mensaje = sprintf("La Comprobaci&oacute;n de Viaje <strong>%05s</strong> ha sido <strong>CREADA</strong> por: <strong>%s</strong> en nombre de: <strong>%s</strong> y requiere de su autorizaci&oacute;n.", $idTramite, $nombreDelegado, $nombreUsuario);
						$mensaje_email = sprintf("La Comprobaci&oacute;n de Viaje <strong>CREADA</strong> por: <strong>%s</strong> en nombre de: <strong>%s</strong> y requiere de su autorizaci&oacute;n.", $nombreDelegado, $nombreUsuario);
					}else{
						$mensaje = sprintf("La Comprobaci&oacute;n de Viaje <strong>%05s</strong> ha sido <strong>CREADA</strong> por: <strong>%s</strong> y requiere de su autorizaci&oacute;n.", $idTramite, $nombreUsuario);
						$mensaje_email = sprintf("La Comprobaci&oacute;n de Viaje <strong>CREADA</strong> por: <strong>%s</strong> requiere de su autorizaci&oacute;n.", $nombreUsuario);
					}
					
					$remitente = $iduser;
					$tramite=new Tramite();
					$tramite->Load_Tramite($idTramite);
					if( $tramite->Get_dato("t_etapa_actual") == COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){
						$destinatario = 2000;
						$tramite->Modifica_Etapa($idTramite, COMPROBACION_ETAPA_EN_APROBACION, FLUJO_COMPROBACION, 2000, "");
						$tramite->EnviaNotificacion($idTramite, $mensaje, $remitente, $destinatario, "0", $mensaje_email); //"0" para no enviar email y "1" para enviarlo
					}else{
						$existeDelegado = $delegados->existenciaDelegado($iduser, $delegado);
						$destinatario = $aprobador;
						$tramite->EnviaNotificacion($idTramite, $mensaje, $remitente, $destinatario, "1", $mensaje_email); //"0" para no enviar email y "1" para enviarlo
						$tramite->Modifica_Etapa($idTramite, COMPROBACION_ETAPA_EN_APROBACION, FLUJO_COMPROBACION, $aprobador, "");
						if(!$existeDelegado){
		    				//Si el previo lo genero un delegado, pero la solicitud, la envio el Director, borraremos el id del delegado que realizo el previo.
		    				$tramite->actualizaDelegado($idTramite, 0);
		    			}else{
		    				//Si el previo lo genero un delegado, pero la solicitud, la envio el Director, y en un rechazo la envio el delegado, se guardarï¿½ nuevamente el id del delegado.
		    				$tramite->actualizaDelegado($idTramite, $delegado);
		    			}
					}
					
					if($observ != ""){
						$notificacion = new Notificacion();
						$observ = $notificacion->anotaObservacion($iduser, $HObser, $observ, FLUJO_COMPROBACION, COMPROBACION_ETAPA_EN_APROBACION_POR_DIRECTOR);
					}else{
						$observ = $HObser;
					}
					
					$sql = sprintf("UPDATE comprobaciones SET co_observaciones = '%s', co_observaciones_edicion = '' WHERE co_mi_tramite = '%s'", $observ, $idTramite);
					$res = $cnn->ejecutar($sql);
				}
			}else{
				// Guardar las observaciones que haya ingresado el usuario
				$sql = sprintf("UPDATE comprobaciones SET co_observaciones = '%s', co_observaciones_edicion = '%s' WHERE co_mi_tramite = '%s'", $HObser, $observ, $idTramite);
				$res = $cnn->ejecutar($sql);
				
				$tramite->Modifica_Etapa($idTramite, COMPROBACION_ETAPA_SIN_ENVIAR, FLUJO_COMPROBACION, $iduser, "");						
			}
       
		//exit;
        // Termina transacciï¿½n
        $tramite->insertar("COMMIT");
		if($_POST['guardarPrev']){
			header("Location: ./index.php?oksaveprev");
		}else{
			header("Location: ./index.php?oksave");									
		}		
    }else{
        header("Location: ./index.php?errsave");		
        die();
    }//if row	
}//if guarda comp

//*****************************//COMPROBACION DE VIAJE//*****************************//// </editor-fold>
if (isset($_GET['new'])) {
	require_once("$RUTA_A/functions/utils.php");
    function forma_comprobacion() {
        ?>
	
        <!-- Inicia forma para comprobaciï¿½n -->
        <script language="JavaScript" src="../../lib/js/jquery/jquery-1.3.2.js" type="text/javascript"></script>
        <script language="JavaScript" src="../../lib/js/jquery/jquery.date_input.js" type="text/javascript"></script>        
        <script language="JavaScript" src="../../lib/js/jquery/jquery.bgiframe.js" type="text/javascript"></script>
        <script language="JavaScript" src="../../lib/js/jquery/jquery.tableEditor.js" type="text/javascript"></script>
        <script language="JavaScript" src="../../lib/js/jquery/jquery.fadeSliderToggle.js" type="text/javascript"></script>
        <script language="JavaScript" src="../../lib/js/jquery/jquery.blockUI.js" type="text/javascript"></script>
        <script language="JavaScript" src="../../lib/js/formatNumber.js" type="text/javascript"></script>
		<script language="JavaScript" src="../../lib/js/jqueryui/jquery-ui.min.js"></script>		
		<script language="JavaScript" src="../../lib/js/jquery/jquery.autocomplete.js" type="text/javascript"></script>
		<script language="JavaScript" src="../solicitudes/js/solicitud_viaje.js" type="text/javascript"></script>
		<script language="JavaScript" src="js/utilities.js" type="text/javascript"></script>
		<script language="JavaScript" src="js/backspaceGeneral.js" type="text/javascript"></script>
		
        <script language="JavaScript" type="text/javascript">
            //variables
            var doc;
            var validaFactura=1;
            var flagSolicitud=0;
            var validaCeco=0;
			var estatus_en_edicion_de_comprobacion = false;
			var partidaEdicion = 0;
			
			var concepto_fecha_monto = new Array();
			var bandera = false;
			var indiceGlobal = 0;
			var conceptoId =0;
			var conceptoNombre="";
			var idComida = "";
			var tramiteId = 0;
			var total=0;
			var montoMax=0;
			var prv = document.getElementById('proveedor_form');

			//variables importantes conceptos (Alimentos/Hoteles/Lavanderia)
			var cCObligatorio = 0;
			var parametroDiarioAlimento=0;
			var parametroDiarioHotel=0;
			var parametroDiarioLavanderia=0;
			var divisaAlimento=0;	
			var divisaHotel=0;
			var divisaLavanderia=0;
			var conceptoAEliminar=0;
			var fechaSeleccionada = "";
            doc = $(document);
            doc.ready(inicializarEventos);//cuando el documento estï¿½ listo            
			
			var arreglovalores=new Array();
			var arregloestatus=new Array();
			var arreglodescripcion=new Array();
		
		
			//genera las filas para cargar el previo
			function agregarfila_de_basedatos(datos){
				var frm=document.detallecomp;
				
				//Busca el ultimo ID de las partidas y le sumamos uno para el siguiente
				var id = parseInt($("#comprobacion_table>tbody >tr").length);
				if(isNaN(id)){
					id = 1;
				}else{
					id+= parseInt(1);
				}
				
				var tipoComprobacion_db;
				//busca tipo de comprobacion	
				if (datos.tipo_bd == 1){
					tipoComprobacion_db = "Anticipo";
				}else if(datos.tipo_bd == 2){
					tipoComprobacion_db = "Amex";
				}else if(datos.tipo_bd == 3){
					tipoComprobacion_db = "Reembolso";
				}else if(datos.tipo_bd == 4){
					tipoComprobacion_db = "Amex externo";
				}

				//Se obtiene el concepto de tipo Alimentos:Para seguir con la validacion
				var conceptoABuscar=/Alimentos/g;
				var conceptoBD ="";				
				if(conceptoABuscar.test(datos.concepto_db)){
					conceptoBD = "Alimentos";
				}else{
					conceptoBD=datos.concepto_db;
				}				
						
				var aux = "N/A";
				var nuevaFila = '<tr>';
			
				nuevaFila+="<td>"+"<div id='renglonS"+id+"'>"+id+"</div>"+"<input type='hidden' name='row"+id+"' id='row"+id+"' value='"+id+"' readonly='readonly' /></td>";
				nuevaFila+="<td>"+"<input type='hidden' name='cargo_asociado"+id+"'id='cargo_asociado"+id+"' value='"+tipoComprobacion_db+"'readonly='readonly' />"+tipoComprobacion_db + "<input type='hidden' name='cargo_factura"+id+"'id='cargo_factura"+id+"' value='"+datos.cargo_factura_db+"' readonly='readonly' />" +"<input type='hidden' name='tipoComprobacion"+id+"'id='tipoComprobacion"+id+"' value='"+ datos.tipo_bd +"'readonly='readonly' /></td>";
				nuevaFila+="<td>" + "<input type='hidden' name='no_transaccion"+id+"'id='no_transaccion"+id+"' value='"+ datos.transaccion_bd +"'readonly='readonly' />"+ datos.transaccion_bd +"</td>";
				nuevaFila+="<td>"+"<input type='hidden' name='fecha"+id+"' id='fecha"+id+"' value='"+datos.fecha_db+"' readonly='readonly' />"+datos.fecha_db+"</td>";
				nuevaFila+="<td>"+"<input type='hidden' name='tipo_comida"+id+"' id='tipo_comida"+id+"' value='"+datos.tipoComida_db+"' 	readonly='readonly' />"+"<input type='hidden' name='concepto"+id+"' id='concepto"+id+"' value='"+conceptoBD+"' 	readonly='readonly' />"+datos.concepto_db+"</td>";
				nuevaFila+="<td>"+"<input type='hidden' name='comentario"+id+"' id='comentario"+id+"' value='"+datos.comentario_db+"' readonly='readonly' />"+datos.comentario_db+"</td>"; 
				nuevaFila+="<td>"+"<input type='hidden' name='no_asistentes"+id+"' id='no_asistentes"+id+"' value='"+datos.asistentes_db+"' readonly='readonly' />"+datos.asistentes_db+"</td>";
				nuevaFila+="<td>"+"<input type='hidden' name='rfc"+id+"' id='rfc"+id+"' value='"+datos.rfc_db+"' readonly='readonly' />"+datos.rfc_db+"</td>";
				nuevaFila+="<td>"+"<input type='hidden' name='proveedor"+id+"' id='proveedor"+id+"' value='"+datos.proveedor_db+"' readonly='readonly' />"+datos.proveedor_db+"</td>";
				nuevaFila+="<td>"+"<input type='hidden' name='flag_factura"+id+"' id='flag_factura"+id+"' value='"+datos.factura_db+"' readonly='readonly' />"+datos.factura_db+"</td>";
				nuevaFila+="<td id='m'>"+"<input type='hidden' name='mnt"+id+"' id='mnt"+id+"' value='"+datos.monto_db+"' readonly='readonly' />"+datos.monto_db+"</td>"; 
				nuevaFila+="<td>"+"<input type='hidden' name='pimpuesto"+id+"' id='pimpuesto"+id+"' value='"+datos.iva_db+"' readonly='readonly' />"+datos.iva_db+"</td>"; 
				nuevaFila+="<td>"+"<input type='hidden' name='propina"+id+"' id='propina"+id+"' value='"+datos.propinas_db+"' readonly='readonly' />"+datos.propinas_db+"</td>"; 					
				nuevaFila+="<td><input type='hidden' name='impuesto_hospedaje"+id+"' id='impuesto_hospedaje"+id+"' value='"+datos.impHos_db+"' readonly='readonly' />"+datos.impHos_db+"</td>"; 
				nuevaFila+="<td>"+"<input type='hidden' name='tot"+id+"' id='tot"+id+"' value='"+datos.total_db+"' readonly='readonly' />"+datos.total_db+"<input type='hidden' name='mensaje"+id+"' id='mensaje"+id+"' value='0' readonly='readonly' />"+"<input type='hidden' name='diferencia"+id+"' id='diferencia"+id+"' value='0' readonly='readonly' /></td>";
				nuevaFila+="<td>"+"<input type='hidden' name='divisa"+id+"' id='divisa"+id+"' value='"+datos.divisaTipo_db+"' readonly='readonly' />"+"<input type='hidden' name='tipoDivisa"+id+"' id='tipoDivisa"+id+"' value='"+datos.divisa_db+"' readonly='readonly' />"+datos.divisaTipo_db+"</td>";  
				nuevaFila+="<td>"+"<input type='hidden' name='totalMxn"+id+"' id='totalMxn"+id+"' value='"+datos.totalPesos_db.replace(",","")+"' readonly='readonly' />"+datos.totalPesos_db+"</td>";  
				nuevaFila+="<td>"+"<div align='center'><img src='../../images/addedit.png' alt='Click aqu&iacute; para editar Comprobacion' name='"+id+"edit' id='"+id+"edit' onclick='editarComprobacion(this.id);' style='cursor:pointer'/></div><div align='center'>Editar Partida</div></td>";
				nuevaFila+="<td>"+"<div align='center'><img class='elimina' src='../../images/delete.gif' alt='Click aqu&iacute; para Eliminar' name='"+id+"del' id='"+id+"del' onmousedown='borrarRenglonComprobacion(this.id,\"comprobacion_table\",\"rowCount\",\"rowDel\",\"renglonS\",\"edit\",\"del\",\"itinerarioActualOPosible\");' onclick='conceptoElimina(this.id); reiniciaComentarioObligatorio();' style='cursor:pointer;' /></div><div class='del_part' id='del_part"+id+"' align='center'>Eliminar Partida</div></td>";
				nuevaFila+= "<input type='hidden' id='idAmex"+id+"' name='idAmex"+id+"' value='"+datos.idamex_db+"' readonly='readonly'/>"+"<input type='hidden' id='totalDolares"+id+"' name='totalDolares"+id+"' value='"+datos.totalUsd_db+"' readonly='readonly'/>"+"<input type='hidden' id='tipoComida"+id+"' name='tipoComida"+id+"' value='"+ datos.tipoComida_db +"' readonly='readonly'/>";
				nuevaFila+= "<input type='hidden' id='numConcepto"+id+"' name='numConcepto"+id+"' value='"+datos.conceptoId_db+"' readonly='readonly'/><input type='hidden' id='check"+id+"' name='check"+id+"' value='"+datos.tipoProveedor_db+"' readonly='readonly'/>";
				nuevaFila+= "<input type='hidden' id='tipoTarjeta"+id+"' name='tipoTarjeta"+id+"' value='"+datos.tipoTarjeta_db+"' readonly='readonly'/>"+"<input type='hidden' id='listaCargo"+id+"' name='listaCargo"+id+"' value='"+datos.idamex_db+"' readonly='readonly'/>";
				nuevaFila+= "<input type='hidden' id='exConcepto"+id+"' name='exConcepto"+id+"' value='' readonly='readonly'/>";
				nuevaFila+= "<input type='hidden' id='difConcepto"+id+"' name='difConcepto"+id+"' value='0' readonly='readonly'/>";
				nuevaFila+= "<input type='hidden' id='idDetalleComp"+id+"' name='idDetalleComp"+id+"' value='"+datos.detalleID+"' readonly='readonly'/>";
				nuevaFila += '</tr>';
				$("#comprobacion_table").append(nuevaFila);
			}

			function excepcionEdit(id_tramiteEdicion){			
				$.ajax({
					type: "POST",
					url: "services/Ajax_comprobacion.php",
					data: "idTramiteExc="+id_tramiteEdicion,
					dataType: "json",
					timeout: 10000,
					success: function(json){						
						partidas = json.length;
						 for(var i = 0; i < partidas; i++){							
							 $('#exConcepto'+(i+1)).val(json[i].ex_mensaje);
							 $('#difConcepto'+(i+1)).val(json[i].dif_exc);							
						 }
					},
					complete: function (json){
						$.unblockUI();
						recalcula();
					},
					error: function(x, t, m){
						if(t==="timeout") {
							location.reload();
							abort();
						}
					 }
				});				
			}
						
			//Funcion para cargar los datos del tramite dado en el formulario de nueva solicitud de viaje.
			function fillform(id_tramite){
				$.ajax({
					type: "POST",
					url: "services/Ajax_comprobacion.php",
					data: "id_tramite_comp_prev="+id_tramite,
					dataType: "json",
					timeout: 10000,
					success: function(json){
						var no_partidas=0; 
						if(json != null){
							no_partidas = json.length;
							for(var i=1;i<no_partidas;i++){
								agregarfila_de_basedatos(json[i]);																
							}
							$("#rowCount").val(no_partidas-1);							
							$("#rowCountCecos").val(no_partidas-1);		
						}
					},complete:function(json){						
						//extraer excepciones de detalle
						excepcionEdit(id_tramite);
						obtenerTramite();
						verificarEstatusAmex(id_tramite);
					},
					error: function(x, t, m){
						if(t==="timeout") {
							location.reload();
							abort();
						} 
					 }
				});
			}
			
            function inicializarEventos(){
				var frm=document.detallecomp;						
				$("#proveedor_form").draggable({containment:"#Interfaz",scroll:false});
				$("#ventanaGasolina").draggable({containment:"#Interfaz",scroll:false});
				//si la pantalla es edicion toma el tramite para construir el previo
				if($("#cargar_com_viaje").val() == '1'){
					$.blockUI({
						message: '<h1>Espere un momento...</h1>',
						css:{
							border: 'none', 
							padding: '15px', 
							backgroundColor: '#000', 
							'-webkit-border-radius': '10px', 
							'-moz-border-radius': '10px', 
							opacity: .5, 
							color: '#fff'
						}
					});
					
					var id_tramite = $("#id_tramite").val();
					fillform(id_tramite);																				
				}
				
                //genera la lista de sugerencia: nombre proveedor
                $("#proveedor").autocomplete("services/catalogo_proveedores.php", {				
                    minChars:2,
                    matchSubset:1,
                    matchContains:1,
                    cacheLength:false,
                    onItemSelect:seleccionaItem2,
                    onFindValue:buscaRFC,
                    formatItem:arreglaItem,
                    autoFill:false,
                    extraParams:{tip:1}
					//maxItemsToShow:5
                });//fin autocomplete

                //genera la lista de sugerencia: rfc proveedor
                $("#rfc").autocomplete("services/catalogo_proveedores.php", {				
                    minChars:1,
                    matchSubset:1,
                    matchContains:1,
                    cacheLength:false,
                    onItemSelect:seleccionaItem,
                    onFindValue:buscaProveedor,
                    formatItem:arreglaItem,
                    autoFill:false,
                    extraParams:{tip:2}
					// maxItemsToShow:5
                });//fin autocomplete
                                                                                                                                                                    
                if(navigator.appName!='Netscape'){			
                    document.getElementById('msg_div').style.width="800px";
                    document.getElementById('msg_div').style.height="300px";
                    document.getElementById('msg_div').style.top="25%";
                    document.getElementById('msg_div').style.left="18.5%";
                }
                supervisar_status_idamex();                                                                                                            
  
				$('#fecha_inicial').keydown(function(e){					
					ignoraEventKey(e);				
				});
				
				$('#fecha_final').keydown(function(e){
					ignoraEventKey(e);				
				});
				
				$('#fecha').keydown(function(e){
					ignoraEventKey(e);				
				});

				$("input").bind("keydown", function(e){
    				if(!isAlphaNumeric(e)) return false;
    			});

				//funcion para limitar comentarios del gasto a 36 caracteres
				 $('#referencia_corta').keyup(function(){  
					 var limit = parseInt($(this).attr('maxlength')); 
					 var text = $(this).val(); 
					 var chars = text.length; 
					 if(chars > limit){  	             
				            var new_text = text.substr(0, limit);              
				            $(this).val(new_text);	            
				        } 
			   });

				/*
				 * Impedimos que salga de la pantalla al teclear el backspace en algï¿½n botï¿½n
				 */
				// Botones de Acciï¿½n 
				$('#guardarPrev').focus(function(){
					confirmaRegreso('guardarPrev');
				});

				$('#guardarComp').focus(function(){
					confirmaRegreso('guardarComp');
				});

				// Botones Ventana de Gasolina 
				$('#addGasolina').focus(function(){
					confirmaRegreso('addGasolina');
				});

				$('#cancelarGasolina').focus(function(){
					confirmaRegreso('cancelarGasolina');
				});

				//Boton relacionados al proveedor
				
				$('#agregar').focus(function(){
					confirmaRegreso('agregar');
				});

				$("#new_proveedor").bind("keydown", function(e){					
					if(!isAlphaNumericRFC(e)) return false;
				});

				$("#new_p_rfc").bind("keydown", function(e){					
					if(!isAlphaNumericRFC(e)) return false;
				});

				$("#rfc").bind("keydown", function(e){					
					if(!isAlphaNumericRFC(e)) return false;
				});				
				
            }//fin ready ï¿½ inicializarEventos      
			
			function verificaEstatus(){
				<?PHP if(isset($_GET['edit'])){ ?>
					var tramite = <?PHP echo $_GET['edit']; ?>;
					var valorJson = 0;
					$.ajax({      
				        type: "POST",
				        url: "services/Ajax_comprobacion.php",
				        data: "getStatus="+tramite,
				        dataType: "json",
				        timeout: 10000,
				        success: function(json){
				        	valorJson = json;
				        },complete: function(json){
				        	if(valorJson == 1){
								bandera = true;
								$("#guardarComp").removeAttr("disabled");
								$("#aux1").val($("#sol_select option:selected").val());
								$("#aux2").val($("#ccentro_costos option:selected").val());							
								$("#sol_select").attr("disabled","true");
								$("#tipo").attr("disabled","true");
								$("#registrar_comp").attr("disabled","true");
								$("#ccentro_costos").attr("disabled","true");
								$("#guardarPrev").attr("disabled","true");
								$("#aux1").attr("name","sol_select");
								$("#aux1").attr("id","sol_select");
								$("#aux2").attr("name","ccentro_costos");
								$("#aux2").attr("id","ccentro_costos");
							}else{
								// Habilitar botones de guardado 
								$("#guardarComp").removeAttr("disabled");
								$("#guardarPrev").removeAttr("disabled");

								$("#sol_select").removeAttr("disabled");
								$("#tipo").removeAttr("disabled");
								$("#ccentro_costos").removeAttr("disabled");
								$("#select_concepto").removeAttr("disabled");
								$("#fact_chk").removeAttr("disabled");
								$("#moneda").removeAttr("disabled");
								$("#monto").removeAttr("disabled");				
								$("#fecha").removeAttr("disabled");
								$("#referencia_corta").removeAttr("disabled");
							}
					    },
						error: function(x, t, m) {
							if(t==="timeout") {
								location.reload();
								abort();
							}
						}
					});		
				<?PHP }?>
			}
			
            function verificaFactura(){
                var frm=document.detallecomp;	
                if (frm.fact_chk.checked){
                    validaFactura=1;
                    $("#factura_form").slideDown(1000);
                    $("#factura_form").css("display","block");
                    $("#rfc_prov_busq_div").html("RFC<span class='style1'>*</span>: ");
                    $("#name_prov_busq_div").html("Raz"+arrayAcentos["o"]+"n Social<span class='style1'>*</span>: ");
                    $("#div_folio").html("Folio Factura<span class='style1'>*</span>: ");
                    frm.d_folio.disabled=false;                    
                }else{
                    validaFactura=0;
                    $("#factura_form").slideUp(1000);
                    frm.d_folio.disabled=true;
					$("#rfc").val('');
					$("#d_folio").val('');
					$("#proveedor").val('');                    
                }
            }

			function actualiza_status_idamex(idamex, estado){				
				$.ajax({
                  url:  "services/Ajax_comprobacion.php",
                  type: "POST",
                  data: "idamex="+idamex+"&status="+estado,
                  dataType: "json",
                  async: false,
                  timeout: 10000, 
                  success: function(json){},
				  complete: function(json){
					  verificar_tipo_tarjeta();
				  },
                  error: function(x, t, m){
						if(t==="timeout"){
							actualiza_status_idamex(idamex, estado);
						}
					}
                });//fin ajax
			}

			function devolver_status_idamex(idamex_dev){				
				$.ajax({
	            	url:  "services/Ajax_comprobacion.php",
	                type: "POST",
	                data: "idamex_dev="+idamex_dev,
	                dataType: "json",
	                async: false,
	                timeout: 10000,
	                success: function(json){},
	                complete: function(json){
	                	verificar_tipo_tarjeta();
	                },
	                error: function(x, t, m){
						if(t==="timeout"){
							devolver_status_idamex(idamex_dev);
						}
					}	               	                
	            });//fin ajax
			}

			function supervisar_status_idamex(){	
				var usuario = <?PHP echo $_SESSION["idusuario"];?>;
				$.ajax({
	            	url:  "services/Ajax_comprobacion.php",
	                type: "POST",
	                data: "idamex_ini=3&usuario="+usuario,
	                dataType: "json",
	                async: false,
	                timeout: 10000,
	                success: function(){verificar_tipo_tarjeta();
	                },
	                complete:function(){
	                	borrarPartida();                
	                    guardaComprobacion();
	    				muestraValoresGasolina();
			        },
			        error: function(x, t, m) {
						if(t === "timeout") {
							supervisar_status_idamex();
						}
					}
	            });//fin ajax 
			}
			
			function seleccionar_centro_de_costos(valor){
				var frm=document.detallecomp;
				if(valor > 0 ){
					frm.tipo.disabled=false;
					frm.ccentro_costos.disabled=false;
					frm.select_concepto.disabled=false;
					frm.fact_chk.disabled=false;
					frm.moneda.disabled=false;
					frm.monto.disabled=false;					
					frm.fecha.disabled=false;
					frm.referencia_corta.disabled=false;
					$.ajax({
						type: "POST",
						url: "services/Ajax_comprobacion.php",
						data: "t_id3="+valor,
						dataType: "json",
						timeout: 1000,
						success: function(json){							
							if(json==null){															
							}else{
								/**Funcion que selecciona el CECO, de la solicitud en cuestion.**/
								seleccionar(json);	
							}
						},
						error: function(x, t, m) {
							if(t === "timeout") {
								location.reload();
								abort();
							}
						}
					});					
				}else if(valor == 0){
					frm.tipo.disabled=false;
					frm.ccentro_costos.disabled=false;
					frm.select_concepto.disabled=false;
					frm.fact_chk.disabled=false;
					frm.moneda.disabled=false;
					frm.monto.disabled=false;					
					frm.fecha.disabled=false;
					frm.referencia_corta.disabled=false;					
				}else{
					frm.tipo.disabled=true;
					frm.ccentro_costos.disabled=true;
					frm.select_concepto.disabled=true;
					frm.fact_chk.disabled=true;
					frm.moneda.disabled=true;
					frm.monto.disabled=true;					
					frm.fecha.disabled=true;
					frm.referencia_corta.disabled=true;
					frm.ccentro_costos[0].selected = true;
				}
			}
			
			//Seleccionar elemento de un combo
			function seleccionar(elemento) {
			   var Elemento = 0;			   			   			  				
			   var combo = document.detallecomp.ccentro_costos;
			   var cantidad = combo.length;			  
			   for (i = 1; i < cantidad; i++) {				   
				   Elemento = parseInt(combo[i].text);
				   if(Elemento == parseInt(elemento)){
					   combo[i].selected = true;
					   break;
				   }
			   }
			   getCentroCostos();
			}

			// muestra/oculta ventana emergente de comprobacion de gasolina
			function muestraVentanaGasolina(valor){		
				if (valor==1){					
					var no_partidas = $("#comprobacion_table>tbody>tr").length;
					var extra = (6.5*parseInt(no_partidas)-6.5); 
					var top = ($("#tipo").val() == 2) ? 150+extra+"%" : 115+extra+"%" ;					
					$("#ventanaGasolina").css("top", top);											
					$("#ventanaGasolina").css("visibility","visible");															
				}else{
					$("#select_tipo_auto").val('');	
					$("#select_modelo").val('');
					$("#kilometraje").val('');
					$("#monto_gasolina").val('');
					$("#ruta_detallada").val('');
					$("#ventanaGasolina").css("visibility","hidden");					
				}				
			} 
			
			//valida los  del detalle de gasolina
			function validaDatosGasolina(){
				if( ($("#select_tipo_auto").val() == -1) || ($("#select_modelo").val() == -1) || ($("#kilometraje").val() == '') || ($("#monto_gasolina").val() == '') ||  ($("#ruta_detallada").val() == '') || ($("#kilometraje").val() == '0')){
					alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");					
					return false;
				}else{					
					return validaExcepcionGasolina();
				}
			}
						
			<?PHP 
				$query = "SELECT pr_cantidad FROM parametro_regionbmw pr, parametrosbmw p WHERE p.p_id = pr.p_id AND p.p_id = 23";
				$res = mysql_query($query);
				$row = mysql_fetch_array($res);
				$politicaGasolina = $row['pr_cantidad'];
			?>			
			//validaGasolina	
			function validaExcepcionGasolina(){						
				if (confirm('Los datos ingresados en la pantalla no podrï¿½n modificarse posteriormente.')){			
					$("#sol_select").removeAttr("disabled");	
					var totalGasolina = 0;
					var gasolina = false;
					var numFilas = parseInt($("#comprobacion_table>tbody >tr").length);
					var excedente;
					var msg = "El total excede el monto por factor. La diferencia serï¿½ descontada vï¿½a nï¿½mina o no reembolsada";
					$("#monto_gasolina").removeAttr("disabled");
					
					if($("#select_tipo_auto").val()!=1){
						for(var i=1; i<=numFilas; i++){
							// Extreremos el valor del cargo AMEX (Contiene monto y moneda original) 
							var montoCargoAMEX = $("#cargo_factura"+i).val();
							// Obtenemos el inicio de los tres ï¿½ltimos caracteres 
							var longitudCargo = parseInt(montoCargoAMEX.length) - 3;
							// Obtener moneda original del cargo AMEX 
							var monedaCargoAMEX = montoCargoAMEX.substr(longitudCargo, 3);
							
							if(monedaCargoAMEX == "MXN" || (monedaCargoAMEX == "" && $("#divisa"+i).val() == "MXN")){
								if(($("#numConcepto"+i).val() == 12)) {
									totalGasolina += parseFloat($("#totalMxn"+i).val().replace(/,/g,""));
									gasolina = true;															
								}							
							}							
						}
						
						excedente = (parseFloat($("#monto_gasolina").val().replace(/,/g,"")) - parseFloat(totalGasolina));					
						if(excedente < -(parseFloat(<?PHP echo $politicaGasolina; ?>))){
							$("#mensaje_excepcion_gasolina").val(msg);
							$("#dif_gasolina").val(excedente);							
							alert(msg);
						}
					}
					return true;
				}else{
					return false;					
				}			
			}		
			
			//validaGasolina	
			function validaGasolina(){
				var gasolina = false;
				var Alimentos = false;
				var Hotel = false;
				var Lavanderia = false;
				
				var numFilas = parseInt($("#comprobacion_table>tbody>tr").length);
				for(var i=1; i<=numFilas; i++){
					if($("#divisa"+i).val()=="MXN"){
						if( ($("#numConcepto"+i).val() == 12)) {
							gasolina = true;										
						}else if($("#concepto"+i).val() == "Alimentos"){
							Alimentos = true;
						}else if($("#concepto"+i).val() == "Hotel"){
							Hotel = true;
						}else if($("#concepto"+i).val() == "Lavanderï¿½a"){
							Lavanderia = true;
						}							
					}					
				}
				
				if(gasolina){
					$("#sol_select").attr("disabled","true");
					validacionViaje(tramiteId,Alimentos,Hotel,Lavanderia);
					if($("#validacionCompleta").val() == 1){
						muestraVentanaGasolina(1);
						return false;
					}
				}else{
					validacionViaje(tramiteId,Alimentos,Hotel,Lavanderia);									
					if($("#validacionCompleta").val() == 1){						
						return true;
					}					
				}
			}		
			
			//calcula monto de gasolina
			function calculaMontoGasolina(){				
				var km = $("#kilometraje").val();
				var ma = $("#select_modelo").val();
				//$.post(url,{ma_id:ma},function(data){										
				//});
				
				$.ajax({      
			        type: "POST",
			        url: "services/Ajax_comprobacion.php",
			        data: "ma_id="+ma,
			        dataType: "json",
			        async : false,
			        timeout: 10000,
			        success: function(json){
			        	ma = json;
						ma = ma*km;
						$("#monto_gasolina").val(number_format(ma,2,".",","));
			        },
			        error: function(x, t, m) {
						if(t==="timeout") {
							location.reload();
								 abort();
						} 
					}
				});
			        				
			}
							
			//obenter ma_factor
			function obtenMafactor(valor){
				//var url="services/Ajax_comprobacion.php";
				var ma = $("#select_modelo").val();
				//$.post(url,{ma_id:ma},function(data){										
				//});
				
				$.ajax({      
			        type: "POST",
			        url: "services/Ajax_comprobacion.php",
			        data: "ma_id="+ma,
			        dataType: "json",
			        async : false,
			        timeout: 10000,
			        success: function(json){
			        	$("#factor").html("Factor gasolina: "+ json);		        	
			        },
			        complete: function(json){
			        	calculaMontoGasolina();
				    },
				    error: function(x, t, m) {
						if(t==="timeout") {
							location.reload();
								 abort();
						}
					}
				});
				
			}
			
			// funcion que activa los valores y campos para la comprobacion de gasolina
			function muestraValoresGasolina(){
				if($("#sol_select").val()==0){
					$("#motivoGas").css("display","block");
					$("#fechaGas").css("display","block");
					$("#fecha_inicial").removeAttr("disabled");
					$("#fecha_final").removeAttr("disabled");
					$("#motivo").removeAttr("disabled");
					$("#motivo").removeAttr("disabled");
					var opciones = '<option value="-1" id="-1">Seleccione ...</option>'+
								   '<option value="2" id="2">Amex</option>'+
								   '<option value="3" id="3">Reembolso</option>';
					<?PHP if($_SESSION["perfil"] == 3){ ?>
						opciones = '<option value="-1" id="-1">Seleccione ...</option>'+								   
								   '<option value="3" id="3">Reembolso</option>'+
								   '<option value="4" id="4">Amex externo</option>';					
					<?PHP } ?>
					var opciones2 = '<option value="-1" id="-1">Seleccione ...</option>'+
								   '<option value="11">Casetas</option>'+
								   '<option value="12">Gasolina</option>'+
								   '<option value="31">Personal</option>'+
								   '<option value="25">Otros gastos</option>';
					$("#tipo").html(opciones);				   
					$("#select_concepto").html(opciones2);		
					$("#comprobacionGasolina").val(1);												
				}else{									
					muestraVentanaGasolina(0);
					$("#motivoGas").css("display","none");
					$("#fechaGas").css("display","none");
					$("#motivo").attr("disabled",true);
					$("#fecha_inicial").attr("disabled",true);
					$("#fecha_fianl").attr("disabled",true);			
					<?PHP if ($_SESSION["perfil"]!=3){ ?>
					var opciones = '<option value="-1" id="-1">Seleccione ...</option>';
					<?PHP 
						if(isset($_GET['edit'])){
						$sv_total_anticipo=0;		
						$query3 = "SELECT sv_total_anticipo FROM solicitud_viaje, comprobaciones WHERE co_tramite = sv_tramite AND co_mi_tramite = ".$_GET['edit'];
						$res3 = mysql_query($query3);
						$row3 = mysql_fetch_array($res3);
						$sv_total_anticipo = round($row3['sv_total_anticipo']);	
						if($sv_total_anticipo > 0){
					?>
					opciones+='<option value="1" id="1">Anticipo</option>';   
					<?PHP }
					}					
					?>
					opciones+= '<option value="2" id="2">Amex</option>'+
							   '<option value="3" id="3">Reembolso</option>';
					<?PHP }else{ ?>      
					var opciones = '<option value="-1" id="-1">Seleccione ...</option>'+
								   '<option value="3" id="3">Reembolso</option>'+
								   '<option value="4" id="4">Amex externo</option>';
					<?PHP }   									
					$query = sprintf("SELECT c.cp_id AS cp_id, cp_concepto, cp_cuenta FROM cat_conceptos AS c 
							INNER JOIN conceptos_flujos AS cf ON (c.cp_id = cf.cp_id) 
							WHERE cf.f_id = %s AND cp_activo = 1 ORDER BY cp_concepto", FLUJO_COMPROBACION);
					//error_log("--->>Consulta Conceptos según el flujo: ".$query);
					$res = mysql_query($query);
					$opciones2 = '<option value="-1" id="-1">Seleccione ...</option>';
					while($row = mysql_fetch_assoc($res)){
						 $opciones2 .= "<option id=" . $row["cp_id"] . " value=" . $row["cp_id"] . ">" . $row["cp_concepto"] . "</option>";
					}					
					?>
					var opciones2 = '<?PHP echo $opciones2;?>';					
					$("#tipo").html(opciones);				   
					$("#select_concepto").html(opciones2);
					$("#comprobacionGasolina").val(0);		
				}
			}

			function cambiaMotivo(){
				muestraValoresGasolina();                				
                if($("#sol_select").val() != "-1" ){                         
					var tramite = $("#sol_select").val();	
					var msg = (tramite == 0) ? "Comprobaci\xf3n de Gasolina sin Solicitud" : "1";
					$("#motive").val(msg);	
					$("#typedoc").val("1|"+tramite);										                    
                    getSaldoAnticipo(tramite);                   
                }else{
                    $("#motive").val("");
                    $("#typedoc").val("");
                }
            }

            function getSaldoAnticipo(tramite){				
				var url = "services/Ajax_comprobacion.php";
				var tramite = tramite;
				$.post(url,{ant_viaje:tramite},function (data){					
					if(data!=0){
						$("#anticipo_solicitado2").val(data);	
						data = number_format(data,2,".",",");
						$("#anticipo_solicitado1").html(data + " MXN");                        					
						$("#tipo option[value='1']").remove();							
						$("#tipo").append("<option value='1'>Anticipo</option>");						
					}else{
						$("#tipo option[value='1']").remove();							
					}
				});               				
            }
			
            function verificar_concepto(valor){
				//Para verificar si el valor es comida y visualiza en div de asistentes
				if(valor == 6){
					$("#propina").css("display", "block");
					$("#div_propina").css("display", "block");
                    $("#asistentes").css("display", "block");
                    $("#asistentes2").css("display", "block");
                    $("#no_asistentes").val("1");
                    $("#div_impuesto_hospedaje").css("display", "none");
                    $("#div_impuesto_hospedaje2").css("display", "none");
                    $("#concepto_alim_hot").val("alimentacion");
                    $("#tipo_comida_label").css("display","block");
					$("#div_tipo_comida_label").css("display","block");
				}else if(valor==5 ){
                    $("#no_asistentes").val("1");
                    $("#div_impuesto_hospedaje").css("display", "block");
                    $("#div_impuesto_hospedaje2").css("display", "block");
                    $("#concepto_alim_hot").val("hospedaje");
					$("#propina").css("display", "block");
                    $("#div_propina").css("display", "block");
					$("#tipo_comida_label").css("display","none");
					$("#div_tipo_comida_label").css("display","none");
                    $("#asistentes").css("display", "none");
                    $("#asistentes2").css("display", "none");
				}else{
					$("#tipo_comida_label").css("display","none");
					$("#div_tipo_comida_label").css("display","none");
					$("#asistentes").css("display", "none");
                    $("#asistentes2").css("display", "none");
					$("#propina").css("display", "none");
					$("#propina_dato").val("0");
                    $("#div_propina").css("display", "none");
					$("#div_impuesto_hospedaje").css("display", "none");
                    $("#div_impuesto_hospedaje2").css("display", "none");
				}
              
                if(valor!=6 && valor!=5 && valor!=30 && valor!=31 && valor!=32){
                    $("#propina").css("display", "none");
					$("#propina_dato").val("0");
                    $("#asistentes").css("display", "none");
                    $("#no_asistentes").val("1");
                    $("#imp_hospedaje").css("display", "none");
                    $("#imp_hosp_dato").val("0");
                    $("#concepto_alim_hot").val("0");                                                       
                }
            }
                                                                                                                                       
            function getTipoComp(){
                var frm=document.detallecomp;
                                                                                                                                                        
                if(frm.tipo.value==1){
                    if($("#amex_form").hasClass("visible")){
                        $("#amex_form").slideUp(1000);
                        $("#amex_form").removeClass("visible");                        
                    }                            
                }
                if(frm.tipo.value==2){
                    $("#amex_form").slideDown(1000);            
                    $("#amex_form").css("display", "block");
                    $("#amex_form").addClass("visible")
                }
                if(frm.tipo.value==3){
                    if($("#amex_form").hasClass("visible")){
                        $("#amex_form").slideUp(1000);      
                        $("#amex_form").removeClass("visible");                      
                    }
                }
            }
          
            function getCentroCostos(){
                var frm=document.detallecomp;
                $("#Cecos").val(frm.ccentro_costos.value);
            }
          
            function cargar_detalles(){
                $("#impuesto").val(0);
                $("#div_iva").css("display", "block"); 
				$("#impuesto").css("display", "block");				
				//funcion para rellenar combos.
				var frm=document.detallecomp;
				var cargo_localizar=frm.select_tarjeta_cargo.value;
				$.ajax({
					type: "POST",
					url: "services/Ajax_comprobacion.php",
					data: "no_cargo="+cargo_localizar,
					dataType: "json",
					async : false,
					timeout: 10000,
					success: function(json){		
						if(json[0].idamex == null){
							$("#fecha_cargo").html("");
							$("#establecimiento_cargo").html("");
							$("#monto_cargo").html(""); 
							$("#rfc_cargo").html("");
							$("#moneda_local").html("");
							$("#amex_pesos").html("");
							$("#amex_dolar").html("");
							$("#moneda_fact_val").val("");
							$("#fecha_cargo_val").val("");
							$("#establecimiento_cargo_val").val("");
							$("#monto_cargo_val").val("");
							$("#amex_pesos_val").val("");
							$("#amex_dolar_val").val("");
							$("#rfc_cargo_val").val("");
							$("#moneda_local_val").val("");
							$("#tipo_cambio").val("");
							$("#div_tipo_cambio").html("");
						}else{					
							$("#rfc_cargo_val").val(json[0].rfc_establecimiento);
							$("#fecha_cargo").html(json[0].fecha_cargo);   
							$("#establecimiento_cargo").html(json[0].concepto);   
							$("#monto_cargo").html(number_format(json[0].monto,2,".",",")+" "+json[0].moneda_local);
							$("#amex_dolar").html(number_format(json[0].montoAmex,2,".",",")+" "+json[0].monedaAmex);
							$("#amex_dolar_val").val(json[0].montoAmex+" "+json[0].monedaAmex);
							$("#moneda_local").html(json[0].moneda_local);
							$("#moneda_fact_val").val(json[0].monedaAmex);   
							$("#fecha_cargo_val").val(json[0].fecha_cargo);   
							$("#establecimiento_cargo_val").val(json[0].concepto);   
							$("#monto_cargo_val").val(json[0].monto);
							$("#moneda_local_val").val(json[0].moneda_local);
							var amex_pesos = parseFloat(json[0].conversion_pesos);	
							amex_pesos = amex_pesos.toFixed(2);										
							$("#amex_pesos_val").val(amex_pesos);				
							
							
							$("#no_transaccion").html(json[0].notransaccion);
							$("#idAmex").val(json[0].idamex);	
							var tipo_cambio = parseFloat(json[0].montoAmex/json[0].monto);
							$("#tipo_cambio").val(tipo_cambio.toFixed(2));
							$("#div_tipo_cambio").html(tipo_cambio.toFixed(5));							
							amex_pesos = number_format(amex_pesos,2,".",",");
							$("#amex_pesos").html(amex_pesos);
							
							if(json[0].rfc_establecimiento == "" || json[0].rfc_establecimiento == null || $("#select_tipo_tarjeta").val() == 2 || json[0].moneda_local != "MXN"){
								$("#rfc_cargo_val").val(0);
								$("#rfc_cargo").html("N/A");
								$("#fact_chk").attr("checked",false);
								$("#fact_chk").removeAttr("disabled",true);
								$("#factura_form").slideUp(1000);
								$("#d_folio").val("");
								$("#rfc").val("");
								$("#proveedor").val("");
								//$("#div_iva").hide();
								//$("#impuesto").hide();
							}else{								
								$("#rfc_cargo_val").val(json[0].rfc_establecimiento);
								$("#rfc_cargo").html(json[0].rfc_establecimiento);		
								$("#fact_chk").attr("disabled",true);											
								$("#fact_chk").attr("checked",true);									
								$("#factura_form").slideDown(1000);																								
								$("#div_iva").css("display", "block"); 
								$("#impuesto").css("display", "block"); 
							} 											 
						}
					},
					error: function(x, t, m) {
						if(t==="timeout") {
							location.reload();
								 abort();
						}
					}
				});
				//realizar calculo de nuevo
				calculaTotalDolares();											
			}               
			
			function validaProveedor(rfc,nombre){				
				var url = "services/Ajax_comprobacion.php";
				var valor = true;
				$.ajaxSetup({async:false});				
				$.post(url,{proveedorRFC:rfc,proveedorNombre:nombre},function(data){				
					valor = (data == 0) ? false : true;
				});
				if(!valor) alert("El proveedor ingresado no se encuentra registrado, favor de dar de alta al proveedor");
				return valor;			
			}
			             
            function buscaProveedor(li){
                if(li==null){ 
                    return null;
                }
                if(!!li.extra){
                    var valorLista=li.extra[0];
                }else{ 
                    var valorLista=li.selectValue;
                    $("#load_div").html("Cargando Razï¿½n Social espere...");
                    $.ajax({
                        //busca el nombre del proveedor en el catalogo en base al RFC
                        url: 'services/catalogo_proveedores.php',
                        type: "POST",
                        data: "nombre="+valorLista+"&tip=1",
                        dataType: "html",
                        timeout: 10000,
                        success: function(datos){
                            $("#proveedor").val(datos);
                            $("#load_div").html("");
                        },
                        error: function(x, t, m) {
    						if(t==="timeout") {
    							buscaProveedor(li);
    						}
    					}
                    });//fin ajax	
                }
            }//fin buscaProveedor

            function buscaRFC(li) {
                if(li==null){ 
                    return null;
                }
                if(!!li.extra){
                    var valorLista=li.extra[0];
                }else{ 
                    var valorLista=li.selectValue;
                    $("#load_div").html("Cargando RFC espere...");
                    $.ajax({
                        //busca el rfc del proveedor en el catalogo en base al nombre
                        url: 'services/catalogo_proveedores.php',
                        type: "POST",
                        data: "nombre="+valorLista+"&tip=2",
                        dataType: "html",
                        timeout: 10000,
                        success: function(datos){
                            $("#rfc").val(datos);
                            $("#load_div").html("");
                        },error: function(x, t, m) {
    						if(t==="timeout") {
    							buscaRFC(li);
    						}
    					}
                    });//fin ajax	
                }
            }//fin buscaRFC

            function seleccionaItem(li) {
                buscaProveedor(li);
            }//fin seleccionaItem

            function seleccionaItem2(li) {
                buscaRFC(li);
            }//fin seleccionaItem

            function arreglaItem(row) {
                //da el formato a la lista
                return row[0];
            }//fin arreglaItem

            //Agrega Nuevo Proveedor al catï¿½logo
            function nuevoProveedor(nombreProveedor,rfcProveedor,dirFiscal){
				var frm=document.detallecomp;
				if(nombreProveedor == "" || nombreProveedor == 0){
					alert("Debe ingresar una raz"+arrayAcentos["o"]+"n social.");
                    return false;
				}else if(valida_formatoRFC($("#new_p_rfc").val()) == null){ 
					frm.new_p_rfc.value = ""; 
					alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente");
					return false;
				}else if((rfcProveedor<12 || rfcProveedor>13) &&  frm.fact_chk.checked==true){
                    alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente.");
                    return false;
                }else if(dirFiscal==""){
                    alert("Debe ingresar la direcciï¿½n fiscal del proveedor.");
                    return false;
                }else{
                    		
                    $.ajax({
                    	 url: 'services/catalogo_proveedores.php',
                         type: "POST",
                         data: "submit=&nameprov="+nombreProveedor+"&rfcprov="+rfcProveedor+"&dirf="+dirFiscal,
                         timeout: 10000,
                        success: function(datos){
                            if (datos==""){				
                                $("#proveedor").val("");
                                $("#rfc").val("");
                                $('#new_proveedor').val("");
                                $('#new_p_rfc').val("");
                                $('#new_p_addr').val("");					
                                $("#proveedor").focus();
                            }else{	
								alert(datos);
                                $("#new_p_rfc").focus();
                            }
                        },
                        error: function(x, t, m) {
    						if(t==="timeout") {
    							location.reload();
    								 abort();
    						}
    					}
                    });//fin ajax
                    return false;
                }//fin if rfc
            }//fin nuevoProveedor
                                                                                                                                                                		
            //Fecha
            $(function() {
                //campo 
                $("#fecha").date_input(),
				$("#fecha_inicial").date_input(),
				$("#fecha_final").date_input();
            });
                                                                                                                                                                		
            //obtiene formato de fecha YYYY/mm/dd
            $.extend(DateInput.DEFAULT_OPTS, {
                stringToDate: function(string) {
                    var matches;
                    if (matches = string.match(/^(\d{4,4})-(\d{2,2})-(\d{2,2})$/)) {
                        return new Date(matches[1], matches[2] - 1, matches[3]);
                    } else {
                        return null;
                    };
                },
                dateToString: function(date) {
                    var month = (date.getMonth() + 1).toString();
                    var dom = date.getDate().toString();
                    if (month.length == 1) month = "0" + month;
                    if (dom.length == 1) dom = "0" + dom;
                    return dom + "/" + month + "/" + date.getFullYear();
                }
            });
                                                                                                                                                                		
            //Opciones de Idioma del Calendario
            jQuery.extend(DateInput.DEFAULT_OPTS, {
                month_names: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
                short_month_names: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
                short_day_names: ["Dom", "Lun", "Mar", "Miï¿½", "Jue", "Vie", "Sab"]
            });
            //fin Fecha	

            //validaciï¿½n campos numericos
            function validaNum(valor){
                cTecla=(document.all)?valor.keyCode:valor.which;
                if(cTecla==8) return true;
                patron=/^([0-9.]{1,2})?$/;
                cTecla= String.fromCharCode(cTecla);
                return patron.test(cTecla);
            }
		
            function validarcampos(){
            	// Desactivar las listas Tipo de Tarjeta y Lista de Cargos en el caso 
    			// que la Comprobaciï¿½n sea Devuelta con Observaciones por Finanzas 
    			if($("#etapaComprobacion").val() == 5){
					$("#select_tipo_tarjeta").removeAttr("disabled");
					$("#select_tarjeta_cargo").removeAttr("disabled");
    			}
                
                var frm= document.detallecomp;
				var indice=$("#select_concepto").val();
				
				if($("#sol_select").val() == "n"){
					alert("Debe introducir una solicitud valida.");
					$("#sol_select").focus();
						return false;											
				}	
				if($("#sol_select").val() == 0){
					if($("#motivo").val() == '' ){
						alert("Debe introducir un motivo para la comprobacion.");
						$("#motivo").focus();
						return false;						
					}
				}				
				if($("#moneda").val() == "MXN"){
					if($("#impuesto").val() == ''){
						alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
						$("#impuesto").focus();
						return false;						
					}
				}					
				if($("#sol_select").val() == -1){
					alert("Debe seleccionar una solicitud de viaje.\nFavor de llenar los datos faltantes.");
					return false;
				}else if( $("#tipo").val() == -1 ){
					alert("Debe seleccionarrrrrr un tipo de comprobaci"+arrayAcentos['o']+"n.\nFavor de llenar los datos faltantes.");
					return false;
				}else if(frm.ccentro_costos.value==-1){
					alert("Debe seleccionar un centro de costos.\nFavor de llenar los datos faltantes.");
					return false;
				}else if(frm.select_concepto.value==-1){
					alert("Debe seleccionar un concepto.\nFavor de llenar los datos faltantes.");
					return false;
				}else {
					if($("#tipo").val() == 2){
							var moneda = frm.moneda.value;
							var divisa = moneda;
							var total=0;
							if(divisa == "MXN"){
								total=(Math.round(parseFloat($("#total").val().replace(/,/g,"")) * Math.pow(10, 2)) / Math.pow(10, 2));
								var totalmxn = total;								
							}else if(divisa == "USD"){
								total=(Math.round(parseFloat($("#total").val().replace(/,/g,"")) * Math.pow(10, 2)) / Math.pow(10, 2));
								var totalmxn = total * parseFloat($("#valorDivisaUSD").val());								
							}else if(divisa == "EUR"){
								total=(Math.round(parseFloat($("#total").val().replace(/,/g,"")) * Math.pow(10, 2)) / Math.pow(10, 2));
								var totalmxn = total * parseFloat($("#valorDivisaEUR").val());								
							}
							var sumaCargoTotal2 = valida_suma_cargo($("#select_tarjeta_cargo").val().replace(/,/g,""));
							var montoAmex = $("#monto_cargo").html();
							var proveedor_amex=($("#fact_chk").is(':checked'))?true:false;
							var monto_amex=$("#monto").val();
							var moneda_amex=$("#moneda").val();
							var dat_fact= true;
							var total_amex=$("#total").val();
							var aux_fecha_cargo = frm.fecha_cargo_val.value.split(" ");
							var proveedor_reembolso=($("#fact_chk").is(':checked'))?true:false;
							aux_fecha_cargo = aux_fecha_cargo[0];
							aux_fecha_cargo = aux_fecha_cargo.split("-").reverse().join("/");
							if(frm.select_tipo_tarjeta.value==-1){ //tipo de tarjeta
								alert("Debe seleccionar el tipo de tarjeta para comprobar. Favor de llenar los datos faltantes.");
								$("#select_tipo_tarjeta").focus();
								return false;
							}else if(frm.select_tarjeta_cargo.value==-1 || frm.select_tarjeta_cargo.value==""){ //lista de cargos
								alert("Debe seleccionar un cargo para comprobar. Favor de llenar los datos faltantes.");
								$("#select_tarjeta_cargo").focus();
								return false;
							}else{
								if(proveedor_reembolso){
								if ($("#impuesto").val() == ""){									
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#impuesto").focus();
									return false;
								}else if (parseFloat((frm.impuesto.value).replace(/,/g,""))<0){
									alert("El IVA introducido es inv"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
									frm.impuesto.focus();
									return false;
								} else if($("#d_folio").val()==""){
									alert("Debe ingresar un folio de factura. Favor de llenar los datos faltantes.");
									$("#d_folio").focus();
									return false;	 
								}else if($("#proveedor").val()==""){
									alert("Debe ingresar la raz"+arrayAcentos["o"]+"n social. Favor de llenar los datos faltantes.");
									frm.proveedor.focus(); 
									return false;  
								}else if(($("#rfc").val().length<12)||($("#rfc").val().length>13)){
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente.");
									$("#rfc").focus();
									return false;
								}else if(valida_formatoRFC($("#rfc").val()) == null){ 
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente");
									return false;
								}else if(($.trim($("#rfc_cargo_val").val()) != $.trim($("#rfc").val())) && $("#rfc_cargo_val").val() != 0 && $("#select_tipo_tarjeta").val() != 2 ){ 
									alert("El RFC ingresado difiere del RFC registrado al cargo");
									$("#rfc").focus();
									return false;
								}
								if(!validaProveedor($("#rfc").val(),$("#proveedor").val()))return false;
							} if(monto_amex==""){
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#monto").focus();
									return false;
								}else if(parseFloat(monto_amex)<=0){
									alert("Debe ingresar un monto. Favor de llenar los datos faltantes.");
									$("#monto").focus();
									return false;
								}else if(moneda_amex==-1){
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#moneda").focus();
									return false;
								}else if(dat_fact==false){
									alert("Tu comprobante excede el plazo permitido de 60 dias.");                      
									return false;
								}else if(total_amex==""){
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#total").focus();
									return false;
								}else if(frm.moneda.options[frm.moneda.selectedIndex].text!=frm.moneda_fact_val.value){
									alert("La divisa seleccionada difiere a la divisa en Total Amex");
									sumaCargo =0;
									return false;
								}else if($("#no_asistentes").val()=="" || $("#no_asistentes").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
									alert("Debe ingresar un numero de asistentes.\nFavor de llenar los datos faltantes.");
									frm.no_asistentes.focus();
									return false;
								}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos" && $("#no_asistentes").val()>1){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
								}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Otros gastos" ){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
								}else if($("#tipo").val() == 2 && parseFloat($("#total_dolares").val().replace(/,/g,"")) > parseFloat($("#amex_pesos_val").val().replace(/,/g,""))){
									alert("El monto del concepto excede el monto total del cargo seleccionado.");
									return false;
								}else if(sumaCargoTotal2 > parseFloat($("#amex_pesos_val").val().replace(/,/g,""))){
									alert("El monto del concepto excede el monto total del cargo seleccionado.");
									return false;
								}else if($("#tipocomidadato").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
									alert("Debe ingresar un tipo de comida.\nFavor de llenar los datos faltantes.");
									frm.tipocomidadato.focus();
									return false;
								}else{
									if($('#excedeMontoComentarios').val() == 1 && frm.referencia_corta.value=="" && (conceptoNombre == "Alimentos" || conceptoNombre == "Hotel" || conceptoNombre == "Lavander"+arrayAcentos["i"]+"a" )){
										alert("Debe ingresar un comentario, ya que ha excedido el monto diario permitido para el concepto de tipo"+" "+conceptoNombre+".\nFavor de llenar los datos faltantes.");
										frm.referencia_corta.focus();
										return false;
									}else{
										construyePartida();
										if(conceptoNombre == "Alimentos"){									
											calculoParametros();
										}
									}
									if(!bandera){$("#guardarPrev").removeAttr("disabled");}
									$("#guardarComp").removeAttr("disabled");
									$("#asistentes").css("display", "none");
									$("#asistentes2").css("display", "none");
									$("#propina").css("display", "none");
									$("#div_propina").css("display", "none");
									$("#div_impuesto_hospedaje").css("display", "none");
									$("#div_impuesto_hospedaje2").css("display", "none");
								}
							}
					}else if($("#tipo").val()== 3){
							var proveedor_reembolso=($("#fact_chk").is(':checked'))?true:false;
							var monto_amex=$("#monto").val();
							var moneda_amex=$("#moneda").val();
							var dat_fact= true;
							var total_amex=$("#total").val();
							
							if(proveedor_reembolso){
								if ($("#impuesto").val() == ""){
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#impuesto").focus();
									return false;
								}else if (parseFloat((frm.impuesto.value).replace(/,/g,""))<0){
									alert("El IVA introducido es inv"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
									frm.impuesto.focus();
									return false;
								} else if($("#d_folio").val()==""){
									alert("Debe ingresar un folio de factura. Favor de llenar los datos faltantes.");
									$("#d_folio").focus();
									return false;	 
								}else if($("#proveedor").val()==""){
									alert("Debe ingresar la raz"+arrayAcentos["o"]+"n social. Favor de llenar los datos faltantes.");
									frm.proveedor.focus(); 
									return false;  
								}else if(($("#rfc").val().length <12)||($("#rfc").val().length>13)){
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente.");
									frm.rfc.focus();
									return false;
								}else if(valida_formatoRFC($("#rfc").val()) == null){  
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente");
									return false;
								}
								if(!validaProveedor($("#rfc").val(),$("#proveedor").val()))return false;
							} 
							if(monto_amex==""){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#monto").focus();
								return false;
							}else if(parseFloat(monto_amex)<=0){
								alert("Debe ingresar un monto. Favor de llenar los datos faltantes.");
								$("#monto").focus();
								return false;
							}else if(moneda_amex==-1){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#moneda").focus();
								return false;
							}else if(dat_fact==false){
								alert("Tu comprobante excede el plazo permitido de 60 dias.");                      
								return false;
							}else if(total_amex==""){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#total").focus();
								return false;
							}else if(parseFloat(total_amex)<=0){
								alert("El Total introducido no es v"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
								$("#total").focus();
								return false;
							}else if($("#no_asistentes").val()=="" || $("#no_asistentes").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
								alert("Debe ingresar un numero de asistentes.\nFavor de llenar los datos faltantes.");
								frm.no_asistentes.focus();
								return false;
							}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos" && $("#no_asistentes").val()>1){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
							}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Otros gastos" ){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
							}else if($("#tipocomidadato").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
									alert("Debe ingresar un tipo de comida.\nFavor de llenar los datos faltantes.");
									frm.tipocomidadato.focus();
									return false;
							}else{															
								if($('#excedeMontoComentarios').val() == 1 && frm.referencia_corta.value=="" && (conceptoNombre == "Alimentos" || conceptoNombre == "Hotel" || conceptoNombre == "Lavander"+arrayAcentos["i"]+"a" )){
									alert("Debe ingresar un comentario, ya que ha excedido el monto diario permitido para el concepto de tipo"+" "+conceptoNombre+".\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
								}else{
										construyePartida();									
										if(conceptoNombre == "Alimentos"){									
											calculoParametros();
										}	
																												
								}																
								//$("#guardarPrev").removeAttr("disabled");																
								if(!bandera){$("#guardarPrev").removeAttr("disabled");}
								$("#guardarComp").removeAttr("disabled");
								$("#asistentes").css("display", "none");
								$("#asistentes2").css("display", "none");
								$("#propina").css("display", "none");
								$("#div_propina").css("display", "none");
								$("#div_impuesto_hospedaje").css("display", "none");
								$("#div_impuesto_hospedaje2").css("display", "none");
							}
					}else if($("#tipo").val() == 1){
						var proveedor_reembolso=($("#fact_chk").is(':checked'))?true:false;
						var monto_amex=$("#monto").val();
						var moneda_amex=$("#moneda").val();
						var dat_fact= true;
						var total_amex=$("#total").val();
						var sumaAnticipo = valida_suma_anticipo();
						
						if(!sumaAnticipo){
							alert("El monto del concepto excede el monto total del anticipo asignado.");
							$("#total_dolares").focus();							
							return false;								
						};
						
						if(proveedor_reembolso){
								if ($("#impuesto").val() == ""){
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#impuesto").focus();
									return false;
								}else if (parseFloat((frm.impuesto.value).replace(/,/g,""))<0){
									alert("El IVA introducido es inv"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
									frm.impuesto.focus();
									return false;
								} else if($("#d_folio").val()==""){
									alert("Debe ingresar un folio de factura. Favor de llenar los datos faltantes.");
									$("#d_folio").focus();
									return false;	 
								}else if($("#proveedor").val()==""){
									alert("Debe ingresar la raz"+arrayAcentos["o"]+"n social. Favor de llenar los datos faltantes.");
									frm.proveedor.focus(); 
									return false;  
								}else if(($("#rfc").val().length<12)||($("#rfc").val().length>13)){
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente.");
									frm.rfc.focus();
									return false;
								}else if(valida_formatoRFC($("#rfc").val()) == null){  
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente");
									return false;
								}
								if(!validaProveedor($("#rfc").val(),$("#proveedor").val()))return false;
							} if(monto_amex==""){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#monto").focus();
								return false;
							}else if(parseFloat(monto_amex)<=0){
								alert("Debe ingresar un monto. Favor de llenar los datos faltantes.");
								$("#monto").focus();
								return false;
							}else if(moneda_amex==-1){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#moneda").focus();
								return false;
							}else if(dat_fact==false){
								alert("Tu comprobante excede el plazo permitido de 60 dias.");                      
								return false;
							}else if(total_amex==""){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#total").focus();
								return false;
							}else if(parseFloat(total_amex)<=0){
								alert("El Total introducido no es v"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
								$("#total").focus();
								return false;
							}else if($("#no_asistentes").val()=="" || $("#no_asistentes").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
								alert("Debe ingresar un numero de asistentes.\nFavor de llenar los datos faltantes.");
								frm.no_asistentes.focus();
								return false;
							}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos" && $("#no_asistentes").val()>1){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
							}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Otros gastos" ){
								alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
								frm.referencia_corta.focus();
								return false;
							}else if($("#tipocomidadato").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
									alert("Debe ingresar un tipo de comida.\nFavor de llenar los datos faltantes.");
									frm.tipocomidadato.focus();
									return false;
							}else{																
								if($('#excedeMontoComentarios').val() == 1 && frm.referencia_corta.value=="" && (conceptoNombre == "Alimentos" || conceptoNombre == "Hotel" || conceptoNombre == "Lavander"+arrayAcentos["i"]+"a" )){
									alert("Debe ingresar un comentario, ya que ha excedido el monto diario permitido para el concepto de tipo"+" "+conceptoNombre+".\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
								}else{
									construyePartida();
									if(conceptoNombre == "Alimentos"){									
										calculoParametros();
									}
									
								}
								if(!bandera){$("#guardarPrev").removeAttr("disabled");}
								$("#guardarComp").removeAttr("disabled");
								$("#asistentes").css("display", "none");
								$("#asistentes2").css("display", "none");
								$("#propina").css("display", "none");
								$("#div_propina").css("display", "none");
								$("#div_impuesto_hospedaje").css("display", "none");
								$("#div_impuesto_hospedaje2").css("display", "none");
							}
					}else if($("#tipo").val()== 4){
							var proveedor_reembolso = ($("#fact_chk").is(':checked')) ? true : false;
							var dat_fact = true;
							var monto_amex = $("#monto").val();
							var moneda_amex = $("#moneda").val();							
							var total_amex = $("#total").val();
							
							if(proveedor_reembolso){
								if ($("#impuesto").val() == ""){
									alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
									$("#impuesto").focus();
									return false;
								}else if (parseFloat($("#impuesto").val().replace(/,/g,"")) < 0){
									alert("El IVA introducido es inv"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
									$("#impuesto").focus();
									return false;
								} else if($("#d_folio").val()==""){
									alert("Debe ingresar un folio de factura. Favor de llenar los datos faltantes.");
									$("#d_folio").focus();
									return false;
								}else if($("#proveedor").val()==""){
									alert("Debe ingresar la raz"+arrayAcentos["o"]+"n social. Favor de llenar los datos faltantes.");
									frm.proveedor.focus(); 
									return false;  
								}else if(($("#rfc").val().length <12)||($("#rfc").val().length>13)){
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente.");
									frm.rfc.focus();
									return false;
								}else if(valida_formatoRFC($("#rfc").val()) == null){  
									alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente");
									return false;
								}
								if(!validaProveedor($("#rfc").val(),$("#proveedor").val()))return false;
							} 
							if(monto_amex==""){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#monto").focus();
								return false;
							}else if(parseFloat(monto_amex)<=0){
								alert("Debe ingresar un monto. Favor de llenar los datos faltantes.");
								$("#monto").focus();
								return false;
							}else if(moneda_amex==-1){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#moneda").focus();
								return false;
							}else if(dat_fact==false){
								alert("Tu comprobante excede el plazo permitido de 60 dias.");                      
								return false;
							}else if(total_amex==""){
								alert("Los campos con (*) son obligatorios. Favor de llenar los datos faltantes.");
								$("#total").focus();
								return false;
							}else if(parseFloat(total_amex)<=0){
								alert("El Total introducido no es v"+arrayAcentos["a"]+"lido. Favor de verificarlo.");
								$("#total").focus();
								return false;
							}else if($("#no_asistentes").val()=="" || $("#no_asistentes").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
								alert("Debe ingresar un numero de asistentes.\nFavor de llenar los datos faltantes.");
								frm.no_asistentes.focus();
								return false;
							}else if((frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos" && $("#no_asistentes").val()>1)){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
							}else if(frm.referencia_corta.value=="" && $("#select_concepto option[value='"+ indice +"']").text()=="Otros gastos" ){
									alert("Debe ingresar un comentario.\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
							}else if($("#tipocomidadato").val()==0 && $("#select_concepto option[value='"+ indice +"']").text()=="Alimentos"){
									alert("Debe ingresar un tipo de comida.\nFavor de llenar los datos faltantes.");
									frm.tipocomidadato.focus();
									return false;
							}else{
								if($('#excedeMontoComentarios').val() == 1 && frm.referencia_corta.value=="" && (conceptoNombre == "Alimentos" || conceptoNombre == "Hotel" || conceptoNombre == "Lavander"+arrayAcentos["i"]+"a" )){
									alert("Debe ingresar un comentario, ya que ha excedido el monto diario permitido para el concepto de tipo"+" "+conceptoNombre+".\nFavor de llenar los datos faltantes.");
									frm.referencia_corta.focus();
									return false;
								}else{
									construyePartida();
									if(conceptoNombre == "Alimentos"){									
										calculoParametros();
									}
									
								}
								//$("#guardarPrev").removeAttr("disabled");																
								if(!bandera){$("#guardarPrev").removeAttr("disabled");}
								$("#guardarComp").removeAttr("disabled");
								$("#asistentes").css("display", "none");
								$("#asistentes2").css("display", "none");
								$("#propina").css("display", "none");
								$("#div_propina").css("display", "none");
								$("#div_impuesto_hospedaje").css("display", "none");
								$("#div_impuesto_hospedaje2").css("display", "none");
							}
					}
				}
				reiniciaComentarioObligatorio();
				conceptoNombre="";												
			}
	// FIN de Validar campos
	
            function checafecha(strFecha, diasmax){
                var toks=strFecha.split("/");
                var strFechaN="";                                                                                                                                        		
                strFechaN=toks[2]+"/"+toks[1]+"/"+toks[0];		
                var fecha = new Date();
                fecha.setTime(Date.parse(strFechaN));			
                var today=new Date()
                var agedays = Math.floor((today - fecha) / 24 / 60 / 60 / 1000);
                if(agedays>diasmax){
                    var hoystr=<?PHP echo "\"" . date("d/m/Y") . "\";"; ?>			
                    document.detallecomp.fecha.value=hoystr;
                    return false;
                }else{
                    return true;
                }

            }

			function construyePartida(){
				$("#tipo").removeAttr("disabled");
				$("#select_tipo_tarjeta").removeAttr("disabled");
				$("#select_tarjeta_cargo").removeAttr("disabled");
				
				var frm = document.detallecomp;
                var moneda = frm.moneda.value;
				var totalComp = frm.total.value;
                var divisa = moneda;
                var id=0;
                var prov_name="";
                var prov_rfc="";
                var propina="";
                var propina_val=0;
                var impuesto_hospedaje="";
                var asistentes="";
                var tipo_comprobacion="";
                var cargo_asociado=0;
                var total=0;
                var fact_doc="";
                var ref_cort="";
                var indice=$("#tipo").val();
                var factura ="";
				var tiponum="";

				//Si se esta editando la partida
				//Si esta en forma de edicion, este tomara el valor del tramite en cuestion.
				if($("#cargar_com_viaje").val() == '1'){
					tramiteId = $('#sol_select').val();
				}	
				
                if(frm.typedoc.value!=""){
                    var idsol=frm.typedoc.value.split("|");				
                } else {
                    var idsol = new Array(0,0);
                }                                                                                                                                                           
                var concepto = $("#select_concepto").val();
				
                //Busca el ultimo ID de las partidas y le sumamos uno para el siguiente
                id=parseInt($("#comprobacion_table").find("tr:last").find("div").eq(0).html());

                if(isNaN(id)){			
                    id=1;		
                }else{			
                    id+=parseInt(1);
                }
				
                if (validaFactura==1){
                    fact_doc=frm.d_folio.value;
                }else{
                    fact_doc="Sin Factura";
                }
                
				switch(frm.tipo.value){
                    case "1": tiponum="1";tipo_comprobacion="Anticipo";break;
                    case "2": tiponum="2";tipo_comprobacion="Amex";break;
                    case "3": tiponum="3";tipo_comprobacion="Reembolso";break;
					case "4": tiponum="4";tipo_comprobacion="Amex externo";break;
                }
                     
				/*===== Nuevo ===*/
				if(tipo_comprobacion=="Amex"){
                    cargo_asociado=frm.select_tarjeta_cargo.value;
                }else{
                    cargo_asociado="0";
                }
				if($("#tipo option[value='"+ indice +"']").text() != "Amex"){
					$("#no_transaccion").html("N/A");
				}
				var valorcomida=$("#tipocomidadato").val();
				if (frm.referencia_corta.value!=""){
                    ref_cort=frm.referencia_corta.value;
                }else{
                    ref_cort="Sin Comentarios";
                }
				if($("#select_concepto").val() != 6){
                    asistentes = "N/A";
					var comida = "0";					
                }else{
                    asistentes =$("#no_asistentes").val();
					var comida = $("#tipocomidadato").val();					
                }				
				if ($("#proveedor").val()!=""){
                    prov_name=$("#proveedor").val();
                }else{
                    prov_name="N/A";
                }
				if ($("#rfc").val()!=""){
                    prov_rfc = $("#rfc").val();
                }else{
                    prov_rfc="N/A";
                }
				if($("#d_folio").val()!=""){
					factura = $("#d_folio").val();
				}else{
					factura = "N/A";
				}
				
				if(($("#concepto_alim_hot").val()=="alimentacion")||($("#concepto_alim_hot").val()=="hospedaje")){//informacion a persistir en la base de datos referente al concepto elegido
                    if($("#propina_dato").val()!=""){
                        propina=$("#propina_dato").val();
                       	propina_val=parseFloat(propina);
                    }
                }else{
                    propina="0";
                    propina_val=0;
                }			
				
				if(($("#concepto_alim_hot").val()=="hospedaje")){//informacion a persistir en la base de datos referente al concepto elegido
                    if($("#impuesto_hotel").val()!="" || $("#impuesto_hotel").val()!=0){
                        iva_hospedaje=$("#impuesto_hotel").val();
                    }
                }else{
                    iva_hospedaje="0";
                    $("#impuesto_hotel").val("0");
                }
				if(divisa == "MXN"){
					total=(Math.round(parseFloat($("#total").val().replace(/,/g,"")) * Math.pow(10, 2)) / Math.pow(10, 2));
					var totalmxn = total;
					var tiponumDivisa ="1";					
				}else if(divisa == "USD"){
					total=(Math.round(parseFloat($("#total").val().replace(/,/g,"")) * Math.pow(10, 2)) / Math.pow(10, 2));
					var totalmxn = total * parseFloat($("#valorDivisaUSD").val());
					var tiponumDivisa ="2";					
				}else if(divisa == "EUR"){
					total=(Math.round(parseFloat($("#total").val().replace(/,/g,"")) * Math.pow(10, 2)) / Math.pow(10, 2));
					var totalmxn = total * parseFloat($("#valorDivisaEUR").val());
					var tiponumDivisa ="3";					
				}
								
				if($("#idAmex").val()== "" || $("#idAmex").val()== null || $("#tipo").val() != 2 ){
					var valorIdmex = 0;
				}else{
					var valorIdmex = $("#idAmex").val();
				}				
				
				if($("#total_dolares").val() == "" || $("#total_dolares").val() == null){
					var total_dolares = 0;
				}else{
					var total_dolares = $("#total_dolares").val().replace(/,/g,"");
				}				
				if($("input[name=fact_chk]:checked").val()=="on"){
					valor_check="on";
				}else{
					valor_check="off";
				}			
				var tipoTarjeta = $("#select_tipo_tarjeta").val();
				var tipoCargo = $("#select_tarjeta_cargo").val();
                frm.rowCount.value=parseInt(frm.rowCount.value)+parseInt(1);
				
				if(concepto == 6){
					var tipoAlimentacion = frm.tipocomidadato.options[frm.tipocomidadato.selectedIndex].text + "- ";
				}else{ 
					var tipoAlimentacion = "";	
				}								
				//Se tomara el valor de la fecha que acaba de ingresar
				fechaSeleccionada = frm.fecha.value;
				
				//Se checa si se AGREGA o se ACTUALIZA un gasto.
				if(estatus_en_edicion_de_comprobacion){
					if($("#etapaComprobacion").val() == 5){
						// Dehabilitamos Campos de Montos en caso que la Comprobaciï¿½n este Devuelta con Observaciones 
						$("#monto").attr("disabled", "disabled");
						$("#moneda").attr("disabled", "disabled");
						$("#referencia_corta").attr("disabled", "disabled");
					}
					
					$("#registrar_comp").attr("value","     Registrar Gasto");
					estatus_en_edicion_de_comprobacion = false;
					partidaEdicion = 0;
					id = frm.itinerarioActualOPosible.value;
					$(".elimina").css("display","block");//devuelve el boton eliminar
					$(".del_part").html("Eliminar Partida");
					
					var nuevaFila='';
					nuevaFila+="<td>"+"<div id='renglonS"+id+"'>"+id+"</div>"+"<input type='hidden' name='row"+id+"' id='row"+id+"' value='"+id+"' readonly='readonly' /></td>";
					nuevaFila+="<td><input type='hidden' name='cargo_asociado"+id+"'id='cargo_asociado"+id+"' value='"+tipo_comprobacion+"'readonly='readonly' />"+tipo_comprobacion+"<input type='hidden' name='cargo_factura"+id+"'id='cargo_factura"+id+"' value='"+$("#monto_cargo").html().replace(/,/g,"")+"'readonly='readonly' /><input type='hidden' name='tipoComprobacion"+id+"'id='tipoComprobacion"+id+"' value='"+tiponum+"'readonly='readonly' /></td>";
					nuevaFila+="<td><input type='hidden' name='no_transaccion"+id+"'id='no_transaccion"+id+"' value='"+$("#no_transaccion").html()+"'readonly='readonly' />"+$("#no_transaccion").html()+"</td>";
					nuevaFila+="<td><input type='hidden' name='fecha"+id+"' id='fecha"+id+"' value='"+frm.fecha.value+"' readonly='readonly' />"+frm.fecha.value+"</td>";
					nuevaFila+="<td><input type='hidden' name='tipo_comida"+id+"' id='tipo_comida"+id+"' value='"+valorcomida+"' 	readonly='readonly' /><input type='hidden' name='concepto"+id+"' id='concepto"+id+"' value='"+frm.select_concepto.options[frm.select_concepto.selectedIndex].text+"' 	readonly='readonly' />"+tipoAlimentacion+""+frm.select_concepto.options[frm.select_concepto.selectedIndex].text+"</td>";
					nuevaFila+="<td><input type='hidden' name='comentario"+id+"' id='comentario"+id+"' value='"+ref_cort+"' readonly='readonly' />"+ref_cort+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='no_asistentes"+id+"' id='no_asistentes"+id+"' value='"+asistentes+"' readonly='readonly' />"+asistentes+"</td>";
					nuevaFila+="<td><input type='hidden' name='rfc"+id+"' id='rfc"+id+"' value='"+prov_rfc+"' readonly='readonly' />"+prov_rfc+"</td>";
					nuevaFila+="<td><input type='hidden' name='proveedor"+id+"' id='proveedor"+id+"' value='"+prov_name+"' readonly='readonly' />"+prov_name+"</td>";
					nuevaFila+="<td><input type='hidden' name='flag_factura"+id+"' id='flag_factura"+id+"' value='"+factura+"' readonly='readonly' />"+factura+"</td>";
					nuevaFila+="<td id='m'><input type='hidden' name='mnt"+id+"' id='mnt"+id+"' value='"+$("#monto").val()+"' readonly='readonly' />"+number_format($("#monto").val(),2,".",",")+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='pimpuesto"+id+"' id='pimpuesto"+id+"' value='"+frm.impuesto.value+"' readonly='readonly' />"+number_format($("#impuesto").val(),2,".",",")+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='propina"+id+"' id='propina"+id+"' value='"+propina+"' readonly='readonly' />"+number_format(propina,2,".",",")+"</td>"; 					
					nuevaFila+="<td><input type='hidden' name='impuesto_hospedaje"+id+"' id='impuesto_hospedaje"+id+"' value='"+iva_hospedaje+"' readonly='readonly' />"+number_format(iva_hospedaje,2,".",",")+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='tot"+id+"' id='tot"+id+"' value='"+total+"' readonly='readonly' />"+number_format(total,2,".",",")+"<input type='hidden' name='mensaje"+id+"' id='mensaje"+id+"' value='0' readonly='readonly' /><input type='hidden' name='diferencia"+id+"' id='diferencia"+id+"' value='0' readonly='readonly' /></td>";
					nuevaFila+="<td><input type='hidden' name='divisa"+id+"' id='divisa"+id+"' value='"+divisa+"' readonly='readonly' /><input type='hidden' name='tipoDivisa"+id+"' id='tipoDivisa"+id+"' value='"+tiponumDivisa+"' readonly='readonly' />"+divisa+"</td>";  
					nuevaFila+="<td><input type='hidden' name='totalMxn"+id+"' id='totalMxn"+id+"' value='"+totalmxn+"' readonly='readonly' />"+number_format(totalmxn,2,".",",")+"</td>";  
					nuevaFila+="<td><div align='center'><img src='../../images/addedit.png' alt='Click aqu&iacute; para editar Comprobacion' name='"+id+"edit' id='"+id+"edit' onclick='editarComprobacion(this.id);' style='cursor:pointer'/></div><div align='center'>Editar Partida</div></td>";
					nuevaFila+="<td><div align='center'><img class='elimina' src='../../images/delete.gif' alt='Click aqu&iacute; para Eliminar' name='"+id+"del' id='"+id+"del' onmousedown='borrarRenglonComprobacion(this.id,\"comprobacion_table\",\"rowCount\",\"rowDel\",\"renglonS\",\"edit\",\"del\",\"itinerarioActualOPosible\");' onclick='conceptoElimina(this.id); reiniciaComentarioObligatorio();' style='cursor:pointer;' /></div><div class='del_part' id='del_part"+id+"' align='center'>Eliminar Partida</div></td>";
					nuevaFila+= "<input type='hidden' id='idAmex"+id+"' name='idAmex"+id+"' value='"+valorIdmex+"' readonly='readonly'/><input type='hidden' id='totalDolares"+id+"' name='totalDolares"+id+"' value='"+total_dolares+"' readonly='readonly'/><input type='hidden' id='tipoComida"+id+"' name='tipoComida"+id+"' value='"+comida+"' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='numConcepto"+id+"' name='numConcepto"+id+"' value='"+concepto+"' readonly='readonly'/><input type='hidden' id='check"+id+"' name='check"+id+"' value='"+valor_check+"' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='tipoTarjeta"+id+"' name='tipoTarjeta"+id+"' value='"+tipoTarjeta+"' readonly='readonly'/><input type='hidden' id='listaCargo"+id+"' name='listaCargo"+id+"' value='"+tipoCargo+"' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='exConcepto"+id+"' name='exConcepto"+id+"' value='' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='difConcepto"+id+"' name='difConcepto"+id+"' value='0' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='idDetalleComp"+id+"' name='idDetalleComp"+id+"' value='0' readonly='readonly'/>";
					nuevaFila+= '';
					
					$("#comprobacion_table>tbody").find("tr").eq(id-1).html(nuevaFila);

					// Apagamos la bandera de Ediciï¿½n 
					$("#edicionAux").val(0);
					//alert("Etapa_actual: "+$("#etapaComprobacion").val());

					var idamex = $("#select_tarjeta_cargo").val();
					var total_idamex = 0;
					var no_partidas = parseInt($("#comprobacion_table>tbody>tr").length);
					var amex_pesos = $("#amex_pesos_val").val().replace(/,/g,"");
					
					for(var i=1; i<=no_partidas; i++){
						if(parseInt($("#idAmex"+i).val()) == parseInt(idamex)){
							total_idamex+= parseFloat($("#totalMxn"+i).val().replace(/,/g,""));
						}
					}
					amex_pesos = parseFloat(amex_pesos).toFixed(2);
					total_idamex = parseFloat(total_idamex).toFixed(2);
					//alert("Total cargo AMEX: "+amex_pesos);
					//alert("Total gastos AMEX: "+total_idamex);
					
					if(($("#etapaComprobacion").val() == 0) && (amex_pesos == total_idamex)){ // Nuevo registro de Comprobaciï¿½n 
						//Actualizar estatus idamex a 3 
						actualiza_status_idamex(idamex, 3);
					}else if(($("#etapaComprobacion").val() != 0) && (amex_pesos == total_idamex)){ // Ediciï¿½n de una Comprobaciï¿½n 
						//Actualizar estatus idamex a 1 
						actualiza_status_idamex(idamex, 1);
					}else{
						//Actualizar estatus idamex a 0 
						actualiza_status_idamex(idamex, 0);
					}
					
				}else{					
					//agrega 1 al contador de la partida 
					$("#rowCount").val(parseInt($("#rowCount").val())+parseInt(1)); 
					$("#rowCountCecos").val(parseInt($("#rowCountCecos").val())+parseInt(1)); 
					
					var nuevaFila='<tr>';
					nuevaFila+="<td>"+"<div id='renglonS"+id+"'>"+id+"</div>"+"<input type='hidden' name='row"+id+"' id='row"+id+"' value='"+id+"' readonly='readonly' /></td>";
					nuevaFila+="<td><input type='hidden' name='cargo_asociado"+id+"'id='cargo_asociado"+id+"' value='"+tipo_comprobacion+"'readonly='readonly' />"+tipo_comprobacion+"<input type='hidden' name='cargo_factura"+id+"'id='cargo_factura"+id+"' value='"+$("#monto_cargo").html().replace(/,/g,"")+"'readonly='readonly' /><input type='hidden' name='tipoComprobacion"+id+"'id='tipoComprobacion"+id+"' value='"+tiponum+"'readonly='readonly' /></td>";
					nuevaFila+="<td><input type='hidden' name='no_transaccion"+id+"'id='no_transaccion"+id+"' value='"+$("#no_transaccion").html()+"'readonly='readonly' />"+$("#no_transaccion").html()+"</td>";
					nuevaFila+="<td><input type='hidden' name='fecha"+id+"' id='fecha"+id+"' value='"+frm.fecha.value+"' readonly='readonly' />"+frm.fecha.value+"</td>";
					nuevaFila+="<td><input type='hidden' name='tipo_comida"+id+"' id='tipo_comida"+id+"' value='"+valorcomida+"' 	readonly='readonly' /><input type='hidden' name='concepto"+id+"' id='concepto"+id+"' value='"+frm.select_concepto.options[frm.select_concepto.selectedIndex].text+"' 	readonly='readonly' />"+tipoAlimentacion+""+frm.select_concepto.options[frm.select_concepto.selectedIndex].text+"</td>";
					nuevaFila+="<td><input type='hidden' name='comentario"+id+"' id='comentario"+id+"' value='"+ref_cort+"' readonly='readonly' />"+ref_cort+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='no_asistentes"+id+"' id='no_asistentes"+id+"' value='"+asistentes+"' readonly='readonly' />"+asistentes+"</td>";
					nuevaFila+="<td><input type='hidden' name='rfc"+id+"' id='rfc"+id+"' value='"+prov_rfc+"' readonly='readonly' />"+prov_rfc+"</td>";
					nuevaFila+="<td><input type='hidden' name='proveedor"+id+"' id='proveedor"+id+"' value='"+prov_name+"' readonly='readonly' />"+prov_name+"</td>";
					nuevaFila+="<td><input type='hidden' name='flag_factura"+id+"' id='flag_factura"+id+"' value='"+factura+"' readonly='readonly' />"+factura+"</td>";
					nuevaFila+="<td id='m'><input type='hidden' name='mnt"+id+"' id='mnt"+id+"' value='"+$("#monto").val()+"' readonly='readonly' />"+number_format($("#monto").val(),2,".",",")+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='pimpuesto"+id+"' id='pimpuesto"+id+"' value='"+frm.impuesto.value+"' readonly='readonly' />"+number_format($("#impuesto").val(),2,".",",")+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='propina"+id+"' id='propina"+id+"' value='"+propina+"' readonly='readonly' />"+number_format(propina,2,".",",")+"</td>"; 					
					nuevaFila+="<td><input type='hidden' name='impuesto_hospedaje"+id+"' id='impuesto_hospedaje"+id+"' value='"+iva_hospedaje+"' readonly='readonly' />"+number_format(iva_hospedaje,2,".",",")+"</td>"; 
					nuevaFila+="<td><input type='hidden' name='tot"+id+"' id='tot"+id+"' value='"+total+"' readonly='readonly' />"+number_format(total,2,".",",")+"<input type='hidden' name='mensaje"+id+"' id='mensaje"+id+"' value='0' readonly='readonly' /><input type='hidden' name='diferencia"+id+"' id='diferencia"+id+"' value='0' readonly='readonly' /></td>";
					nuevaFila+="<td><input type='hidden' name='divisa"+id+"' id='divisa"+id+"' value='"+divisa+"' readonly='readonly' /><input type='hidden' name='tipoDivisa"+id+"' id='tipoDivisa"+id+"' value='"+tiponumDivisa+"' readonly='readonly' />"+divisa+"</td>";  
					nuevaFila+="<td><input type='hidden' name='totalMxn"+id+"' id='totalMxn"+id+"' value='"+totalmxn+"' readonly='readonly' />"+number_format(totalmxn,2,".",",")+"</td>";  
					nuevaFila+="<td><div align='center'><img src='../../images/addedit.png' alt='Click aqu&iacute; para editar Comprobacion' name='"+id+"edit' id='"+id+"edit' onclick='editarComprobacion(this.id);' style='cursor:pointer'/></div><div align='center'>Editar Partida</div></td>";
					nuevaFila+="<td><div align='center'><img class='elimina' src='../../images/delete.gif' alt='Click aqu&iacute; para Eliminar' name='"+id+"del' id='"+id+"del' onmousedown='borrarRenglonComprobacion(this.id,\"comprobacion_table\",\"rowCount\",\"rowDel\",\"renglonS\",\"edit\",\"del\",\"itinerarioActualOPosible\");' onclick='conceptoElimina(this.id); reiniciaComentarioObligatorio();' style='cursor:pointer;' /></div><div id='del_part"+id+"' align='center'>Eliminar Partida</div></td>";
					nuevaFila+= "<input type='hidden' id='idAmex"+id+"' name='idAmex"+id+"' value='"+valorIdmex+"' readonly='readonly'/><input type='hidden' id='totalDolares"+id+"' name='totalDolares"+id+"' value='"+total_dolares+"' readonly='readonly'/><input type='hidden' id='tipoComida"+id+"' name='tipoComida"+id+"' value='"+comida+"' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='numConcepto"+id+"' name='numConcepto"+id+"' value='"+concepto+"' readonly='readonly'/><input type='hidden' id='check"+id+"' name='check"+id+"' value='"+valor_check+"' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='tipoTarjeta"+id+"' name='tipoTarjeta"+id+"' value='"+tipoTarjeta+"' readonly='readonly'/><input type='hidden' id='listaCargo"+id+"' name='listaCargo"+id+"' value='"+tipoCargo+"' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='exConcepto"+id+"' name='exConcepto"+id+"' value='' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='difConcepto"+id+"' name='difConcepto"+id+"' value='0' readonly='readonly'/>";
					nuevaFila+= "<input type='hidden' id='idDetalleComp"+id+"' name='idDetalleComp"+id+"' value='0' readonly='readonly'/>";
					
					nuevaFila+= '</tr>';							
					indiceGlobal = -1;
					
					 //restablece los campos 
					$("#prm_valido").val("");
					$("#comprobacion_table").append(nuevaFila);

					//Actualizar estatus idamex a 3 
					var idamex = $("#select_tarjeta_cargo").val();
					var total_idamex = 0;
					var no_partidas = parseInt($("#comprobacion_table>tbody>tr").length);
					var amex_pesos = $("#amex_pesos_val").val().replace(/,/g,"");
				
					for(var i=1; i<=no_partidas; i++){
						if(parseInt($("#idAmex"+i).val()) == parseInt(idamex)){
							total_idamex+= parseFloat($("#totalMxn"+i).val().replace(/,/g,""));
						}
					}
					
					amex_pesos = parseFloat(amex_pesos).toFixed(2);
					total_idamex = parseFloat(total_idamex).toFixed(2);
					
					if(amex_pesos == total_idamex){
						actualiza_status_idamex(idamex, 3);
					}else{
						actualiza_status_idamex(idamex, 0);
					}
				}
				frm.itinerarioActualOPosible.value = parseInt($("#comprobacion_table>tbody >tr").length)+parseInt(1);
				
                frm.no_Comprobaciones_parciales.value=parseInt(frm.no_Comprobaciones_parciales.value)+1;      
                $("#monto").val(0);
                $("#tasa").val(1);
                $("#impuesto").val(0);
                $("#total").val(0);
                $("#referencia_corta").val("");
                $("#d_folio").val("");
                $("#proveedor").val("");
                $("#rfc").val("");
                $('#select_concepto').find('option:first').attr('selected', 'selected').parent('select');	
                $('#moneda').find('option:first').attr('selected', 'selected').parent('select');
                $('#tipocomidadato').find('option:first').attr('selected', 'selected').parent('select');			
                $('#select_tarjeta_cargo').find('option:first').attr('selected', 'selected').parent('select');			
                $("#no_corporacion_val").val("");
                $("#moneda_local_val").val("");
                $("#moneda_fact").html("");             
                $("#moneda_local").html("");
				$("#total_dolares").val(0);
				$("#fecha").val(obtiene_fecha());
				$("#tipo_comida_label").css("display","none");
				$("#div_tipo_comida_label").css("display","none");
				if(tipo_comprobacion=="Amex"){
					limpiar_cuadro_amex();
					if($("#amex_form").hasClass("visible")){
			            $("#amex_form").slideUp(1000);
			            $("#amex_form").removeClass("visible");
					}
					$("#fact_chk:checkbox").removeAttr("checked");
					$("#div_iva").css("display", "none"); 
					$("#impuesto").css("display", "none");
					verificaFactura();
				}else{
					limpiar_cuadro_amex();
					$("#moneda_fact_val").val("");
					$("#fecha_cargo_val").val("");
					$("#establecimiento_cargo_val").val("");
					$("#monto_cargo_val").val("");
					$("#amex_pesos_val").val("");
					$("#amex_dolar_val").val("");
					$("#rfc_cargo_val").val("");
					$("#moneda_local_val").val("");
					$("#select_tipo_tarjeta").val("-1");
					$("#tipo_cambio").val("");
					$("#propina_dato").val("0");
					$("#impuesto_hotel").val("0");
					$("#d_folio").val("");
					$("#rfc").val("");
					$("#proveedor").val("");
					$("#fact_chk:checkbox").removeAttr("checked");
					$("#div_iva").css("display", "none"); 
					$("#impuesto").css("display", "none"); 
					verificaFactura();
				}                
				borraPropina();
				
				$("#tipo").val(1);
				$("#sol_select").attr("disabled","disbaled");
				
				//tipo_de_comprobacion(1);
				
				if(!bandera){
					$("#registrar_comp").removeAttr("disabled");
					$("#guardarPrev").removeAttr("disabled");
				}else{
					$("#registrar_comp").attr("disabled","true");
					$("#guardarPrev").attr("disabled","true");					
				}
				cCObligatorio = 0;
				$("#tipo").val("-1");
            }//construye partida

			function calculartotal(){
				var frm=document.detallecomp;
				var dato=frm.rowCount.value;
				var anticipo=parseFloat($("#t_saldo").val());
				var i=0;
				var total=0;
				var totalamex=0;
				var totalreembolso=0;
				var descuento=0;
				var monto_descuento=0;
				var monto_reembolso=0;
				var totalcomprobacion=0;
				
				if(anticipo=="NaN"){
					anticipo=0;
					}

				 for (i=1;i<=parseInt(frm.rowCount.value);i++){
					 var jquerymonto="#tot"+parseInt(i);
					 var jquerytipo="#tipo"+parseInt(i);

					 if($(jquerytipo).val()==2){			 
						 totalamex=parseFloat(totalamex)+parseFloat($(jquerymonto).val());
					 }else if($(jquerytipo).val()==3){
							totalreembolso=parseFloat(anticipo)-(parseFloat(totalreembolso)+parseFloat($(jquerymonto).val()));
					}
						
					 total=parseFloat(total)+parseFloat($(jquerymonto).val());
					if(parseFloat(anticipo)>parseFloat(total)){
						monto_descuento=parseFloat(anticipo)-parseFloat(total);
					}else{
						monto_descuento=parseFloat(anticipo)-parseFloat(total);
					}

					if(parseFloat(totalreembolso)!=0){
						monto_reembolso=parseFloat(monto_reembolso)+parseFloat(totalreembolso);
					}else if(total>anticipo){
							monto_reembolso=(parseFloat(total)-parseFloat(anticipo))+parseFloat(monto_reembolso);
						}
					
				}
					
				 $("#g_sbt").html(parseFloat(total));
				 $("#t_subtotal").val(parseFloat(total));
				 $("#g_amex_comprobado").html(parseFloat(totalamex));
				 $("#t_amex_comprobado").val(parseFloat(totalamex));
				 $("#g_comprobado").html(parseFloat(total));
				 $("#t_comprobado").val(parseFloat(total));
				 $("#g_nocomprobado").html(parseFloat(monto_descuento));
				 $("#t_nocomprobado").val(parseFloat(monto_descuento));
				 $("#g_reembolso").html(parseFloat(monto_reembolso));
				 $("#t_reembolso").val(parseFloat(monto_reembolso));
			 
			}
			
            function borrarPartida(id){ 
				var firstRow=parseInt($("#comprobacion_table").find("tr:first").find("td").eq(0).html());
                var lastRow=parseInt($("#comprobacion_table").find("tr:last").find("td").eq(0).html());                
                var frm=document.detallecomp;
                var row=frm.rowCount.value;
                    
                $("img.elimina").click(function(){
					var tipo=$("#tipo"+parseInt(id)).val();
                    var total=parseFloat($("#tot"+parseInt(id)).val());			
                    var subtractTotal=0;
                  	//Devolver estatus idamex a 0
                    if($("#cargo_asociado"+parseInt(id)).val() != 0){
                    	devolver_status_idamex($("#cargo_asociado"+parseInt(id)).val());
                    }
                    $("#prm_valido").val("");
                    $(this).parent().parent().parent().fadeOut("normal", function () {
                    	
                        $(this).remove();
                        frm.no_Comprobaciones_parciales.value=parseInt(frm.no_Comprobaciones_parciales.value)-1;
                        frm.rowCount.value=parseInt(frm.rowCount.value)-parseInt(1);
                        //alert(parseInt(frm.rowCount.value));
                        var i=0;
                        for (i=parseInt(id);i<=parseInt(frm.rowCount.value);i++){
                        	var nextrenglon="renglonS"+((parseInt(i)+(1)));
            				var renglon="renglonS"+parseInt(i);
            				var nextrow="row"+((parseInt(i)+(1)));
            				var row="row"+parseInt(i); 
            				var jqueryrow="input[name=row"+parseInt(i)+"]";
            				var nextcargo="cargo_asociado"+((parseInt(i)+(1)));
            				var cargo="cargo_asociado"+parseInt(i);
            				var jquerycargo="#cargo_asociado"+parseInt(i);
            				var nexttipo="tipo"+((parseInt(i)+(1)));
            				var tipo="tipo"+parseInt(i);
            				var jquerytipo="#tipo"+parseInt(i);
            				var nextfecha="fecha"+((parseInt(i)+(1)));
            				var fecha="fecha"+parseInt(i);
            				var jqueryfecha="#fecha"+parseInt(i);
            				var nextconcepto="concepto"+((parseInt(i)+(1)));
            				var concepto="concepto"+parseInt(i);
            				var jqueryconcepto="#concepto"+parseInt(i);
            				var nextcomentario="comentario"+((parseInt(i)+(1)));
            				var comentario="comentario"+parseInt(i);
            				var jquerycomentario="#comentario"+parseInt(i);
            				var nextasistentes="no_asistentes"+((parseInt(i)+(1)));
            				var asistentes="no_asistentes"+parseInt(i);
            				var jqueryasistentes="#no_asistentes"+parseInt(i);
            				var nextproveedor="proveedor"+((parseInt(i)+(1)));
            				var proveedor="proveedor"+parseInt(i);
            				var jqueryproveedor="#proveedor"+parseInt(i);
            				var nextrfc="rfc"+((parseInt(i)+(1)));
            				var rfc="rfc"+parseInt(i);
            				var jqueryrfc="#rfc"+parseInt(i);
            				var nextfactura="flag_factura"+((parseInt(i)+(1)));
            				var factura="flag_factura"+parseInt(i);
            				var jqueryfactura="#flag_factura"+parseInt(i);
            				var nextmonto="mnt"+((parseInt(i)+(1)));
            				var monto="mnt"+parseInt(i);
            				var jquerymonto="#mnt"+parseInt(i);
            				var nextdivisa="divisa"+((parseInt(i)+(1)));
            				var divisa="divisa"+parseInt(i);
            				var jquerydivisa="#divisa"+parseInt(i);
            				var nexttasa="tasa"+((parseInt(i)+(1)));
            				var tasa="tasa"+parseInt(i);
            				var jquerytasa="#tasa"+parseInt(i);
            				var nextpimpuesto="pimpuesto"+((parseInt(i)+(1)));
            				var pimpuesto="pimpuesto"+parseInt(i);
            				var jquerypimpuesto="#pimpuesto"+parseInt(i);            				
            				var nextimpuesto="imp"+((parseInt(i)+(1)));
            				var impuesto="imp"+parseInt(i);
            				var jqueryimpuesto="#imp"+parseInt(i);
            				var nextpropina="propina"+((parseInt(i)+(1)));
            				var propina="propina"+parseInt(i);
            				var jquerypropina="#propina"+parseInt(i);
            				var nextimpuestohospedaje="impuesto_hospedaje"+((parseInt(i)+(1)));
            				var impuestohospedaje="impuesto_hospedaje"+parseInt(i);
            				var jqueryimpuestohospedaje="#impuesto_hospedaje"+parseInt(i);
            				var nextimpH="impH"+((parseInt(i)+(1)));
            				var impH="impH"+parseInt(i);
							var jqueryimpH="#impH"+parseInt(i);
            				var nexttotal="tot"+((parseInt(i)+(1)));
            				var total="tot"+parseInt(i);
            				var jquerytotal="#tot"+parseInt(i);            				
            				var nextmensaje="mensaje"+((parseInt(i)+(1)));
            				var mensaje="mensaje"+parseInt(i);
            				var jquerymensaje="#mensaje"+parseInt(i);           				
            				var nextdiferencia="diferencia"+((parseInt(i)+(1)));
            				var diferencia="diferencia"+parseInt(i);
            				var jquerydiferencia="#diferencia"+parseInt(i);
            				var nextdelete=((parseInt(i)+(1)))+"delete";
            				var del=parseInt(i)+"delete";
            				var jquerydel="#"+parseInt(i)+"delete";
            				var nexttipocomida="tipo_comida"+((parseInt(i)+(1)));
            				var tipocomida="tipo_comida"+parseInt(i);
            				var jquerytipocomida="#tipo_comida"+parseInt(i); 
            				
            				 document.getElementById(nextrenglon).setAttribute("id",renglon);
            				 document.getElementById(renglon).innerHTML=i;	
            				 document.getElementById(nextrow).setAttribute("name",row);
            				 $(jqueryrow).attr("id",row);
            				 $(jqueryrow).val(parseInt(i));
            		       	 document.getElementById(nextcargo).setAttribute("id",cargo);
            		         $(jquerycargo).attr("name",cargo);
            		         document.getElementById(nexttipo).setAttribute("id",tipo);
            		         $(jquerytipo).attr("name",tipo);
            		         document.getElementById(nextfecha).setAttribute("id",fecha);
            		         $(jqueryfecha).attr("name",fecha);
            		         document.getElementById(nextconcepto).setAttribute("id",concepto);
            		         $(jqueryconcepto).attr("name",concepto);
            		         document.getElementById(nextcomentario).setAttribute("id",comentario);
            		         $(jquerycomentario).attr("name",comentario);
            		         document.getElementById(nextasistentes).setAttribute("id",asistentes);
            		         $(jqueryasistentes).attr("name",asistentes);
            		         document.getElementById(nextproveedor).setAttribute("id",proveedor);
            		         $(jqueryproveedor).attr("name",proveedor);
            		         document.getElementById(nextrfc).setAttribute("id",rfc);
            		         $(jqueryrfc).attr("name",rfc);
            		         document.getElementById(nextfactura).setAttribute("id",factura);
            		         $(jqueryfactura).attr("name",factura);
            		         document.getElementById(nextmonto).setAttribute("id",monto);
            		         $(jquerymonto).attr("name",monto);
            		         document.getElementById(nextdivisa).setAttribute("id",divisa);
            		         $(jquerydivisa).attr("name",divisa);
            		         document.getElementById(nexttasa).setAttribute("id",tasa);
            		         $(jquerytasa).attr("name",tasa);
            		         document.getElementById(nextpimpuesto).setAttribute("id",pimpuesto);
            		         $(jquerypimpuesto).attr("name",pimpuesto);
            		         document.getElementById(nextimpuesto).setAttribute("id",impuesto);
            		         $(jqueryimpuesto).attr("name",impuesto);
            		         document.getElementById(nexttipocomida).setAttribute("id",tipocomida);
            		         $(jquerytipocomida).attr("name",tipocomida);
            		         document.getElementById(nextimpuestohospedaje).setAttribute("id",impuestohospedaje);
            		         $(jqueryimpuestohospedaje).attr("name",impuestohospedaje);
            		         
            		         document.getElementById(nextimpH).setAttribute("id",impH);
            		         $(jqueryimpH).attr("name",impH);
            		         
            		         document.getElementById(nextpropina).setAttribute("id",propina);
            		         $(jquerypropina).attr("name",propina);
            		         
            		         document.getElementById(nexttotal).setAttribute("id",total);
            		         $(jquerytotal).attr("name",total);
            		         
            		         document.getElementById(nextmensaje).setAttribute("id",mensaje);
            		         $(jquerymensaje).attr("name",mensaje);
            		         document.getElementById(nextdiferencia).setAttribute("id",diferencia);
            		         $(jquerydiferencia).attr("name",diferencia);
            		         document.getElementById(nextdelete).setAttribute("id",del);
            		         $(jquerydel).attr("name",del);

            		                             
                         }
                        guardaComprobacion();
                        calculartotal();
                    });

                    return false;
                });                                                                                                                                                                	
            }//borrar partida


            function guardaComprobacion(){                           
                var frm=document.detallecomp;                
                if(parseInt(frm.no_Comprobaciones_parciales.value)>=1){
                    $("#guardarComp").removeAttr("disabled");
                }else{
                    $("#guardarComp").attr("disabled", "disabled");
                }
            }                        

			//=========================================================
			//muestra el div y el campo de IVA
			function muestraIva(){
				var divisa = $("#moneda").val();
				if (divisa == "MXN"){
					var impuesto = $("#monto").val()*.16;
					$("#div_iva").css("display", "block"); 
					$("#impuesto").css("display", "block"); 
					$("#impuesto").val(impuesto.toFixed(2));
					$("#total").val( parseFloat($("#monto").val()) + parseFloat($("#impuesto").val()));									
				}else if(!$("#fact_chk").is(":checked")){
					$("#div_iva").css("display", "none"); 
					$("#impuesto").css("display", "none"); 				
					$("#impuesto").val(0);
					$("#total").val( parseFloat($("#monto").val()));	
				}			
				calculaTotalDolares();
			}
			
			function muestraIva2(){				
				if ($("#fact_chk").is(":checked")){
					var impuesto = $("#monto").val()*.16;
					$("#div_iva").css("display", "block"); 
					$("#impuesto").css("display", "block"); 
					$("#impuesto").val(impuesto.toFixed(2));		
					$("#total").val( parseFloat($("#monto").val()) + parseFloat($("#impuesto").val()) );				
				}else if($("#moneda").val()!="MXN"){
					$("#div_iva").css("display", "none"); 
					$("#impuesto").css("display", "none"); 		
					$("#impuesto").val(0);										
					$("#total").val( parseFloat($("#monto").val()));	
				}
				calculaTotalDolares();
			}			
			
			function calculaTotalDolares(){
				var moneda = $("#moneda").val();
				var monto = parseFloat($("#monto").val().replace(/,/g,""));
				var iva = ($("#impuesto").val() =="")? 0 : parseFloat($("#impuesto").val().replace(/,/g,""));				
				var propina = ($("#propina_dato").val() == "") ? 0 : parseFloat($("#propina_dato").val().replace(/,/g,""));
				var impHospedaje = ($("#impuesto_hotel").val() == "") ? 0 : parseFloat($("#impuesto_hotel").val().replace(/,/g,""));
				var total = parseFloat(iva)+parseFloat(monto)+parseFloat(propina)+parseFloat(impHospedaje);
				total = total.toFixed(2);
				$("#total").val(number_format(total,2,".",","));
				
				if(moneda == -1){
					$("#total_dolares").val(number_format(total,2,".",","));
					//ComentariosObligatorios();
				}else{
					$.ajax({      
				        type: "POST",
				        url: "services/Ajax_comprobacion.php",
				        data: "convierteDivisa="+parseFloat($("#total").val().replace(/,/g,""))+"&divisa="+moneda,
				        dataType: "json",
				        timeout: 10000,
				        success: function(json){
				        	$("#total_dolares").val(number_format(json,2,".",","));		        	
				        },complete: function(json){
				        	ComentariosObligatorios();
					    },
					    error: function(x, t, m) {
							if(t==="timeout") {
								calculaTotalDolares();
							}
						}
					});
				}
			}		
			
			function validaImpuestoHotelRequerido(){
				if($("#select_concepto").val()==5 && $("#fact_chk").is(":checked")==true){
					$("#div_impuesto_hospedaje").html("Impuesto hospedaje<span class='style1' >*</span>:");
				}else{
					$("#div_impuesto_hospedaje").html("Impuesto hospedaje:");
				}					
			}
			
			function borraPropina(){
				$("#impuesto_hotel").val('0');				
				$("#propina_dato").val('0');
				if( $("#select_concepto").val() != 6 ){
					$("#tipocomidadato").val('0');
				}
				calculaTotalDolares();
			}
			
			function validaPoliticasComentario(){
				if($("#select_concepto").val()==6){
					if($("#no_asistentes").val() > 1 ){
						$("#comentarioReq").html("Comentario<span class='style1' >*</span>:");
					}else{
						if($("#excedeMontoComentarios").val() == 1){
							$("#comentarioReq").html("Comentario<span class='style1' >*</span>:");
						}else{							
							$("#comentarioReq").html("Comentario:");
						}
					}
				}else if($("#select_concepto").val()==25){
					/* Validarï¿½ que si el concepto es Otros Gastos, colocarï¿½ el asterisco para indicar que el campo 
					 * de Comentarios es obligatorio.
					*/ 
					$("#comentarioReq").html("Comentario<span class='style1' >*</span>:");					
				}else{
					$("#comentarioReq").html("Comentario:");
				}	
			}

			// Solo seleccionaremos el cargo AMEX del Gasto que se registro previamente 
			function cargaGastoUnicoAmex(idAmex_en_edicion){
				var frm=document.detallecomp;
				$.ajax({
					type: "POST",
					url: "services/Ajax_comprobacion.php",
					dataType: "json",
					data: "idcargoAMEX="+idAmex_en_edicion,
					async: false, 
					timeout: 10000,
					success: function(json){
						if(json==null){
							$("#select_tarjeta_cargo").append(new Option("Sin Datos"));
						}else{
							arreglovalores.splice(0,arreglovalores.length);
							arregloestatus.splice(0,arregloestatus.length);
							arreglodescripcion.splice(0,arreglodescripcion.length);
							LlenarCombo(json, frm.select_tarjeta_cargo);
							LlenarCombo2(arreglovalores,arreglodescripcion,arregloestatus,frm.select_tarjeta_cargo);
						}
					},
					complete: function(json){
					},
					error: function(x, t, m) {
						if(t==="timeout") {
							cargaGastoUnicoAmex(idAmex_en_edicion);
						}
					}
				});
			}
			
			function verificar_tipo_tarjeta(){
				var frm= document.detallecomp;
                var tipo_tarjeta=frm.select_tipo_tarjeta.value;
                var noemple="<?php echo $iduser = (isset($_SESSION["iddelegado"])) ? verificaSesion($_SESSION["idusuario"], $_SESSION["iddelegado"]) : $_SESSION["idusuario"]; ?>";
				(tipo_tarjeta == 2) ? $("#fact_chk").attr("disabled",true):$("#fact_chk").removeAttr("disabled");

				// Apartado para seleccionar el gasto AMEX mediante su ID 
				var aux = $("#edicionAux").val();
				aux = aux.split("|");
				var bandera_gasto_en_edicion = aux[0];
				var idAmex_en_edicion = aux[1];
				
				if(tipo_tarjeta != "" && tipo_tarjeta != "-1"){
					limpiar_cuadro_amex(0);
					$.ajax({
						type: "POST",
						url: "services/Ajax_comprobacion.php",
						data: "tipo_tarjeta="+tipo_tarjeta+"&usuario="+noemple,
						dataType: "html",
						async: false,
						timeout: 10000,
						success: function(dato){
							if(dato == ""){
								$("#no_tarjeta_credito").html("Datos no Encontrados");
								$("#select_tarjeta_cargo").empty();
								$("#select_tarjeta_cargo").append('<option value="-1">Sin Datos</option>');
							}else{
								$("#no_tarjeta_credito").html(dato);
								if(bandera_gasto_en_edicion == 1){ // Solo se cargara el gasto cuyo ID corresponda 
									cargaGastoUnicoAmex(idAmex_en_edicion);
								}else{
									obtenercargos(dato);
								}
							}
						},
						error: function(x, t, m) {
							if(t==="timeout") {
								location.reload();
									 abort();
							}
						}
					});
				}else{
					limpiar_cuadro_amex();
				}				
			}

			function limpiar_cuadro_amex(limpiaTarjeta){
				var frm= document.detallecomp;
				arreglovalores.splice(0,arreglovalores.length);
				arregloestatus.splice(0,arregloestatus.length);
				arreglodescripcion.splice(0,arreglodescripcion.length);
				LimpiarCombo(frm.select_tarjeta_cargo);
				
				$("#fecha_cargo").html("");
				$("#establecimiento_cargo").html("");
				$("#monto_cargo").html(""); 
				$("#rfc_cargo").html("");
				$("#moneda_local").html("");
				$("#amex_pesos").html("");
				$("#amex_dolar").html("");
				$("#moneda_fact_val").val("");
				$("#fecha_cargo_val").val("");
				$("#establecimiento_cargo_val").val("");
				$("#monto_cargo_val").val("");
				$("#amex_pesos_val").val("");
				$("#amex_dolar_val").val("");
				$("#rfc_cargo_val").val("");
				$("#moneda_local_val").val("");
				$("#no_tarjeta_credito").html("");
				if(limpiaTarjeta != ""){
					$("#select_tipo_tarjeta").val("-1");
				}
				$("#no_transaccion").html("");
				$("#tipo_cambio").val("");
				$("#div_tipo_cambio").html("");
				$("#d_folio").val("");
				$("#rfc").val("");
				$("#proveedor").val("");
			}

			function obtenercargos(valor){				
				var frm=document.detallecomp;
				var tramite = $("#tramiteComprobacion").val();
				LimpiarCombo(frm.select_tarjeta_cargo);
				if(valor != ""){
					$.ajax({
						type: "POST",
						url: "services/Ajax_comprobacion.php",
						data: "no_tarjeta="+valor+"&comprobacion="+tramite,
						dataType: "json",
						async: false,
						timeout: 10000,
						success: function(json){
							if(json==null){
								$("#select_tarjeta_cargo").append(new Option("Sin Datos"));
							}else{								
								arreglovalores.splice(0,arreglovalores.length);
								arregloestatus.splice(0,arregloestatus.length);
								arreglodescripcion.splice(0,arreglodescripcion.length);
								LlenarCombo(json, frm.select_tarjeta_cargo);
								LlenarCombo2(arreglovalores,arreglodescripcion,arregloestatus,frm.select_tarjeta_cargo);
							}
						},
						error: function(x, t, m) {
							if(t==="timeout") {
								location.reload();
									 abort();
							}
						}
					});
				}													
			}
			
			function LlenarCombo(json, combo){
				combo.options[0] = new Option('Selecciona un item', '');
				for(var i=0;i<json.length;i++){
					var str=json[i];
					var str1=str.slice(str.search(":")+1);
					var str2=str.substr(0,str.search(":"));
					arreglovalores[arreglovalores.length]=str1;
					arreglodescripcion[arreglodescripcion.length]=str2;
					if(arregloestatus[arregloestatus.length]!=false)
					arregloestatus[arregloestatus.length]=true;	
				}
			}
			
			function LlenarCombo2(arregloval,arreglodesc,arreglosts,combo){
				var frm=document.detallecomp;
				LimpiarCombo(combo);
				combo.options[0]=new Option('Selecciona un item', '');
				for(var i=0;i<arregloval.length;i++){
					if(arreglosts[i]==true){
						combo.options[combo.length] = new Option(arregloval[i],arreglodesc[i]);
						if(combo.options[i+1].value == frm.id_cargo_amex_seleccionado.value){
							combo.options[i+1].selected = true;
							cargar_detalles();
						}
					}
				}
			}
			
			function LimpiarCombo(combo){
				while(combo.length > 0){
					combo.remove(combo.length-1);
				}
			}
			
			//elimina el concepto personal cuando el gasto es por reembolso
			function modifica_conceptos(){
				if( $("#tipo").val()==3){
					$("#select_concepto option[value='31']").remove();					
				}else{				
					$("#select_concepto option[value='31']").remove();				
					$("#select_concepto").append('<option value="31">Personal</option>');							
				}							
			}
			
			//elimina el concepto personal cuando el gasto es por reembolso
			function modifica_autos(){			
			var autoParticular = "2";
				var select_tipoAuto = $("#select_tipo_auto");
				var select_modeloAuto = $("#select_modelo");
				
				select_modeloAuto.empty();

				if( select_tipoAuto.val() == autoParticular){				
					select_modeloAuto.append("<option value='1'>Auto particular</option>");							
				}else if( select_tipoAuto.val() != "-1"){										
					<?PHP 										
					$sql = "SELECT ma_id, ma_nombre FROM modelo_auto WHERE ma_id != 1";
					$res = mysql_query($sql);
					while($row = mysql_fetch_assoc($res)){
						$id = $row['ma_id'];
						$modelo = $row['ma_nombre'];
						echo 'select_modeloAuto.append("<option value=\''.$id.'\'>'.$modelo.'</option>");';						
					}					
					?>
				}else 
					select_modeloAuto.append("<option value='-1'>Seleccione...</option>");											
			}
			
			
			function tipo_de_comprobacion(valor){
				var frm=document.detallecomp;
				
				if(frm.tipo.value == 2){
					$("#amex_form").slideDown(1000);            
                    $("#amex_form").css("display", "block");
                    $("#amex_form").addClass("visible");				
				}else{					
					if($("#amex_form").hasClass("visible")){
                        $("#amex_form").slideUp(1000);
                        $("#amex_form").removeClass("visible");
						//$("#fact_chk").removeAttr("disabled");		
						//$("#fact_chk").attr("checked",false);	                        
						//$("#factura_form").slideUp(1000);
						//$("#d_folio").val("");
						//$("#rfc").val("");
						//$("#proveedor").val("");
                    }					
				}				
				if(valor == 3){
					$("#g_reembolso").html();
					$("#t_reembolso").val();
					$("#g_amex_comprobado").html("0.00 MXN");
					$("#t_amex_comprobado").val(0);
					$("#g_comprobado").html();
					$("#t_comprobado").val();
				}else if(valor == "amex"){
					$("#g_amex_comprobado").html($("#monto_pesos").val().replace(/,/g,"")+" MXN");
					$("#t_amex_comprobado").val($("#monto_pesos").val());
					$("#g_reembolso").html("0.00 MXN");
					$("#t_reembolso").val(0);
					$("#g_comprobado").html($("#monto_pesos").val().replace(/,/g,"")+" MXN");
					$("#t_comprobado").val($("#monto_pesos").val());
				}else if(valor == "-1"){
					$("#g_amex_comprobado").html("0.00 MXN");
					$("#t_amex_comprobado").val(0);
					$("#g_reembolso").html("0.00 MXN");
					$("#t_reembolso").val(0);
					$("#g_comprobado").html("0.00 MXN");
					$("#t_comprobado").val(0);
				}
				//Reinicio de valores Cuadro AMEX y Proveedor 
				limpiar_cuadro_amex();
				$("#fact_chk").attr("checked",false);
				 $("#factura_form").slideUp(1000);
                 frm.d_folio.disabled=true;
					$("#rfc").val('');
					$("#d_folio").val('');
					$("#proveedor").val('');
					$("#fact_chk").removeAttr("disabled");	
			}
			 
		//ESTA FUNCIï¿½N REVISA QUE TODO LO QUE SE ESCRIBA ESTï¿½ EN ORDEN
		function revisaCadena(textItem){
			
			if(textItem.value.substring(0,1) == '.') 
				textItem.value = '0' + textItem.value;			
			if(!cumpleReglas(textItem.value))
				textItem.value = textoAnterior;
			else //todo en orden
				textoAnterior = textItem.value;
		}//end function revisaCadena
		/***************************************************************************/
		//VARIABLE GLOBAL
		var textoAnterior = '';

		//ESTA FUNCIï¿½N DEFINE LAS REGLAS DEL JUEGO
		function cumpleReglas(simpleTexto){			
			var expresion = new RegExp("^(|([0-9]{1,30}(\\.([0-9]{1,2})?)?))$");

			if(expresion.test(simpleTexto))
				return true;
			return false;
		}//end function checaReglas
		
		function obtiene_fecha() {   
			var fecha_actual = new Date()  
			var dia = fecha_actual.getDate()  
			var mes = fecha_actual.getMonth() + 1  
			var ano = fecha_actual.getFullYear()  
		  
			if (mes < 10)  
				mes = '0' + mes  
			if (dia < 10)  
				dia = '0' + dia  
			return (dia + "/" + mes + "/" + ano);
		}
		
		function confirmSave(val){			
			var valor = false;
			var msg = (val == 1) ? "Est"+arrayAcentos["a"]+" seguro que desea enviar la Comprobaci"+arrayAcentos["o"]+"n" : "Est"+arrayAcentos["a"]+" seguro que desea guardar est"+arrayAcentos["o"]+" Comprobaci"+arrayAcentos["o"]+"n como previo";
			if(confirm("AVISO: "+arrayAcentos["Int"]+""+msg+"?")){
				$("#sol_select").removeAttr("disabled");
				valor = true;
			}
			return valor;
		}
		
		function validacion(){
			//Validacion concepto
			if(!confirmSave(1)) return false;
										
			var no_conceptos = parseInt($("#comprobacion_table>tbody >tr").length);
			var miArray = new Array();
			for(i = 1; i <= no_conceptos; i++){
				if($("#cargo_asociado"+i).val() == "Amex" || $("#cargo_asociado"+i).val() == "AMEX"){
					var cargo_factura = $("#totalMxn"+i).val().replace(/,/g,"");
					var transacion = $("#idAmex"+i).val();
					var existe = false;
					
					for(j=0;j<miArray.length;j++){
						if(transacion == miArray[j][0]){												
							existe = true;					
						}
					}						
					if(!existe){						
						miArray[miArray.length] = transacion;
					}
				}
			}	
			
			var ver_fal=true;
			for(z=0;z<miArray.length;z++){
				var resultado = valida_suma_cargo2(miArray[z]);								
				resultado = resultado.toFixed(2);
				var idamex = miArray[z];								
				var url = "services/Ajax_comprobacion.php";								
				$.ajaxSetup({async:false});				
				$.post(url,{resultadoAmex:resultado,transacionAmex:idamex}, function(data){
					if (data != "0"){															
						alert("El total de los conceptos ingresados en la transacci"+arrayAcentos["o"]+"n "+ data +" difiere al Total Amex");	
						ver_fal = false;				
					}
				});				
			}
			
			if(ver_fal){
				return (validaGasolina());																
			}else{
				return false;
			}			
			
		}		
		
		function valida_suma_anticipo(){
			var val = true;
			var anticipoComprobado2 = 0;
			var id = $("#itinerarioActualOPosible").val();
			var anticipo = parseFloat($("#anticipo_solicitado2").val().replace(/,/g,""));
			var no_partidas = parseInt($("#comprobacion_table>tbody>tr").length);
			var total_monto = parseFloat($("#total_dolares").val().replace(/,/g,""));
			for(i=1; i<= no_partidas; i++){
				if($("#cargo_asociado"+i).val() == "Anticipo"){
					anticipoComprobado2+= (estatus_en_edicion_de_comprobacion && id == i) ? 0 : parseFloat($("#totalMxn"+i).val().replace(/,/g,""));
				}
			}
			anticipoComprobado2+=total_monto;
			if( total_monto>anticipo || parseFloat(anticipoComprobado2.toFixed(2))>parseFloat(anticipo.toFixed(2)) ){
				val = false;
			}
			return val;
		}
		
		function valida_suma_cargo(n_transaccion){
			var sumaCargoTotal = 0;
			var id = $("#itinerarioActualOPosible").val();			
			var no_conceptos = parseInt($("#comprobacion_table>tbody>tr").length);			
			var total_monto = parseFloat($("#total_dolares").val().replace(/,/g,""));			
			for(i=1; i<= no_conceptos; i++){
				if(n_transaccion == $("#idAmex"+i).val()){
					sumaCargoTotal+= (estatus_en_edicion_de_comprobacion && i == id) ? 0 : parseFloat($("#totalMxn"+i).val().replace(/,/g,"")) ;			
				}
			}						
			sumaCargoTotal+=total_monto;										
			return parseFloat(sumaCargoTotal.toFixed(2));			
		}
		
		function valida_suma_cargo2(n_transaccion){
			var sumaCargo=0;
			var no_conceptos = parseInt($("#comprobacion_table>tbody >tr").length);
					
			for(i=1; i<= no_conceptos; i++){
				if(n_transaccion == $("#idAmex"+i).val()){
					sumaCargo+= parseFloat($("#totalMxn"+i).val().replace(/,/g,""));				
				}
			}						
			return parseFloat(sumaCargo);			
		}
		
		// Edita un concepto de comprobacion 
		function editarComprobacion(id){
			// Regresa el estatus a 0 para edicion
			var idamex = $("#idAmex"+parseInt(id)).val();
			var detalleComp = $("#idDetalleComp"+parseInt(id)).val();
			
			if(!estatus_en_edicion_de_comprobacion){				
				if(idamex > 0){ // No devolveremos el estatus del cargo a 0. 
					//devolver_status_idamex(idamex);
					id = parseInt(id);
					cCObligatorio = id;
				}
			}
			
			// Bandera que ayudarï¿½ a saber si un cargo esta siedo editdo 
			$("#edicionAux").val(1+"|"+idamex);
			$("#id_cargo_amex_seleccionado").val(idamex);
			
			// Habilitar Campos de Montos  
			$("#monto").removeAttr("disabled");
			$("#moneda").removeAttr("disabled");
			$("#referencia_corta").removeAttr("disabled");
			
			var concepto = $("#concepto"+parseInt(id)).val();
			
			if(concepto == "Alimentos"){
				$("#concepto_alim_hot").val("alimentacion");
			}else if(concepto == "Hotel"){
				$("#concepto_alim_hot").val("hospedaje");
			}else{
				$("#concepto_alim_hot").val(0);
			}
			
			$("#guardarPrev").attr("disabled","true");
			$("#guardarComp").attr("disabled","true");			
	
			if(bandera)	$("#registrar_comp").removeAttr("disabled");
			
			//Se checa si exite un itinerario en edicion
			if(estatus_en_edicion_de_comprobacion){
				alert("Se esta editando una comprobacion, de click antes en Actualizar Itinerario");
				return false;
			}
			
			$("#registrar_comp").attr("value","     Actualizar Gasto");
			var frm=document.detallecomp;			
			id = parseInt(id);
			$(".elimina").css("display","none");//oculta boton eliminar
			$(".del_part").html("N/A");
			//Al editar un itinerario, se guarda el numero de itinerario que se va a editar.
			frm.itinerarioActualOPosible.value = id;
			$("#tipo").val($("#tipoComprobacion"+id).val()); //Anticipo, Amex, Reembolso
			$("#tipo").attr("disabled", "disabled");
			
			if($("#tipoComprobacion"+id).val() == 2){
				tipo_de_comprobacion($("#tipoComprobacion"+id).val());
				$("#select_tipo_tarjeta").val($("#tipoTarjeta"+id).val());
				verificar_tipo_tarjeta();
				$("#select_tarjeta_cargo").val(idamex);
				$('#select_tarjeta_cargo> option[value="'+idamex+'"]').attr('selected', 'selected');
				cargar_detalles();
				
				$("#select_tipo_tarjeta").attr("disabled", "disabled");
				$("#select_tarjeta_cargo").attr("disabled", "disabled");
			}
			ocultaAmex();			
			$("#select_concepto").val($("#numConcepto"+id).val());//concepto

			// Extraer limites de las Politï¿½cas 
			tipoConcepto();
			
			$("#div_propina").hide();
			$("#propina").hide();
			$("#asistentes").hide();
			$("#asistentes2").hide();
			$("#div_tipo_comida_label").hide();
			$("#tipo_comida_label").hide();
			$("#div_impuesto_hospedaje").hide();				
			$("#div_impuesto_hospedaje2").hide();
			if($("#numConcepto"+id).val()!= 24){
				$("#comentarioReq").html('Comentario :');
			}
			if($("#numConcepto"+id).val()== 5){
				$("#propina").css("display", "block");
				$("#div_propina").css("display", "block");
				$("#propina_dato").val($("#propina"+id).val().replace(/,/g,""));
				$("#div_impuesto_hospedaje").css("display", "block");
                $("#div_impuesto_hospedaje2").css("display", "block");
				$("#impuesto_hotel").val($("#impuesto_hospedaje"+id).val().replace(/,/g,""));
			}else if($("#numConcepto"+id).val()== 6){
				$("#asistentes").css("display", "block");
                $("#asistentes2").css("display", "block");
				$("#no_asistentes").val($("#no_asistentes"+id).val());
				$("#propina").css("display", "block");
				$("#div_propina").css("display", "block");
				$("#propina_dato").val($("#propina"+id).val().replace(/,/g,""));
				$("#tipo_comida_label").css("display","block");
				$("#div_tipo_comida_label").css("display","block");
				$("#tipocomidadato").val($("#tipo_comida"+id).val());
			}
			$("#fecha").val($("#fecha"+id).val());//fecha
			$("#monto").val($("#mnt"+id).val().replace(/,/g,""));//monto origen
			$("#total").val($("#tot"+id).val());//total
			$("#moneda").val($("#divisa"+id).val());//tipo de divisa
			if($("#comentario"+id).val() == "Sin Comentarios"){
				$("#referencia_corta").val("");//comentario
			}else{
				$("#referencia_corta").val($("#comentario"+id).val());//comentario
			}
			if($("#check"+id).val()== "on"){
				$('input[name=fact_chk]').attr('checked', true);
				$("#d_folio").val($("#flag_factura"+id).val());
				$("#rfc").val($("#rfc"+id).val());
				$("#proveedor").val($("#proveedor"+id).val());
				$("#impuesto").val($("#pimpuesto"+id).val().replace(/,/g,""));
				$("#div_iva").css("display", "block"); 
				$("#impuesto").css("display", "block"); 
				verificaFactura();	
			}	
			if($("#divisa"+id).val() == "MXN" || $("#rfc"+id).val() != "N/A" ){
				$("#impuesto").val($("#pimpuesto"+id).val().replace(/,/g,""));
				$("#div_iva").css("display", "block"); 
				$("#impuesto").css("display", "block"); 
			}				
			calculaTotalDolares();
			//Se pone el estatus en edicion
			estatus_en_edicion_de_comprobacion = true;
			// obtenemos el id del registro para la edicion de comentarios obligatorios
			if(estatus_en_edicion_de_comprobacion == true){
				//alert("com"+cCObligatorio);
				cCObligatorio = id;
			}
			conceptoNombre=frm.select_concepto.options[frm.select_concepto.selectedIndex].text;
			if(conceptoNombre == "Alimentos"){
				tramiteId = $('#sol_select').val();
				conceptoId = $('#numConcepto'+id).val();
			}		

			// Desactivar las listas Tipo de Tarjeta y Lista de Cargos en el caso 
			// que la Comprobaciï¿½n sea Devuelta con Observaciones por Finanzas 
			if($("#etapaComprobacion").val() == 5){
				$("#select_tipo_tarjeta").attr("disabled", "disabled");
				$("#select_tarjeta_cargo").attr("disabled", "disabled");
			}
		}
		
		function flotanteActive(valor){	
			if(valor == 1){
				var top = ($("#tipo").val() == 2) ? "85%" : "50%" ;					
				$("#proveedor_form").css("top", top);	
				$("#proveedor_form").css("visibility","visible");		
				$("#proveedor_form").css("display","block");												
            }else{
				$("#proveedor_form").css("visibility","hidden");	
				$("#proveedor_form").css("display","none");			    
			}
        }
		function limpiarCamposDeProveedor(){
			$("#new_proveedor").val("");
			$("#new_p_rfc").val("");
			$("#new_p_addr").val("");
		}
		function valida_formatoRFC(campo){
			var resultado = campo.match(/[A-Z]{3,4}[0-9]{6}((([A-Z]|[a-z]|[0-9]){3}))/); 
			return resultado;
		}		
		
		//funcion que permitira distinguir si es un concepto de tipo Alimento (id 6) y/o Hotel (id 5)
		function tipoConcepto(){			
			conceptoNombre = "";			
			//obtenemos el nombre del concepto seleccionado
			var frm=document.detallecomp;			
			conceptoNombre=frm.select_concepto.options[frm.select_concepto.selectedIndex].text;
			tramiteId = document.getElementById("sol_select").value;
			//obtenemos el id del concepto seleccionado
			conceptoId=$("#select_concepto").val();

			//parametros de los 3 conceptos : Comentarios Obligatorios
			if((conceptoNombre == "Alimentos") || ( conceptoNombre == "Hotel") || (conceptoNombre == "Lavander"+arrayAcentos["i"]+"a")){
				validacionParametro(conceptoNombre,tramiteId,conceptoId);
			}
		}
		
		//funcion que nos permite tomar el valor del tramite que se selecciono
		function obtenerTramite(){
				var frm=document.detallecomp;
				tramiteId = document.getElementById("sol_select").value;
				getDiasViaje(tramiteId);
		}

		//Obtenemos el numero de dias correspondientes en el viaje
		function getDiasViaje(tramiteId){
			$.ajax({      
		        type: "POST",
		        url: "services/Ajax_comprobacion.php",
		        data: "tramiteConcepto="+tramiteId,
		        dataType: "json",
		        timeout: 10000,
		        success: function(json){
		        	$("#diasViaje").val(json);		        	
		        },complete: function(json){
		        	getLavanderia(tramiteId);
			    },
				error: function(x, t, m) {
					if(t==="timeout") {
						location.reload();
						abort();
					}
				}
			});
		}
		
		//Function lavanderia combo
		function getLavanderia(tramiteId){
			//concepto de tipo Lavanderï¿½a combo	
			 $.ajax({
					type: "POST",
					url: "services/Ajax_comprobacion.php",
					data: "activarConcepto="+tramiteId,
					dataType: "json",
					timeout: 10000,
					success: function(json){
						if(json != ""){							
							$('#select_concepto').find("option[value='"+json[0].dc_id+"']").remove();
						}
					},
					complete: function(json){
						verificaEstatus();
					},
					error: function(x, t, m) {
						if(t==="timeout") {
							location.reload();
							abort();
						}
					}
				});
		}
				
		//funcion que nos permitira saber el tipo de comida que selecciono
		function tipoComida(valor){
			var frm=document.detallecomp;
			idComida=frm.tipocomidadato.options[valor].text;				
		}		
		       
		//funcion que permitira eliminar duplicaciones para el arreglo de fechas (Alimentos), funcion calculoParametros
		 function removeDuplicateElement(arrayName)
		 {
			   var newArray=new Array();
			   label:for(var i=0; i<arrayName.length;i++ )
			   {  
			   for(var j=0; j<newArray.length;j++ )
			   {
			   if(newArray[j]==arrayName[i]) 
			   continue label;
			   }
			   newArray[newArray.length] = arrayName[i];
			   }
			   return newArray;
		 }
			 
		//Funcion que nos permite:
		//1.-verificar que el concepto (sea solo de tipo alimento) de los registros de partida realizados por el usuario
		//2.-Guardar la fecha y el total del concepto de tipo alimento (Esto sera mediante una concatenacion. "Fecha - total") en el arreglo fechaAlimentos
		//3.-Se ordenara el arreglo fechaAlimentos	
		//4.-Sera guardado el valor de la fecha y el total respectivamente en los siguientes arreglos (fechaAlimentosOrdenados / totalAlimentosOrdenados)
		//5.-Mediante la funcion removeDuplicateElement quitaremos las repeticiones de las fechas de los conceptos de tipo alimento ( con esto se obtendra fechas reales)
		//y guardaremos estos valores en el arreglo fechasDeAlimentos
		//6.-Se empieza a realizar la comparacion de fechas	para calcular el total por fecha
			 	 
        function calculoParametros(){
            //obtenemos el valor del total calculado   
            var totalAlimentosOrdenados = new Array();
            var fechaAlimentosOrdenados = new Array();
            var totalAlimentosFinal = new Array();
            var fechaAlimentosFinal = new Array(); 
            var fechaAlimentos = new Array();
            var fechaAlimentosRegistrados = new Array();                                   
            var fechasDeAlimentos = new Array();           
			var sumaTotalMXN=0;
			var k=0;			
			var indice=0;
			var mensajeExcepcion="";
			var diferenciaAlimento="";
            //var datosAlimento = new Array(fechaAlimentos,totalAlimentos);
           // var totalMXN = new Array();
           //longitud de el arreglo sin repeticiones sera fechasDeAlimentos.length-1 por el cero que posee
           
			//ingreso de datos en arreglos (filtro alimentos) .... 1.
			var no_partidas = parseInt($("#comprobacion_table>tbody >tr").length);
			for(var i=1;i<=no_partidas;i++){				
				if($("#concepto"+i).val() == "Alimentos"){																		
					fechaAlimentos[indice]=$("#fecha"+i).val()+"-"+$("#totalMxn"+i).val();//.... 2.
					indice++;																										
					}				
				}
			
			
			fechaAlimentos.sort();//...... 3.
			//El total de la fechaAlimentos[0] correspode a totalAlimentosOrdenados[0]
			for(var i=0;i<fechaAlimentos.length;i++){//..... 4.					
				totalAlimentosOrdenados[i]=fechaAlimentos[i].substring(11);
				fechaAlimentosOrdenados[i]=fechaAlimentos[i].substring(0,10);
			}
			//ordenar los arreglos de la fecha obtenida y sin repeticiones
			fechasDeAlimentos=removeDuplicateElement(fechaAlimentosOrdenados);//..... 5.
						 
			//Calculo de total por fecha...... 6.			
			var j=0;
			var k=0;
			for(var j=0;j<fechaAlimentosOrdenados.length;j++){															
				if( fechaAlimentosOrdenados[j] == fechasDeAlimentos[k]){					
					sumaTotalMXN=sumaTotalMXN+parseFloat(totalAlimentosOrdenados[j]);					
					fechaAlimentosFinal[k]=fechasDeAlimentos[k];
					totalAlimentosFinal[k]=sumaTotalMXN;					
				}else{
					sumaTotalMXN=0;
					j--;					
					k++;					
				}				
				//valor j = 0 / k=0				
			}			
			//Validacion de monto diario del concepto de Alimentos											
			$.ajax({
				//obtenemos el valor maximo original y la divisa
                type: "POST",
                url: "services/Ajax_comprobacion.php",
                data: "conceptoId="+conceptoId+"&tramiteId="+tramiteId,
                dataType: "json",
                success: function(json){
                	parametroDiarioAlimento=json[0].pr_cantidad;
                	divisaAlimento=json[0].div_id;	
                    var nombreDivisa="";
                    var montoPermitido = json[0].pr_cantidad;
                    var divisa = json[0].div_id;
                    //alert(json[0].pr_cantidad);
                    //alert(json[0].div_id);
                    $.ajax({
                        //obtenemos el valor maximo en pesos
                        type: "POST",
                        url: "services/Ajax_comprobacion.php",
                        data: "tasaDivisa="+json[0].div_id+"&cantidadParam="+json[0].pr_cantidad,
                        dataType: "json",
                        timeout: 10000,
                        success: function(json){                           
                            for(var i=0;i<fechaAlimentosFinal.length;i++){
                				//alert("La fecha de alimento es de"+fechaAlimentosFinal[i]+"y su total es de"+totalAlimentosFinal[i]);
                				//alert("parametro"+json);
                				if(divisa == 1){
                					nombreDivisa="MXN";
                				}else if(divisa == 2){
                					nombreDivisa="USD";
                				}else if(divisa == 3){
                					nombreDivisa="EUR";
                				}
                				if(totalAlimentosFinal[i]>json){
                					var difAlimento=parseFloat(totalAlimentosFinal[i]) - parseFloat(json);                    				
                    				mensajeExcepcion="La partida en la fecha"+" "+fechaAlimentosFinal[i]+" "+"esta excediendo el monto diario de acuerdo a la pol\u00EDtica para el concepto de Alimentos que es de"+" "+montoPermitido+" "+nombreDivisa+".";										
                    				ingresaExcepcionTemporalAlimentos(mensajeExcepcion,difAlimento,fechaAlimentosFinal[i]);
                    				if(fechaAlimentosFinal[i] == fechaSeleccionada){
                    					alert("La partida en la fecha"+" "+fechaAlimentosFinal[i]+" "+"esta excediendo el monto diario de acuerdo a la pol\u00EDtica para el concepto de Alimentos que es de"+" "+montoPermitido+" "+nombreDivisa+".");
                    				}                    				
                				}else{
                					ingresaExcepcionTemporalAlimentos("",0,fechaAlimentosFinal[i]);
                				}
                			}
                        },
                        error: function(x, t, m) {
    						if(t==="timeout") {
    							location.reload();
    							abort();
    						}
    					}
                    });                		                              
                }
            });
			                          
        }		
		 
		//funcion que asignara las excepciones de alimentos de forma temporal
		function ingresaExcepcionTemporalAlimentos(mensaje,difAlimentos,fecha){	
			var no_partidas = parseInt($("#comprobacion_table>tbody >tr").length);
			for(i=1;i<=no_partidas;i++){
				if($('#concepto'+i).val() == "Alimentos"){
					if($('#fecha'+i).val() == fecha){
						$('#exConcepto'+i).val(mensaje);
						$('#difConcepto'+i).val(difAlimentos);
					}
				}				
			}					
		}
	
		
		//funcion que nos permite decir si se ha rebasado el monto calculado
		function montoPoliticas(montoMax,totalCalculado){				
			//se valida que no se este rebasando el monto calculado dependiendo de la politica		
			if(totalCalculado > montoMax){					
					mensaje="Esta rebasando la Pol\u00EDtica de este concepto que es de "+" "+ montoMax;
					mensajeBD="Esta rebasando la Politica de este concepto que es de"+" "+ montoMax;
					alert(mensaje);
					//se calcula la diferencia
					calculoDiferencia=totalCalculado-montoMax;					
					//se pasara el mensaje y la diferencia para guardarla en la excepcion
					$.ajax({
		                    type: "POST",
		                    url: "services/Ajax_comprobacion.php",
		                    data: "mensaje="+mensajeBD+"&calculoDiferencia="+calculoDiferencia,
		                    dataType: "json",
		                    success: function(json){
			                },			                
	                        error: function(x, t, m) {
	    						if(t==="timeout") {
	    							location.reload();
	    							abort();
	    						}
	    					}					
		           });										
			}				
		}
			
	function recalcula(){
		var no_partidas = parseInt($("#comprobacion_table>tbody >tr").length);
		var anticipo_solicitado = parseFloat($("#anticipo_solicitado2").val().replace(/,/g,""));
		var anticipo_comprobado = 0;
		var personal_anticipo = 0;
		var personal_amex = 0;
		var personal_amex_externo = 0;
		var comprobado_amex = 0;
		var personal_efectivo = 0;		
		var efectivo_comprobado = 0;		
		var amex_externo = 0;		
		
		for(var i = 1; i <= no_partidas; i++){  
			// suma el personal y el total por anticipo
			//
			if ($("#cargo_asociado"+i).val() == "Anticipo"){
				anticipo_comprobado+= parseFloat($("#totalMxn"+i).val().replace(/,/g,""));				  
				if($("#concepto"+i).val() == "Personal"){
					personal_anticipo+= parseFloat($("#totalMxn"+i).val().replace(/,/g,""));					
				}				
			}			
			// suma el personal y el total por amex
			if($("#cargo_asociado"+i).val() == "AMEX"  || $("#cargo_asociado"+i).val() == "Amex"){
				comprobado_amex+=parseFloat($("#totalMxn"+i).val().replace(/,/g,""));    
				if($("#concepto"+i).val() == "Personal"){
					personal_amex+=parseFloat($("#totalMxn"+i).val().replace(/,/g,""));    
				}
			}			
			// suma el personal y el total por efectivo Reembolo para empleado
			if($("#cargo_asociado"+i).val() == "Reembolso" || $("#cargo_asociado"+i).val() == "Reembolso"){
				efectivo_comprobado+=parseFloat($("#totalMxn"+i).val().replace(/,/g,""));				
			}
			// suma el personal y el total por efectivo Reembolo para empleado
			if($("#cargo_asociado"+i).val() == "Amex externo"){
				amex_externo+=parseFloat($("#totalMxn"+i).val().replace(/,/g,""));
				if($("#concepto"+i).val() == "Personal"){
					personal_amex_externo += parseFloat($("#totalMxn"+i).val().replace(/,/g,""));
				}    			
			}			
		}  				

		
		$("#anticipo_comprobado_autorizado_BMW2").val(anticipo_comprobado);
		$("#anticipo_comprobado_autorizado_BMW1").html(number_format(anticipo_comprobado,2,".",",") + " MXN");
		
		$("#personal_descontar2").val(anticipo_solicitado - anticipo_comprobado + (personal_anticipo + personal_amex + personal_amex_externo));		
		$("#personal_descontar1").html(number_format(anticipo_solicitado - anticipo_comprobado + (personal_anticipo + personal_amex + personal_amex_externo),2,".",",")+ " MXN");
		
		$("#amex_comprobado_autorizado_BMW2").val(comprobado_amex);
		$("#amex_comprobado_autorizado_BMW1").html(number_format(comprobado_amex,2,".",",") + " MXN");
		
		$("#efectivo_comprobado_autorizado_BMW2").val(efectivo_comprobado);
		$("#efectivo_comprobado_autorizado_BMW1").html(number_format(efectivo_comprobado,2,".",",") + " MXN");
		
		$("#monto_a_descontar2").val(anticipo_solicitado - anticipo_comprobado + (personal_anticipo + personal_amex + personal_amex_externo));
		$("#monto_a_descontar1").html(number_format(anticipo_solicitado - anticipo_comprobado + (personal_anticipo + personal_amex + personal_amex_externo),2,".",",") + " MXN");
		
		$("#monto_a_reembolsar2").val(efectivo_comprobado);
		$("#monto_a_reembolsar1").html(number_format(efectivo_comprobado,2,".",",") + " MXN");
		
		$("#amex_externo2").val(amex_externo);
		$("#amex_externo1").html(number_format(amex_externo,2,".",",") + " MXN");		
		/*
		ALTER TABLE `expbmwdv1`.`comprobaciones` ADD COLUMN `co_amex_externo` DECIMAL(20,2) NOT NULL DEFAULT 0  AFTER `co_efectivo_comprobado` ;
		*/
	}
	
	// Elimina un itinerario
	function borrarRenglonComprobacion(id,tabla,rowCount,rowDel,count,edit,del,rowActualOPosible){
			
		$("#"+rowCount).bind("restar",function(e,data,data1){
			e.stopImmediatePropagation();
			$("#"+rowCount).val(parseInt($("#"+tabla+">tbody>tr").length));
			if(rowActualOPosible != ""){
				$("#"+rowActualOPosible).val(parseInt($("#"+tabla+">tbody>tr").length)+parseInt(1));
			}
		});
		
		$("#"+rowDel).bind("cambiar",function(e,inicio,tope){
			e.stopImmediatePropagation();			
			tab = document.getElementById(tabla);			
			for (var i=parseInt(id);i<=parseFloat(tope);i++){		
				fila_act = tab.getElementsByTagName('tr')[i];		
				for (j=0;celda_act = fila_act.getElementsByTagName('input')[j]; j++){
					if(celda_act.getAttribute('type') == 'hidden'){
						var aux = celda_act.getAttribute('id');
						var re = /[0-9]*$/;
						aux = aux.replace(re, "");
												
						var elemento_sig = "#"+aux+((parseInt(i)+(1)));
						var elemento_act =  ""+aux+parseInt(i);
						$(elemento_sig).attr("name",elemento_act);
						$(elemento_sig).attr("id",elemento_act);						
					}
				}
				
				//Recorre el div contador de registro
				if(count != ""){
					count_sig = "#"+count+((parseInt(i)+(1)));
					count_act = ""+count+parseInt(i);
						$(count_sig).html(parseInt(i));
						$(count_sig).attr("name",count_act);
						$(count_sig).attr("id",count_act);
				}
				//Recorre la imagen de editar registro
				if(edit != ""){
					edit_sig = "#"+(parseInt(i)+(1))+edit;
					edit_act = ""+parseInt(i)+edit;
						$(edit_sig).attr("name",edit_act);
						$(edit_sig).attr("id",edit_act);
				}
				//Recorre la imagen de eliminar registro
				if(del != ""){
					del_sig = "#"+(parseInt(i)+(1))+del;
					del_act = ""+parseInt(i)+del;
						$(del_sig).attr("name",del_act);
						$(del_sig).attr("id",del_act);
				}
				$("#row"+i).val(i);	
			}						
		});
		
		$("img.elimina").click(function(){
						
			$(this).parent().parent().parent().fadeOut(0, function () {
				var i=0;
				$(this).remove();
				$("#"+rowCount).trigger("restar");
				$("#"+rowCount).unbind("restar");
				var tope=$("#"+rowCount).val();
				i=parseFloat(id);
				$("#"+rowDel).trigger("cambiar",[i,tope]);
				$("#"+rowDel).unbind("cambiar");								
			});
			recalculaConceptoDetalle(conceptoAEliminar);								
			recalcula();
			return false;
		});	 	
		
		//regresa el estatus a 0 para edicion
		var idamex = $("#idAmex"+parseInt(id)).val();
		var detalleComp = $("#idDetalleComp"+parseInt(id)).val();
		if (idamex > 0){
			devolver_status_idamex(idamex);
		}		
			
		var no_partida = parseInt($("#comprobacion_table>tbody>tr").length);
		if (no_partida == 1){
			$("#guardarPrev").attr("disabled","true");
			$("#guardarComp").attr("disabled","true");	
			$("#sol_select").removeAttr("disabled");
		}					
	}
	
	function validaZeroIzquierda(monto,campo){			
		if( monto.substring(monto.length-1,monto.length) === "." || monto.substring(monto.length-2,monto.length) === ".0" ){
			$("#"+campo).val(monto);
		}else if(monto == 0 || monto == "" || monto == "NaN"){
			$("#"+campo).val(0);
		}else{
			$("#"+campo).val(parseFloat(monto));
		}
	}
</script>
      
        <link rel="stylesheet" type="text/css" href="../../css/jquery.autocomplete.css"/>
        <link rel="stylesheet" type="text/css" href="../../css/date_input.css"/>
        <link rel="stylesheet" type="text/css" href="../../css/table_style.css"/>
        <style type="text/css">
            .style1 {color: #FF0000}
            .fader{opacity:0;display:none;}
            .trans{
                background-color:#D7D7D7;
                color:#0000FF;
                position:absolute;
                vertical-align:middle;	
                width:690px;
                height:200px;	     
                padding:65px;
                font-size:15px;
                font-weight:bold;
                top:26%;
                left:18%;

            }
            .boton{	
                background:#666666;
                color:#FFFFFF;
                border-color:#CCCCCC;
            }
        </style>
        <div>

        </div>
        <div id="Layer1">
            <form action="comprobacion_travel.php?guardarComp" method="post" name="detallecomp" id="detallecomp">
                <table width="785" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td width="170">&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>

                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
        <?PHP 
        $cnn = new conexion();
        
        $idusuario = (isset($_SESSION["iddelegado"])) ? verificaSesion($_SESSION["idusuario"], $_SESSION["iddelegado"]) : $_SESSION["idusuario"];
        
        //$idusuario = $_SESSION["idusuario"];
		$query = "SELECT v.sv_id, v.sv_motivo, v.sv_observaciones, v.sv_tramite, v.sv_fecha_registro, t.t_iniciador, t.t_etiqueta, co_id,
				(SELECT co_gasolina FROM comprobaciones WHERE co_mi_tramite = co_tramite LIMIT 1) AS co_gasolina, t_comprobado, t_etapa_actual,
				(select svi_tipo_transporte from sv_itinerario where svi_solicitud = v.sv_id order by svi_tipo_transporte limit 1 )
				FROM solicitud_viaje AS v 
				JOIN tramites AS t ON (v.sv_tramite=t.t_id) 
				LEFT JOIN comprobaciones ON co_tramite = sv_tramite
				WHERE t_comprobado = 0
				AND t.t_iniciador= $idusuario"; 
		
		//Muestra las comprobaciones dependiendo si es edicion o una nueva
		if(isset($_GET['edit'])){
			$query .= " AND co_mi_tramite = ".$_GET['edit'];
			$selected = "selected";			
		}else{
			$query .= " AND(
							(
								(SELECT IF(svi_tipo_transporte = 'Aereo',t_etapa_actual,0)
								FROM sv_itinerario
								WHERE svi_solicitud = v.sv_id 			
								order by svi_tipo_transporte 
								LIMIT 1) = 9
							)
							OR
							(
								(SELECT IF(svi_tipo_transporte !='Aereo',t_etapa_actual,0)
								FROM sv_itinerario
								WHERE svi_solicitud = sv_id 			
								order by svi_tipo_transporte 
								LIMIT 1) = 7
							)
						) 
						AND co_id is NULL";
			$selected = "";			
		}
		$query= utf8_decode($query);
		//error_log("query interesante".$query);		
	//	echo $query;		
		$rst = $cnn->consultar($query);
        $fila = mysql_num_rows($rst);
		
		$motivoGas = '';
		$fecha_Inicial = date('d/m/Y');
		$fecha_final = date('d/m/Y');
		$sinSolicitud = "N/A";		
		
		if (isset($_GET['edit']) && (!$fila)){
			$query2 = "SELECT co_id, co_motivo_gasolina, DATE_FORMAT(co_fecha_inicial_gasolina, '%d/%m/%Y') as co_fecha_inicial_gasolina, DATE_FORMAT(co_fecha_final_gasolina, '%d/%m/%Y') as co_fecha_final_gasolina
						FROM comprobaciones
						JOIN tramites on t_id = co_mi_tramite 
						WHERE co_gasolina = 1
						AND t_comprobado = 0
						AND co_mi_tramite = ".$_GET['edit']."
						AND t_iniciador= ".$idusuario;	
			$res = $cnn->consultar($query2);			
			while($row = mysql_fetch_array($res)){
				$motivoGas = $row['co_motivo_gasolina'];
				$fecha_Inicial = $row['co_fecha_inicial_gasolina'];
				$fecha_final = $row['co_fecha_final_gasolina'];
				$sinSolicitud = $row['co_id'];
			}
		}	
	
		?>				 
						<td>
						<table><tr><td><div name="motivoGas" id="motivoGas" style="display:none;">Motivo<span class="style1">*</span>: <input name="motivo" id="motivo" disabled size="25" value="<?PHP echo $motivoGas;?>"/></div></td><tr></table>
						Solicitud<span class="style1">*</span>:
                            <select name="sol_select" id="sol_select" onchange="cambiaMotivo();seleccionar_centro_de_costos(this.value);/*getSaldoAnticipo();*/obtenerTramite();modifica_conceptos();" >
                                <option id="-1" value="-1">Seleccione...</option>
								<?PHP 
								if(!isset($_GET['edit'])){
									echo '<option id="0" value="0">N/A - Sin Solictud</option>';
								}elseif($fila == 0){
									echo '<option id="0" selected value="0">'.$sinSolicitud.' - Sin Solictud</option>';
								}
								if ($fila > 0){
									while ($fila = mysql_fetch_assoc($rst)){
										echo "<option id=" . $fila["sv_id"] . " ".$selected." value=" . $fila["sv_tramite"] . ">" . $fila["sv_tramite"] . " - " . $fila["t_etiqueta"] . "</option>";
									}
								}elseif(!isset($_GET['edit'])){
									echo "<option id='-1' value='-1'>No hay Solicitudes Pendientes</option>";
								}
								?>
                            </select> 
                        </td>
						<td colspan="6">
							<div name="fechaGas" id="fechaGas" style="display:none;">
								Fecha Inicial<span class="style1">*</span>: <input name="fecha_inicial" id="fecha_inicial" size="9" disabled value="<?PHP echo $fecha_Inicial; ?>"  onfocus="return checafecha(document.detallecomp.fecha_inicial.value, 60);" /><img src="../../images/b_calendar.png" alt="Calendario" name="fechaIMG" width="16" height="16" id="fechaIMG" /><br/>
								Fecha Final<span class="style1">*</span>: <input name="fecha_final" id="fecha_final" size="9" disabled value="<?PHP echo $fecha_final; ?>"  onfocus="return checafecha(document.detallecomp.fecha_final.value, 60);" /><img src="../../images/b_calendar.png" alt="Calendario" name="fechaIMG" width="16" height="16" id="fechaIMG" />
							</div>
						</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td  colspan="9">Seleccione el tipo de comprobaci&oacute;n que desea realizar<span class="style1">*</span>:
                            &nbsp;
                            <select name="tipo" id="tipo" onchange="/*getTipoComp();*/tipo_de_comprobacion(value);modifica_conceptos();" disabled=true>
                                <option value="-1" id="-1">Seleccione ...</option>
							<?PHP if ($_SESSION["perfil"]!=3){ ?>             
								<option value="1" id="1">Anticipo</option>     
								<option value="2" id="2">Amex</option>
							    <option value="3" id="3">Reembolso</option>                               
							<?PHP }else{ ?>                              
							   <option value="3" id="3">Reembolso</option>
							   <option value="4" id="4">Amex externo</option>                               
							<?PHP }?>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>

                        <td  colspan="9">Centro de Costos al que se cargar&aacute;<span class="style1">*</span>:
                            &nbsp;
                            <select name="ccentro_costos" id="ccentro_costos" onchange="getCentroCostos();" disabled=true>
                                <option id="-1" value="-1">Seleccione...</option>
        <?PHP 
		$idempleado = (isset($_SESSION["iddelegado"])) ? verificaSesion($_SESSION["idusuario"], $_SESSION["iddelegado"]) : $_SESSION["idusuario"];         
        //error_log("Empleado retornado: ". $idempleado);
        $usuarioActivo = new Usuario();
        $usuarioActivo->Load_Usuario_By_ID($idempleado);
        $id_empresa	= $usuarioActivo->Get_dato("u_empresa");
        
        $query1 = sprintf("SELECT cc_id,cc_centrocostos,cc_nombre FROM cat_cecos WHERE cc_estatus = '1' AND cc_empresa_id = '".$id_empresa."' order by cc_centrocostos");
        $var1 = mysql_query($query1);
        $query2 = sprintf("SELECT co_cc_clave FROM comprobaciones WHERE co_mi_tramite = %s", $_GET['edit']);
        $var2 = mysql_query($query2);

        $fila_idcentro_costos = mysql_fetch_assoc($var2);
        $idcentrocosto = $fila_idcentro_costos['co_cc_clave'];
        //error_log("CECO".$idcentrocosto);
        while ($arr1 = mysql_fetch_assoc($var1)) {
            if ($arr1['cc_id'] == $idcentrocosto) {
                echo sprintf("<option id=%s value='%s' selected='selected'>%s - %s</option>", $arr1['cc_id'], $arr1['cc_id'], $arr1['cc_centrocostos'], $arr1['cc_nombre']);
            } else {
                echo sprintf("<option id=%s value='%s'>%s - %s</option>", $arr1['cc_id'], $arr1['cc_id'], $arr1['cc_centrocostos'], $arr1['cc_nombre']);
            }
        }
        ?>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td width="4">&nbsp;</td>
                        <td width="85">&nbsp;</td>
                        <td>&nbsp;</td>
                        <td width="7">&nbsp;</td>
                        <td width="5">&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td width="66">&nbsp;</td>


                    </tr></table><br />
				<!--Seccion Amex-->
                <div id="amex_form" align="right" style="display:none;">
                    <table width="785" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
                        <tr>
							<td>&nbsp;</td>
                            <td colspan="5"><h3 align="center">Amex</h3></td>
							<td>&nbsp;</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>Tipo de tarjeta<span class="style1">*</span>: <select name="select_tipo_tarjeta" id="select_tipo_tarjeta" onchange="verificar_tipo_tarjeta();">
                                    <option id="-1" value="-1">Seleccione...</option>
                                    <option id="1" value="1">Amex corporativa Gastos</option>
									<option id="2" value="2">Amex corporativa Gasol&iacute;na</option>
								</select>
                            </td>
                            <td colspan="4" align="left" colspan="3">Tarjeta de Cr&eacute;dito:&nbsp;
							<div name="no_tarjeta_credito" id="no_tarjeta_credito" style="width:70%"></div>
							</td>
							<td>&nbsp;</td>
						</tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td colspan="5">
                                Lista de Cargos<span class="style1">*</span>: <select name="select_tarjeta_cargo" id="select_tarjeta_cargo" onchange="cargar_detalles();">
                                </select>
                            </td>
							<td>&nbsp;</td>
                        </tr>
						<tr>
                            <td>&nbsp;</td>
                            <td>
                                No. Transacci&oacute;n:<div name="no_transaccion" id="no_transaccion" style="width:70%"></div>
							</td>
							<td colspan="4">&nbsp;</td>
							<td>&nbsp;</td>
                        </tr>
                        <tr>
							<td>&nbsp;</td>
                            <td colspan="5"><h3 align="center">Detalle del cargo</h3></td>
							<td>&nbsp;</td>
                        </tr>
                        <tr><td>&nbsp;</td>
							<td width="5%">Establecimiento:<div id="establecimiento_cargo" name="establecimiento_cargo" align="left"></div>
							</td>
							<td colspan="4" width="40%">Total origen factura: <input type="hidden" id="monto_cargo_val" name="monto_cargo_val" value="0" readonly="readonly" />
								<div id="monto_cargo" name="monto_cargo" align="left"></div>
								<input type="hidden" id="moneda_fact_val" name="moneda_fact_val" readonly="readonly" />
							</td>
							<td>&nbsp;</td>
							<input type="hidden" id="establecimiento_cargo_val" name="establecimiento_cargo_val" value="0" readonly="readonly"/>
                        </tr>
                        <tr><td>&nbsp;</td>
                            <td width="50%">Fecha: <input type="hidden" id="fecha_cargo_val" name="fecha_cargo_val" value="0" readonly="readonly"/><div id="fecha_cargo" name="fecha_cargo"></div>
							</td>
							<td colspan="4" width="50%">Total Amex: <input type="hidden" id="amex_dolar_val" name="amex_dolar_val" value="0" readonly="readonly" /><div id="amex_dolar" name="amex_dolar" align="left"></div>
							</td>
                            <td>&nbsp;</td>
                        </tr>
                        <tr><td>&nbsp;</td>
                            <td width="50%">RFC: <input type="hidden" id="rfc_cargo_val" name="rfc_cargo_val" value="0" readonly="readonly"/><div id="rfc_cargo" name="rfc_cargo" align="left"></div>
							</td>
							<td colspan="4" width="50%">Total MXN: <input type="hidden" id="amex_pesos_val" name="amex_pesos_val" value="0.00" readonly="readonly" /><div id="amex_pesos" name="amex_pesos" align="left"></div>
							</td>
							<td>&nbsp;</td>
                        </tr>
						<tr><td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td colspan="4" width="50%">Tipo de cambio: <input type="hidden" id="tipo_cambio" name="tipo_cambio" value="0.00" readonly="readonly" /><div id="div_tipo_cambio" name="div_tipo_cambio" align="left"></div></td>
							<td>&nbsp;</td>
                        </tr>                       
						<tr>
							<td>&nbsp;</td>
							<td colspan="5">&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
                    </table>     
                </div>              
                
                <table width="785" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;"><tr><td colspan="2">
                    <tr>
                        <td>&nbsp;</td>
                        <td colspan="11"><h3 align="center">Registro de Partidas</h3></td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
							<div align="left">
								Concepto<span class="style1">*</span>: <br />
                            </div>
						</td>
                        <td colspan="3"><div align="left">
                                <select name="select_concepto" id="select_concepto" disabled="true" onchange="borraPropina();validaPoliticasComentario();validaImpuestoHotelRequerido();verificar_concepto(this.value);tipoConcepto();">
								<option id="-1" value="-1">Seleccione...</option>
								<option id="00" value="-1">Sin solicitud</option>
        						<?PHP 
									$tipoDivisa = "MXN"; // TODO: Debe de venir del combo 
									$cnn = new conexion();
									$query = sprintf("SELECT c.cp_id AS cp_id, cp_concepto, cp_cuenta FROM cat_conceptos AS c 
											INNER JOIN conceptos_flujos AS cf ON (c.cp_id = cf.cp_id) 
											WHERE cf.f_id = %s AND cp_activo = 1 ORDER BY cp_concepto", FLUJO_COMPROBACION);
									//error_log("--->>Consulta Conceptos según el flujo: ".$query);
									$rst = $cnn->consultar($query);
									while ($fila = mysql_fetch_assoc($rst)) {
											echo "<option id=" . $fila["cp_id"] . " value=" . $fila["cp_id"] . ">" . $fila["cp_concepto"] . "</option>";
									}
								
									$idusuario = $_SESSION["idusuario"]; ?>        
                                </select>
								<input type="hidden" name="concepto_seleccionado" id="concepto_seleccionado" value="">
                                <input type="hidden" name="c_nam_cb" id="c_nam_cb" readonly="readonly" value="" />
                            </div>
						</td>
                        <td>&nbsp;</td>
                        
                        <td colspan="2"><div align="left">Fecha Comprobante<span class="style1">*</span>: </div></td>
                        <td colspan="4"><div align="left">
                                <input name="fecha" id="fecha" disabled="false" value="<?PHP echo date('d/m/Y'); ?>" size="15" onfocus="return checafecha(document.detallecomp.fecha.value, 60);" onChange="fechaAlimentos();" />
                                <img src="../../images/b_calendar.png" alt="Calendario" name="fechaIMG" width="16" height="16" id="fechaIMG" /></div></td>
                        <td>&nbsp;</td>
                    </tr>
					<tr>
                        <td></td>
                        <td>
							<div name="div_tipo_comida_label" id="div_tipo_comida_label"  align="left" style="display:none">
								Tipo<span class="style1">*</span>:
							</div>
						</td>
						<td width="13%">
                            <div name="tipo_comida_label" id="tipo_comida_label"  align="left" style="display:none"> 
                                <select name="tipocomidadato" id="tipocomidadato" onchange="tipoComida(this.value);"/>
                                <option id="0" value="0">Seleccione...</option>
                                <option id="1" value="1">Desayuno</option>
                                <option id="2" value="2">Comida</option>
                                <option id="3" value="3">Cena</option>
                                </select>
                            </div>
						</td>
                        <td width="10%"></td>
                        <td width="10%"></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
					<tr>
                        <td>&nbsp;</td>
                        <td><div align="left">Proveedor Nacional:</div></td>
                        <td colspan="1"><input type="checkbox" name="fact_chk" id="fact_chk" disabled="true" onclick="muestraIva2();validaImpuestoHotelRequerido();verificaFactura();" />
                        </td>
                        <td colspan="3"><a href="http://www.oanda.com/lang/es/currency/converter/" target="_black">Realiza la conversi&oacute;n a tu divisa</a></td>
                        <td colspan="6" rowspan="7" valign="top">
							<div id="factura_form" name="factura_form" style="display:none;">
								<table width="250" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
									<tr>
										<td>&nbsp;</td>
										<td colspan="4" ><h3 align="center">Datos de proveedor</h3></td>
										<td>&nbsp;</td>
									</tr>
									<tr>
										<td>&nbsp;</td>
										<td>
											<div align="left" id="div_folio">Folio Factura<span class="style1">*</span>:
											</div>
										</td>
										<td colspan="3">
											<div align="left">
												<input name="d_folio" id="d_folio" size="8" onkeypress="return validaNum(event)" />
											</div>
										</td>
										<td>&nbsp;</td>
									</tr>
									<tr>
										<td>&nbsp;</td>
										<td>
											<div id="rfc_prov_busq_div" align="left">RFC<span class="style1">*</span>: 
											</div>
										</td>
										<td colspan="3">
											<div align="left">
												<input name="rfc" type="text" id="rfc" value="" size="24" maxlength="13"  onkeyup="this.value = this.value.toUpperCase();" onchange='/*if ( ! this.value.match(/[A-Z]{3,4}[0-9]{6}((([A-Z]|[a-z]|[0-9]){3}))/) ) { this.value = ""; alert("El RFC que intenta ingresar es incorrecto. Favor de verificarlo e intente nuevamente");} */'/>
											</div>
										</td>
										<td>&nbsp;</td>
									</tr>	
									<tr>
										<td>&nbsp;</td>
										<td >
											<div id="name_prov_busq_div" align="left">Raz&oacute;n Social<span class="style1">*</span>: 
											</div>
										</td>
										<td colspan="3">
											<div align="left">
												<input name="proveedor" type="text" id="proveedor" value="" size="24" disabled />
											</div>
										</td>
										<td>&nbsp;</td>
									</tr>
									<tr>
										<td>&nbsp;</td>
										<td colspan="4"></td>
										<td>&nbsp;</td>
									</tr>
									<tr>
										<td>&nbsp;</td>
										<td colspan="4">
											<div align="center">
												<input type="button" name="agregar" id="agregar" value="    Agregar Nuevo Proveedor" onclick="flotanteActive(1);" style="background:url(../../images/add.png); background-position:left; background-repeat:no-repeat; background-color:#E1E4EC;" />
											</div>
										</td>
										<td>&nbsp;</td>
									</tr>
								</table>
							</div>
							&nbsp;
						</td>
                        <td>&nbsp;</td>
					</tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
							<div align="left">Subtotal/Monto<span class="style1">*</span>:
							</div>
						</td>
                        <td>
							<div align="left">
                                <input name="monto" id="monto" value="0" disabled="true" onkeyup="validaZeroIzquierda(this.value,this.id);" onkeypress="return validaNum(event); validaZeroIzquierda(this.value,this.id);" onblur="calculaTotalDolares();" size="10" autocomplete="off"/>
                            </div>
						</td>                       
                        <td>
							<div align="left">Divisa<span class="style1">*</span>: 
							</div>
						</td>
                        <td>
							<div align="left">
                                <select name="moneda" id="moneda" disabled="true" onchange="muestraIva(); calculaTotalDolares();" >
									<option value="-1">Seleccione...</option>
									<?PHP 
									$tipoCambio = array("MXN", "USD", "EUR");
									for ($i = 0; $i < count($tipoCambio); $i++) {
										echo "<option value=" . $tipoCambio[$i] . ">" . $tipoCambio[$i] . "</option>";
									}
									?>
                                </select>
                            </div></td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
							<div align="left">Total<span class="style1">*</span>: 
							</div>
						</td>
                        <td>
							<div align="left">
                                <input name="total"  id="total" value="0" size="10" disabled onkeypress="return validaNum(event)" autocomplete="off" />
                            </div>
						</td>
                        <td>
							<div  name="div_iva" id="div_iva" style="display:none;" align="left">IVA<span class="style1">*</span>: $
							</div>
						</td>
                        <td>
							<div align="left">
								<input name="impuesto" id="impuesto" style="display:none;" value="0" size="8" onkeypress="return validaNum(event); validaZeroIzquierda(this.value,this.id);" autocomplete="off" onkeyup="reiniciaComentarioObligatorio(); validaZeroIzquierda(this.value,this.id);" onblur="calculaTotalDolares();" />
                            </div>
						</td>
                        <td>&nbsp;</td>                        
                        <td>&nbsp;</td>
                    </tr>                   
					<tr>
                        <td>&nbsp;</td>
						<td>
							<div name="div_total_dolares" id="div_total_dolares" style="" align="left" >Total en pesos:
							</div>
						</td>
                        <td colspan="3">
                            <div name="div_dolares" id="div_dolares" style="" align="left" >
                                <input name="total_dolares" value="0" id="total_dolares" disabled size="8" autocomplete="off"/>
                            </div>
						</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td>
							<div align="left"><div name="comentarioReq" id="comentarioReq">Comentario:</div> 
							<input type="hidden" name="excedeMontoComentarios" id="excedeMontoComentarios" value ="0" readonly="readonly" value="" />
							</div>
						</td>
                        <td colspan="3">
							<div align="left">
                                <textarea name="referencia_corta" id="referencia_corta" disabled="true" cols="50" rows="3" maxlength="36" /></textarea>
                            </div>
						</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>
					<tr>
                        <td></td>
                        <td>
							<div name="asistentes" id="asistentes" align="left" style="display:none">
								No.Asistentes:&nbsp;
                            </div>
						</td>
                        <td>
							<div name="asistentes2" id="asistentes2" align="left" style="display:none">
								<input name="no_asistentes" id="no_asistentes" value="1" size="10" onkeyup="validaZeroIzquierda(this.value,this.id); validaPoliticasComentario();" onkeypress="return validaNum(event);validaZeroIzquierda(this.value,this.id);" />
                            </div>
						</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
                    </tr>
					<tr>
                        <td></td>
                        <td>
							<div name="propina" id="propina" align="left" value="0" style="display:none"">Propina<span class="style1"></span>: 
							</div>
						</td>
                        <td>
							<div name="div_propina" id="div_propina" align="left" style="display:none">
								<input name="propina_dato" value="0" id="propina_dato" size="10" onkeyup="calculaTotalDolares(); validaZeroIzquierda(this.value,this.id);" onkeypress="return validaNum(event); validaZeroIzquierda(this.value,this.id);"  />
							</div>
						</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
                    </tr>
					<tr>
                        <td></td>
                        <td>
							<div name="div_impuesto_hospedaje" id="div_impuesto_hospedaje" value="0" align="left" style="display:none">
							Impuesto hospedaje: 
							</div>
						</td>
                        <td>
							<div name="div_impuesto_hospedaje2" id="div_impuesto_hospedaje2" align="left" style="display:none">
								<input name="s" value="0" id="impuesto_hotel" size="10" onkeyup="calculaTotalDolares();validaZeroIzquierda(this.value,this.id);" onkeypress="return validaNum(event);validaZeroIzquierda(this.value,this.id);"/>
							</div>
						</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
                    </tr>
                    <tr>
						<td>&nbsp;</td>
                        <td colspan="4">&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td colspan="11">&nbsp;</td>
						<td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td colspan="11"><div align="center" class="style1" id="load_div" ></div></td>
                        <td>&nbsp;</td>
                    </tr>
                </table>
                <br/>
				
				<div id="ventanaGasolina" style="visibility:hidden; position:absolute; top:115%; left:35%; rigth:35%; width:450px; margin-left:0%; margin-right:0%; margin-top:0%; border:1px solid #808080; padding:5px; background-color:#FAFAFA" >
				<table  style="font-size:11px; bordercolor:#333333" border="0" width="445px">
					<tr bgcolor="#A9A9F5">
						<td colspan="6"><font color="#ffffff"><strong>&nbsp;&nbsp;&nbsp;Comprobaci&oacute;n de Gasolina</strong></font></td>
						<td width="16px"><img src="../../images/close2.ico" alt="Cerrar" align="right" onclick="muestraVentanaGasolina(0);" style="cursor:pointer"/></td>
					</tr>
				</table>
				
				<table  width="445" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
					<th colspan="5"><h3 align="center">Comprobaci&oacute;n de Gasolina</h3></th>
					<tr>
						<td>Tipo de Auto<span class="style1">*</span>:</td>
						<td>
						<select name="select_tipo_auto" id="select_tipo_auto" onchange="modifica_autos();">
						 <option id="-1" value="-1">Seleccione...</option>
						 <option id="1" value="1">Pool/Rentado</option>
						 <option id="2" value="2">Particular</option>
						 <option id="3" value="3">Asignado</option>						
						</select>
						</td>
						<td></td>
					</tr>
					<tr>
						<td>Modelo de Auto<span class="style1">*</span>:</td>
						<td>
						<select name="select_modelo" id="select_modelo" onchange="obtenMafactor();">
						 <option id="-1" value="-1">Seleccione...</option>
						<?PHP 
						$query = "SELECT ma_id, ma_nombre FROM modelo_auto WHERE ma_estatus = 1";
						$res = mysql_query($query);
						while($row = mysql_fetch_array($res)){
							echo "<option value=".$row['ma_id'].">".$row['ma_nombre']."</option>";						
						}
						?>
						</select>
						</td>
						<td><div id="factor" name="factor"></div></td>
					</tr>
					<tr>
						<td>Kilometraje<span class="style1">*</span>:</td>
						<td><input name="kilometraje" id="kilometraje" onblur="calculaMontoGasolina();" onkeyup="validaZeroIzquierda(this.value,this.id);"></td>
						<td><a target="_blank" href="https://maps.google.com/">Buscar Kilometraje</a></td>
					</tr>
					<tr>
						<td>Monto de gasolina<span class="style1">*</span>:</td>
						<td><input name="monto_gasolina" id="monto_gasolina" disabled ></td>
						<td>MXN</td>
					</tr>
					<tr>
						<td>Ruta detallada<span class="style1">*</span>:</td>
						<td colspan="2"><textarea name="ruta_detallada" id ="ruta_detallada" cols="40" rows="5"></textarea></td>
					</tr>
					<tr>
						<td colspan="3">
						<div align="center">
						<input type="submit" value="Aceptar" name="addGasolina" id="addGasolina" onclick="return validaDatosGasolina();">
						<input type="button" value="Cancelar" name="cancelarGasolina" id="cancelarGasolina" onclick="muestraVentanaGasolina(0);"></div>
						</td></tr>
                </table>
				</div><br/>							
				
                <div id="factura_form" name="factura_form" style="display:none;">
                <table width="785" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
                    <tr>
                        <td>&nbsp;</td>
                        <td colspan="4"><h3 align="center">Datos de proveedor</h3></td>
                        <td>&nbsp;</td>
                    </tr> 
                    <tr>
                        <td>&nbsp;</td>
                        <td colspan="4" align="center">&nbsp;                           
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>

                        <td>&nbsp;</td>
                        <td colspan="1"><div align="left" id="div_folio">Folio Factura<span class="style1">*</span>:</div></td>
                        <td colspan="3"><div align="left">
                                <input name="d_folio" id="d_folio" size="8" onkeypress="return validavalidaNum(event)" />
                            </div></td>
                        <td>&nbsp;</td>
                    </tr>  
                    <tr>
                        <td>&nbsp;</td>
                        <td><div id="rfc_prov_busq_div" align="left">RFC<span class="style1">*</span>: 
                            </div></td>
                        <td ><div align="left">
                                <input name="rfc" type="text" id="rfc" value="" size="30" maxlength="13"  onkeyup="this.value = this.value.toUpperCase();" />
                            </div></td>
                        <td ><div id="name_prov_busq_div" align="left">
                                <div align="left">Raz&oacute;n Social<span class="style1">*</span>: </div>
                            </div></td>
                        <td ><div align="left">
                                <input name="proveedor" type="text" id="proveedor" value="" size="30" />
                            </div></td>
                        <td>&nbsp;</td>
                    </tr>
                    <tr>
                        <td>&nbsp;</td>
                        <td colspan="4" align="center">&nbsp;                           
                        </td>
                        <td>&nbsp;</td>
                    </tr>
                    
                    <tr>
                        <td>&nbsp;</td>
                    </tr>
                </table>
                </div>
                <br />
                <div id="msg_div" align="center" >
                </div><br />
                <div
				align="center">
					<input name="registrar_comp" type="button" id="registrar_comp" value="    Registrar gasto"  onclick="validarcampos();recalcula();" style="background:url(../../images/ok.png); background-repeat:no-repeat; background-color:#E1E4EC;"/>
					<input type="hidden" name="prm_valido" id="prm_valido" readonly="readonly" value="" />
                </div>
        <?PHP 
	}
    ?> 
            <center><h3>Detalle de la Comprobaci&oacute;n</h3></center> 
            <?PHP 
            forma_comprobacion();
            ?>
            <table id="comprobacion_table" class="tablesorter" cellspacing="1"> 
                <thead> 
                    <tr> 
                        <th width="3%">No.</th>
                        <th width="3%">Tipo</th>
						<th width="3%">No. Trasacci&oacute;n</th>
                        <th width="5%">Fecha</th>
                        <th width="7%">Concepto</th>
                        <th width="8%">Comentario</th> 
                        <th width="8%">No. Asistentes</th> 
                        <th width="13%">RFC</th>
                        <th width="9%">Proveedor</th>
                        <th width="9%">Factura</th>
                        <th width="5%">Monto </th> 
                        <th width="6%">IVA</th>
                        <th width="6%">Propina</th>
                        <th width="6%">Impuesto Hospedaje</th>
                        <th width="4%">Total</th>
						<th width="5%">Divisa</th>
						<th width="4%">Total MXN</th>
						<th width="4%">Editar</th>
                        <th width="10%">Eliminar</th>
                    </tr> 
                </thead> 
                <tbody> 
                    <!-- cuerpo tabla-->
                </tbody> 
            </table>             
            <div id="ficha_deposito" style="display: none;">
                <table width="550" align="center" border="0" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
                    <tr>
                        <td colspan="4" align="center" style="color:#DF0101">
                            <b>El monto a comprobar es menor al anticipo, la comprobaci&oacute;n no se puede guardar.</b><br>
                        </td>
                    </tr>
                </table>
            </div>

            </br>
            </br>
			<?PHP 
			//obtiene los valores del resumen dependiendo si es ediciï¿½n o una nueva comprobacion
			if(isset($_GET['edit'])){
				$query = "SELECT IFNULL(FORMAT(sv_total_anticipo,2),0) as sv_total_anticipo, FORMAT(co_anticipo_comprobado,2) as co_anticipo_comprobado, 
						FORMAT(co_personal_descuento,2) as co_personal_descuento, FORMAT(co_amex_comprobado,2) as co_amex_comprobado,
						FORMAT(co_efectivo_comprobado,2) as co_efectivo_comprobado, FORMAT(co_mnt_descuento,2) as co_mnt_descuento,
						FORMAT(co_mnt_reembolso,2) as co_mnt_reembolso, FORMAT(co_amex_externo,2) as co_amex_externo
						FROM comprobaciones
						JOIN tramites ON t_id = co_mi_tramite
						LEFT JOIN solicitud_viaje ON sv_tramite = co_tramite
						WHERE t_id=".$_GET['edit'];
				$res = mysql_query($query);
				while($row = mysql_fetch_array($res)){
					$anticipo = $row['sv_total_anticipo']." MXN";					
				}
			}else{
				$anticipo = "0.00";			
			}
			
			$anticipoComprobado = "0.00";
			$personalDescuento = "0.00";
			$amexComprobado = "0.00";
			$efectivoComprobado = "0.00";
			$montoDescuento = "0.00";
			$montoReembolso = "0.00";
			$amexExterno = "0.00";
			
			$observaciones = '';
			if(isset($_GET['edit'])){
				$sql = "SELECT co_observaciones_edicion FROM comprobaciones WHERE co_mi_tramite = ".$_GET['edit'];
				$res = mysql_query($sql);
				while($row = mysql_fetch_assoc($res)){
					$observaciones = $row['co_observaciones_edicion'];
				}
			}
			?>
            <div align="center">            	
                <table border="0" width='100%'>						         
                   	 <tr>
                   	 	<td>
                   	 	<?php                   	 	
                   	 	if(isset($_GET['edit'])){                  	 	 
                   	 	 $queryEtapa=sprintf("SELECT t_etapa_actual, t_autorizaciones_historial FROM tramites  WHERE t_id=%s AND t_flujo =%s",$_GET['edit'],FLUJO_COMPROBACION);
                   	 	 $resEtapa = mysql_query($queryEtapa);
	                   	 	 while($row = mysql_fetch_assoc($resEtapa)){
	                   	 	 	$etapaComprobacion = $row['t_etapa_actual'];
	                   	 	 	$t_autorizaciones_historial = $row['t_autorizaciones_historial'];
	                   	 	 }                 	 	 
                   	 		if($etapaComprobacion == COMPROBACION_ETAPA_RECHAZADA || $etapaComprobacion == COMPROBACION_ETAPA_RECHAZADA_POR_DIRECTOR || $t_autorizaciones_historial != "" || $etapaComprobacion == COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){
                   	 			//consulta para obtener el historial de observaciones		
								$query = "SELECT co_observaciones FROM comprobaciones
										  WHERE co_mi_tramite ={$_GET['edit']}";
								$rst = mysql_query($query);
								$fila = mysql_fetch_assoc($rst);
								$observacionesHistorial = $fila['co_observaciones'];
						?>                    						    
                        <table>
						<tr><td width="30%" align='right' valign="top" width="5">Historial de observaciones: </td>
							<td width="30%">
							<textarea name="campo_historial" id="campo_historial" cols="70" rows="6" readonly="readonly" onkeypress="confirmaRegreso('campo_historial');" onkeydown="confirmaRegreso('campo_historial');"><?PHP echo $observacionesHistorial; ?></textarea>
							</td>
						</tr>
						</table>
						<?php }?>
					<?php }?>
						
						<?php if(isset($_GET['edit'])){
							if($etapaComprobacion == COMPROBACION_ETAPA_RECHAZADA || $etapaComprobacion == COMPROBACION_ETAPA_RECHAZADA_POR_DIRECTOR || $t_autorizaciones_historial != "" || $etapaComprobacion == COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){ 
								//$observaciones = "";?>
						 <table>
						 <?php  }
							 } ?> 
							<td width="30%"rowspan="4" align='right' valign="top" width="5">Observaciones<!--<span class="style1">*</span>-->:</td>
                        	<td width="30%" colspan="2" rowspan="4" class="alignLeft" valign="top">
                            <textarea name="observ" cols="70" rows="6" id="observ"><?PHP echo $observaciones;?></textarea>
                        	</td>
                        <?php if(isset($_GET['edit'])){
							if($etapaComprobacion == COMPROBACION_ETAPA_RECHAZADA || $etapaComprobacion == COMPROBACION_ETAPA_RECHAZADA_POR_DIRECTOR || $t_autorizaciones_historial != ""  || $etapaComprobacion == COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){ ?>	
						</table>
						<?php  }
							 } ?>   
                        </td>
                        <td width="40%">
							<table style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;margin-left:200px;" width="300px">
                                <tr>
                                    <td colspan="2" style="color:#000000; text-align: center;"><h3>Resumen</h3></td>
                                </tr>
                                <tr>
                                    <td></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td width="50%" align="right">Anticipo solicitado:</td>
                                    <td><div id="anticipo_solicitado1" align="right"><?PHP echo $anticipo;?></div><input type="hidden" readonly="readonly" name="anticipo_solicitado2" id="anticipo_solicitado2" value="<?PHP echo $anticipo;?>" /></td>
                                </tr>
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
                                <tr>
                                    <td width="50%" align="right">Anticipo comprobado: </td>
                                    <td><div id="anticipo_comprobado_autorizado_BMW1" align="right"><?PHP echo $anticipoComprobado;?></div><input type="hidden" readonly="readonly" name="anticipo_comprobado_autorizado_BMW2" id="anticipo_comprobado_autorizado_BMW2" value="<?PHP echo $anticipoComprobado;?>" /></td>
                                </tr><tr>
                                    <td width="50%" align="right">Personal a descontar: </td>
                                    <td><div id="personal_descontar1" align="right"><?PHP echo $personalDescuento; ?></div><input type="hidden" readonly="readonly" name="personal_descontar2" id="personal_descontar2" value="<?PHP echo $personalDescuento; ?>" /></td>
                                </tr>
                                <tr>
                                    <td width="50%" align="right">Amex comprobado:  </td>
                                    <td><div id="amex_comprobado_autorizado_BMW1" align="right"><?PHP echo $amexComprobado; ?></div><input type="hidden" readonly="readonly" name="amex_comprobado_autorizado_BMW2" id="amex_comprobado_autorizado_BMW2" value="<?PHP echo $amexComprobado; ?>" /></td>
                                </tr>
								<tr>
                                    <td width="50%" align="right">Efectivo comprobado:  </td>
                                    <td><div id="efectivo_comprobado_autorizado_BMW1" align="right"><?PHP echo $efectivoComprobado; ?></div><input type="hidden" readonly="readonly" name="efectivo_comprobado_autorizado_BMW2" id="efectivo_comprobado_autorizado_BMW2" value="<?PHP echo $efectivoComprobado; ?>" /></td>
                                </tr>                                
								<tr>
                                    <td width="50%" align="right">Amex externo:  </td>
                                    <td><div id="amex_externo1" align="right"><?PHP echo $amexExterno; ?></div><input type="hidden" readonly="readonly" name="amex_externo2" id="amex_externo2" value="<?PHP echo $amexExterno; ?>" /></td>
                                </tr>
								<tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
                                <tr>
                                    <td width="50%" align="right" style="color:#DF0101">Monto a descontar:  </td>
                                    <td style="color:#DF0101"><div id="monto_a_descontar1" align="right"><?PHP echo $montoDescuento; ?></div><input type="hidden" readonly="readonly" name="monto_a_descontar2" id="monto_a_descontar2" value="<?PHP echo $montoDescuento; ?>" /></td>
                                </tr>
                                <tr>
                                    <td width="50%" align="right" style="color:#DF0101">Monto a reembolsar:   </td>
                                    <td style="color:#DF0101"><div id="monto_a_reembolsar1" align="right"><?PHP echo $montoReembolso; ?></div><input type="hidden" readonly="readonly" name="monto_a_reembolsar2" id="monto_a_reembolsar2" value="<?PHP echo $montoReembolso; ?>" /></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </div>

            <br />
            <div align="center">
                <br />
				<table>
				<tr>
					<td>
						<div align="center">
							<input type="submit" id="guardarPrev" name="guardarPrev" value="     Guardar Previo"  disabled="disabled" onclick="return confirmSave(2);" style="background:url(../../images/save.gif); background-position:left; background-repeat:no-repeat; background-color:#E1E4EC;"/>
						</div>
					</td>
					<td>&nbsp;</td>
					<td>
						<div align="center">
							<?php
							$t_etapa_actual = 0;
							if(isset($_GET['edit'])){
								$tramite = new Tramite();
								$tramite->Load_Tramite($_GET['edit']);
								$t_etapa_actual = $tramite->Get_dato('t_etapa_actual');								
							}
							$nombreBoton = "     Enviar Comprobacion";
							
							if(isset($_SESSION['iddelegado']) && $t_etapa_actual != COMPROBACION_ETAPA_DEVUELTO_CON_OBSERVACIONES){
			                	$nombreBoton = "     Enviar a Director";
			               	} ?>
							<input type="submit" id="guardarComp" name="guardarComp" value="<?php echo $nombreBoton;?>"  onclick="return validacion();" disabled="disabled"  style="background:url(../../images/save.gif); background-position:left; background-repeat:no-repeat; background-color:#E1E4EC;"/> 
						</div>
					</td>
				</tr>
				</table>
				<!--Flotante para proveedores-->			
				<div id="proveedor_form" style="visibility:hidden; position:absolute; top:50%; left:25%; rigth:25%; width:650px; margin-left:0%; margin-right:0%; margin-top:0%; border:1px solid #808080; padding:5px; background-color:#FAFAFA" >
					<table bordercolor="#333333" style="font-size:11px" border="0" width="100%">
						<tr bgcolor="#A9A9F5">
							<td colspan="8">
								<font color="#ffffff"><strong>&nbsp;&nbsp;&nbsp;Pantalla proveedores</strong></font>
							</td>						
							<td width="16px">
								<img src="../../images/close2.ico" alt="Cerrar" align="right" onclick="limpiarCamposDeProveedor();flotanteActive(0);" style="cursor:pointer"/>
							</td>
						</tr>
					</table>
					<br>
					<div align="center">
						<input type="button" class="fadeNext" style="background:url(../../images/reject.png); background-position:left; background-repeat:no-repeat; background-color:#E1E4EC;"  name="add_rem_prv" id="add_rem_prv" onclick="flotanteActive(0);limpiarCamposDeProveedor();" value="     Cerrar Panel de Nuevo Proveedor"/>
					</div>
					<table width="300" border="0" align="center" cellspacing="1" style="border:1px #CCCCCC solid;margin:auto;margin-top:5px;text-align:left;">
						<tr><td colspan="8"><div align="center"><h3>Agregar nuevo proveedor</h3></div></td></tr>
						<tr><td width="38"></td>
							<td width="132"><div align="right"><em><strong>Raz&oacute;n Social<span class="style1">*</span>: </strong></em></div></td>
							<td colspan="5"><div align="left"><input name="new_proveedor" type="text" id="new_proveedor" value="" size="50" /></div></td>
							<td width="77"></td>
						</tr>
						<tr><td></td>
							<td><div align="right"><em><strong>RFC<span class="style1">*</span>: </strong></em></div></td>
							<td width="194"><div align="left"><input name="new_p_rfc" type="text" id="new_p_rfc" value="" size="30" maxlength="13" onkeyup="this.value = this.value.toUpperCase();"/></div></td>
							<td width="7"></td>
							<td width="7"></td>
							<td width="37"></td>
							<td width="266"></td>
							<td></td>
						</tr>
						<tr><td></td>
							<td><div align="right"><em><strong>Domicilio Fiscal<span class="style1">*</span>:</strong></em></div></td>
							<td colspan="5"><input name="new_p_addr" id="new_p_addr" value="" size="80" /></td><td>&nbsp;</td>
						</tr>
						<tr><td></td>
							<td colspan="6"><div align="center"><input type="button" name="agregar" value="    Agregar" onclick="nuevoProveedor(new_proveedor.value,new_p_rfc.value,new_p_addr.value);" style="background:url(../../images/add.png); background-position:left; background-repeat:no-repeat; background-color:#E1E4EC;" /></div></td>
							<td></td>
						</tr>
					</table>
				</div>
    <?PHP 
    $query_centrocostos = sprintf("SELECT idcentrocosto FROM empleado INNER JOIN cat_cecos ON empleado.idcentrocosto = cat_cecos.cc_id WHERE empleado.idempleado = %s", $_SESSION["idusuario"]);
    $rst_centrocostos = mysql_query($query_centrocostos);
    $fila_idcentro_costos1 = mysql_fetch_assoc($rst_centrocostos);
    $idcentrocosto_original = $fila_idcentro_costos1['idcentrocosto'];
    
    //Tomaremos los id's de los conceptos Alimentos,Hotel y lavanderia cuando sea una edicion
    if(isset($_GET['edit']) ||isset($_GET['new']) ){
    	$concepto=new Concepto();
    	$idAlimento=$concepto->GetIdAlimentos();
    	$idHotel=$concepto->GetIdHotel();
    	$idLavanderia=$concepto->GetIdLavanderia();
    }    
    ?>
                <input type="hidden" name="typedoc" id="typedoc" readonly="readonly"  value="" />

                <input type="hidden" name="iu" id="iu" readonly="readonly" value="<?PHP echo $_SESSION["idusuario"]; ?>" />
                <input type="hidden" name="ne" id="ne" readonly="readonly" value="<?PHP echo $_SESSION["idusuario"]; ?>" />
                <input type="hidden" name="empresa" id="empresa" value="<?PHP echo $_SESSION["empresa"]; ?>" readonly="readonly" />
                <input type="hidden" name="guarda" id="guarda" value="" readonly="readonly" />
                <input type="hidden" id="rowCount" name="rowCount" value="0" readonly="readonly"/>
                <input type="hidden" name="datos_empleado2" id="datos_empleado2" value="" readonly="readonly" />
                <input type="hidden" id="sol_id" name="sol_id" value="0" readonly="readonly"/>
                <input type="hidden" id="rowCountCecos" name="rowCountCecos" value="0" readonly="readonly"/>
                <input type="hidden" id="Cecos" name="Cecos" value="0" readonly="readonly"/>
                <input type="hidden" id="Cecos_usuario" name="Cecos_usuario" value="<?PHP echo $idcentrocosto_original; ?>"readonly="readonly" />
                <input type="hidden" id="Cecos_refacturado" name="Cecos_refacturado" value="0" readonly="readonly"/>
                <input type="hidden" id="concepto_alim_hot" name="concepto_alim_hot" value="0" readonly="readonly"/>
                <input type="hidden" id="porcentA" name="porcentA" value="0" readonly="readonly"/>
                <input type="hidden" id="" name="no_Comprobaciones_parciales" value="0" readonly="readonly"/>
				<!-- excepciones nivel concepto/no_Comprobaciones_parcialesviaje -->
				<input type='hidden' id='mensaje_excepcion_gasolina' name='mensaje_excepcion_gasolina' value="" readonly="readonly">
				<input type='hidden' id='dif_gasolina' name='dif_gasolina' value="" readonly="readonly">
				<input type='hidden' id='mensaje_excepcion_ViajeA' name='mensaje_excepcion_ViajeA' value=" " readonly="readonly">
				<input type='hidden' id='dif_ViajeA' name='dif_ViajeA' value="0" readonly="readonly">
				<input type='hidden' id='mensaje_excepcion_ViajeH' name='mensaje_excepcion_ViajeH' value=" " readonly="readonly">
				<input type='hidden' id='dif_ViajeH' name='dif_ViajeH' value="0" readonly="readonly">
				<input type='hidden' id='mensaje_excepcion_ViajeL' name='mensaje_excepcion_ViajeL' value=" " readonly="readonly">				
				<input type='hidden' id='dif_ViajeL' name='dif_ViajeL' value="0" readonly="readonly">
				<!-- Valores de parametros -->
				<input type='hidden' id='parametroAlimento' name='parametroAlimento' value="" readonly="readonly">
				<input type='hidden' id='divisaAlimento' name='divisaAlimento' value="" readonly="readonly">
				<input type='hidden' id='parametroHospedaje' name='parametroHospedaje' value="" readonly="readonly">
				<input type='hidden' id='divisaHospedaje' name='divisaHospedaje' value="" readonly="readonly">
				<input type='hidden' id='parametroLavanderia' name='parametroLavanderia' value="" readonly="readonly">
				<input type='hidden' id='divisaLavanderia' name='divisaLavanderia' value="" readonly="readonly">
				<input type='hidden' id='validacionCompleta' name='validacionCompleta' value="0" readonly="readonly">
				<input type='hidden' id='validacionRealizada' name='validacionRealizada' value="0" readonly="readonly">			
				<!-- Id de conceptos (Solo activados en Edicion7Guardado previo) -->
				<input type='hidden' id='id_alimentos' name='id_alimentos' value="<?PHP echo $idAlimento; ?>">
				<input type='hidden' id='id_hotel' name='id_hotel' value="<?PHP echo $idHotel; ?>">
				<input type='hidden' id='id_lavanderia' name='id_lavanderia' value="<?PHP echo $idLavanderia; ?>">
				<!-- Dias de viaje -->
				<input type='hidden' id='diasViaje' name='diasViaje' value="" readonly="readonly" />		
				<input type="hidden" name="motive" id="motive" value="" readonly="readonly" />
                <input type="hidden" id="region" name="region" value="0" readonly="readonly"/>
              
				<?PHP 
					$query_centrocostos = sprintf("SELECT idcentrocosto FROM empleado INNER JOIN cat_cecos ON empleado.idcentrocosto = cat_cecos.cc_id WHERE empleado.idempleado = %s", $_SESSION["idusuario"]);
					$rst_centrocostos = mysql_query($query_centrocostos);
					$fila_idcentro_costos1 = mysql_fetch_assoc($rst_centrocostos);
					$idcentrocosto_original = $fila_idcentro_costos1['idcentrocosto'];
					//Obtener Divisa Euro
					$_divisas = new Divisa();
					$_divisas->Load_data(3); //busca Id de divisa
					$divisaEUR = $_divisas->Get_dato("div_tasa");
					//Obtener Divisa Dï¿½lar
					$_divisas1 = new Divisa();
					$_divisas1->Load_data(2);
					$divisaUSD = $_divisas1->Get_dato("div_tasa");
					//Obtener Divisa MEX
					$_divisas2 = new Divisa();
					$_divisas2->Load_data(1);
					$divisaMEX = $_divisas2->Get_dato("div_tasa");					
				?>
				<!-- Divisa MEX -->
				<input type='hidden' id='valorDivisaMEX' name='valorDivisaMEX' value="<?PHP echo $divisaMEX; ?>">
				<!-- Divisa Euro -->
				<input type='hidden' id='valorDivisaEUR' name='valorDivisaEUR' value="<?PHP echo $divisaEUR; ?>">
				<!-- Divisa Dï¿½lar -->
				<input type='hidden' id='valorDivisaUSD' name='valorDivisaUSD' value="<?PHP echo $divisaUSD; ?>">
				<!-- aqui se carga el id del cargo amex seleccionado cuando edita un previo de tipo amex -->
				<input type='hidden' id='id_cargo_amex_seleccionado' name='id_cargo_amex_seleccionado' value="">
				<input type="hidden" id="rowDel" name="rowDel" value="0" readonly="readonly"/>
				<input type="hidden" id="itinerarioActualOPosible" name="itinerarioActualOPosible" value="1" readonly="readonly"/>
				<input type="hidden" id="rowCount" name="rowCount" value="0" readonly="readonly"/>
				<input type="hidden" id="idAmex" name="idAmex" value="0" readonly="readonly"/>
				<input type="hidden" id="comprobacionGasolina" name="comprobacionGasolina" value="0" readonly="readonly"/>
				<input type="hidden" id="test" name="test" value="0" readonly="readonly"/>
				<input type="hidden" id="aux1" name="aux1" value="" readonly="readonly"/>
				<input type="hidden" id="aux2" name="aux2" value="" readonly="readonly"/>
				<input type="hidden" id="edicionAux" name="edicionAux" value="0" readonly="readonly"/>
				<input type="hidden" name="delegado" id="delegado" readonly="readonly" value="<?php if(isset($_SESSION['iddelegado'])){ echo $_SESSION['iddelegado']; }else{echo 0;}?>" />
				<input type="hidden" name="etapaComprobacion" id="etapaComprobacion" value="<?php if(isset($_GET['edit'])){ echo $t_etapa_actual;}else{ echo "0";}?>" readonly="readonly" size="5" />
				<input type="hidden" name="tramiteComprobacion" id="tramiteComprobacion" value="<?php if(isset($_GET['edit'])){ echo $_GET['edit'];}else{ echo "0";}?>" readonly="readonly" size="5" />
				<?PHP //checa si esta en modo ediciï¿½n genera las siguientes banderas
				if(isset($_GET['edit'])){					
				?>
					<input name="cargar_com_viaje" type="hidden" id="cargar_com_viaje" value="1"/>
					<input name="id_tramite" type="hidden" id="id_tramite" value="<?PHP echo $_GET['edit']?>"/> 
				<?PHP }else{?>
					<input name="cargar_com_viaje" type="hidden" id="cargar_com_viaje" value="0"/>
				<?PHP }
				?>
		</form>
    <?PHP 
}
?>
